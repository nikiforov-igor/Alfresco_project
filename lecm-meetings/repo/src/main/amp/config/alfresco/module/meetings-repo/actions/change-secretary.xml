<?xml version='1.0' encoding='UTF-8'?>
<items updateMode="CreateOrUpdate">
    <item name="cm:Сменить секретаря" type="lecm-group-actions:script-action">
        <property name="cm:name"><![CDATA[Сменить секретаря]]></property>
        <property name="lecm-group-actions:statuses"><![CDATA[]]></property>
        <property name="lecm-group-actions:type"><![CDATA[[lecm-meetings:document]]]></property>
        <property name="lecm-group-actions:order"><![CDATA[0]]></property>
        <property name="lecm-group-actions:expression">
            <![CDATA[doc.attr("lecm-statemachine-aspects:is-final") == true AND (user.currentUser().getEmployee().toString().equals(doc.attr("lecm-meetings:chairman-assoc-ref")) OR user.currentUser().getEmployee().toString().equals(doc.attr("lecm-events:initiator-assoc-ref")) OR user.currentUser().hasActiveDelegation(doc.assoc("lecm-events:initiator-assoc")) OR user.currentUser().hasActiveDelegation(doc.assoc("lecm-meetings:chairman-assoc")))]]></property>
        <property name="lecm-group-actions:isGroup"><![CDATA[false]]></property>
        <property name="lecm-group-actions:forCollection"><![CDATA[false]]></property>
        <property name="cm:title"><![CDATA[Сменить секретаря]]></property>
        <property name="lecm-group-actions:script"><![CDATA[var meeting = document;
if (meeting !== null){
  if (new_secretary != null) {
    var secretary = null;
    var secretaryAssoc = document.assocs["lecm-meetings:secretary-assoc"];
    if (secretaryAssoc != null && secretaryAssoc.length == 1) {
        secretary = secretaryAssoc[0];
    }
    if (secretary != null) {
        document.removeAssociation(secretary, "lecm-meetings:secretary-assoc");
    }
    /*в этом месте сработает полиси на добавление секретаря*/
    document.createAssociation(new_secretary, "lecm-meetings:secretary-assoc");
  }
}]]></property>
        <items>
            <item name="cm:Новый секретарь" type="lecm-group-actions:form-field">
                <property name="cm:name"><![CDATA[Новый секретарь]]></property>
                <property name="lecm-group-actions:field-default-value"><![CDATA[]]></property>
                <property name="lecm-group-actions:field-id"><![CDATA[new_secretary]]></property>
                <property name="lecm-group-actions:field-is-mandatory"><![CDATA[true]]></property>
                <property name="lecm-group-actions:field-type"><![CDATA[new_secretaty]]></property>
                <property name="lecm-group-actions:field-priority"><![CDATA[10]]></property>
            </item>
        </items>
    </item>
</items>