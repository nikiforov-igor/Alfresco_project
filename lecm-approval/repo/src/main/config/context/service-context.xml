<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<bean id="lecm.approval.modelBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap, statemachine.aspects.LogicEcmModelsBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-approval-list-model.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-parallel-approval-model.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-sequential-approval-model.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-terminate-approval-model.xml</value>
                <value>alfresco/module/${artifactId}/models/lecm-custom-approval-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/lecm-approval-list</value>
				<value>alfresco/module/${artifactId}/messages/lecm-parallel-approval-workflow-model</value>
				<value>alfresco/module/${artifactId}/messages/lecm-sequential-approval-workflow-model</value>
				<value>alfresco/module/${artifactId}/messages/lecm-custom-approval-workflow-model</value>
			</list>
		</property>
	</bean>

	<util:constant id="ENGINE_ID" static-field="org.alfresco.repo.workflow.WorkflowDeployer.ENGINE_ID"/>
	<util:constant id="LOCATION" static-field="org.alfresco.repo.workflow.WorkflowDeployer.LOCATION"/>
	<util:constant id="MIMETYPE" static-field="org.alfresco.repo.workflow.WorkflowDeployer.MIMETYPE"/>
	<util:constant id="REDEPLOY" static-field="org.alfresco.repo.workflow.WorkflowDeployer.REDEPLOY"/>
	<bean id="lecm.approval.workflowBootstrap" parent="workflowDeployer" depends-on="lecm.approval.modelBootstrap">
		<property name="workflowDefinitions">
			<list>
				<props>
					<prop key="#{ENGINE_ID}">activiti</prop>
					<prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/parallel-approval-workflow.bpmn20.xml</prop>
					<prop key="#{MIMETYPE}">text/xml</prop>
					<prop key="#{REDEPLOY}">true</prop>
				</props>
				<props>
					<prop key="#{ENGINE_ID}">activiti</prop>
					<prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/sequential-approval-workflow.bpmn20.xml</prop>
					<prop key="#{MIMETYPE}">text/xml</prop>
					<prop key="#{REDEPLOY}">true</prop>
				</props>
				<props>
					<prop key="#{ENGINE_ID}">activiti</prop>
					<prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/approval-termination.bpmn20.xml</prop>
					<prop key="#{MIMETYPE}">text/xml</prop>
					<prop key="#{REDEPLOY}">true</prop>
				</props>
				<props>
					<prop key="#{ENGINE_ID}">activiti</prop>
					<prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/approval-force.bpmn20.xml</prop>
					<prop key="#{MIMETYPE}">text/xml</prop>
					<prop key="#{REDEPLOY}">true</prop>
				</props>
                <props>
                    <prop key="#{ENGINE_ID}">activiti</prop>
                    <prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/custom-approval-workflow.bpmn20.xml</prop>
                    <prop key="#{MIMETYPE}">text/xml</prop>
                    <prop key="#{REDEPLOY}">true</prop>
                </props>
            </list>
		</property>
	</bean>

	<bean id="lecm.approval.service.abstract" class="ru.it.lecm.approval.ApprovalListServiceAbstract" parent="baseBean" depends-on="lecm.approval.workflowBootstrap" abstract="true">
		<property name="nodeService" ref="nodeService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="documentMembersService" ref="documentMembersService"/>
		<property name="notificationsService" ref="notificationsService"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="workflowService" ref="workflowServiceImpl"/>
		<property name="workCalendar" ref="WorkCalendarService"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>

	<bean id="lecm.approval.service.parallel" class="ru.it.lecm.approval.ApprovalListServiceParallel" parent="lecm.approval.service.abstract"/>
	<bean id="lecm.approval.service.sequential" class="ru.it.lecm.approval.ApprovalListServiceSequential" parent="lecm.approval.service.abstract"/>
    <bean id="lecm.approval.service.custom" class="ru.it.lecm.approval.ApprovalListServiceCustom" parent="lecm.approval.service.abstract"/>

	<bean id="lecm.approval.javascriptExtension.abstract" abstract="true" parent="baseJavaScriptExtension">
		<property name="authenticationService" ref="authenticationService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="personService" ref="personService"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
	</bean>

	<bean id="lecm.approval.javascriptExtension.parallel" class="ru.it.lecm.approval.extensions.ApprovalJavascriptExtension" parent="lecm.approval.javascriptExtension.abstract">
		<property name="extensionName" value="approvalParallel"/>
		<property name="approvalListService" ref="lecm.approval.service.parallel"/>
		<property name="stateMachineHelper" ref="stateMachineHelper"/>
	</bean>

	<bean id="lecm.approval.javascriptExtension.sequential" class="ru.it.lecm.approval.extensions.ApprovalJavascriptExtension" parent="lecm.approval.javascriptExtension.abstract">
		<property name="extensionName" value="approvalSequential"/>
		<property name="approvalListService" ref="lecm.approval.service.sequential"/>
		<property name="stateMachineHelper" ref="stateMachineHelper"/>
	</bean>

    <bean id="lecm.approval.javascriptExtension.service" class="ru.it.lecm.approval.extensions.ApprovalServiceJavascriptExtension"
          parent="lecm.approval.javascriptExtension.abstract">
        <property name="extensionName" value="approvalService"/>
        <property name="repository" ref="repositoryHelper"/>
        <property name="authenticationService" ref="authenticationService"/>
    </bean>

    <bean id="lecm.approval.javascriptExtension.custom" class="ru.it.lecm.approval.extensions.ApprovalJavascriptExtension"
          parent="lecm.approval.javascriptExtension.abstract">
        <property name="extensionName" value="approvalCustom"/>
        <property name="approvalListService" ref="lecm.approval.service.custom"/>
    </bean>

    <bean id="lecm.approval.ApprovalListItemPolicy" class="ru.it.lecm.approval.policies.ApprovalListItemPolicy" init-method="init" depends-on="lecm.approval.modelBootstrap">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
	</bean>

    <bean id="lecm.approval.AssigneesListItemPolicy" class="ru.it.lecm.approval.policies.AssigneesListItemPolicy" init-method="init"
          depends-on="lecm.approval.modelBootstrap">
        <property name="policyComponent" ref="policyComponent"/>
        <property name="nodeService" ref="nodeService"/>
    </bean>

    <bean id="webscript.ru.it.lecm.approval.GetDocumentDataByTaskId.get" class="ru.it.lecm.approval.webscript.GetDocumentDataByTaskIdOrNodeRef" parent="webscript">
		<property name="workflowService" ref="WorkflowService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="approvalListService" ref="lecm.approval.service.parallel"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>
	<bean id="webscript.ru.it.lecm.approval.GetDocumentDataByNodeRef.get" class="ru.it.lecm.approval.webscript.GetDocumentDataByTaskIdOrNodeRef" parent="webscript">
		<property name="workflowService" ref="WorkflowService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="approvalListService" ref="lecm.approval.service.parallel"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>
</beans>
