<?xml version="1.0" encoding="UTF-8"?>
<!--
	Досье договора.

	model of the contract/document:
		.\lecm-contracts\repo\src\main\config\models\lecm-contracts-model.xml

Входные данные:
•	ID документа-договора 

Выходные данные отчета:
•	много полей документа
•	(A) много полей Контрагента

(!) Хорошая особенность - все поля доступны либо непосредственно из документа,
	либо по ссылкам, доступным для substituteService.

  -->

<ds.config>
    <report.descriptor mnem="contract-dossier-byid">
        <l18>
            <item key="RU_RU" value="Досье договора"/>
        </l18>
        <provider mnem="DSContactDossierProvider" javaClass="ru.it.lecm.reports.generators.GenericDSProviderBase" >
           <l18>
               <item key="RU_RU" value="Провайдер Jasper отчётов: Досье договора"/>
           </l18>
        </provider>
        <templates>
            <template mnem="tmpl" type="JASPER" filename="contract-dossier-byid_tmpl.jrxml"/>
        </templates>
        <roles>CONTRACT_READER,CONTRACT_RECORDER,CONTRACT_EXECUTOR,CONTRACT_CURATOR,CONTRACT_SIGNER</roles>
    </report.descriptor>

	<query.descriptor>
		<offset>0</offset>
		<limit>-1</limit>
		<pgsize>-1</pgsize>
		<allVersions>true</allVersions>
		<preferedType>lecm-contract:document</preferedType>
		<isMultiRow>false</isMultiRow>
		<isCustom>false</isCustom>
		<queryText><![CDATA[]]></queryText>
	</query.descriptor>

	<fields>
		<!-- Инициатор договора == Автор "lecm-orgstr:employee" -->
		<field jrFldName="col_Initiator" queryFldName="{{@AUTHOR/lecm-orgstr:employee-short-name}}" displayName="Инициатор" />
<!--		<field jrFldName="col_Initiator.Staff" queryFldName="{{@AUTHOR.REF/lecm-representative:rank}}" displayName="Инициатор.Должность" />
		<field jrFldName="col_Initiator.OU" queryFldName="{{@AUTHOR.REF/lecm-representative:rank}}" displayName="Инициатор.Подразделение" />-->
		<field jrFldName="col_Initiator.Phone" queryFldName="{{@AUTHOR/lecm-orgstr:employee-phone}}" displayName="Инициатор.Телефон" />

		<!-- Статус -->
		<field jrFldName="col_Status" queryFldName="{lecm-statemachine:status}" displayName="Статус" />

		<!-- Дата изменения статуса -->
		<field jrFldName="col_StatusDate" queryFldName="{lecm-document:status-changed-date}" displayName="Дата смены статус"
				javaValueClass="java.util.Date"/>

		<!-- Дата регистрации договора -->
		<field jrFldName="col_DateRegContracts" queryFldName="{lecm-contract:dateRegContracts}" displayName="Дата регистрации договора"
				javaValueClass="java.util.Date"/>

		<!-- "Общая сумма по договору": "lecm-contract:totalAmount"
			 и "Валюта договора": (assoc) "lecm-contract:currency-assoc" 
				-> target: "lecm-currency:currency
		  -->
		<field jrFldName="col_Sum" queryFldName="{lecm-contract:totalAmount}" displayName="Сумма договора" javaValueClass="java.lang.Float"/>
		<field jrFldName="col_SumUnits" queryFldName="{lecm-contract:currency-assoc/lecm-currency:alphabetic-code}" displayName="Валюта договора" javaValueClass="String"/>

		<!-- Данные по "Виду договора" (с типом "lecm-contract-dic:contract-type") -->
		<field jrFldName="col_DocKind" queryFldName="{lecm-contract:typeContract-assoc/cm:name}" displayName="Вид договора" />

		<field queryFldName="{lecm-contract:regNumSystem}"
				jrFldName="col_Regnum"
				displayName="Регистрационный номер договора" javaValueClass="String"/>

		<!-- Дата заключения договора -->
		<field jrFldName="col_ConclusionDate" queryFldName="{lecm-contract:dateConclusionContracts}" displayName="Дата заключения"
			javaValueClass="date"/>

		<!-- Регистрационный номер проекта договора-->
		<field queryFldName="{lecm-contract:regNumProject}"
				jrFldName="col_RegnumProject"
				displayName="Регистрационный номер проекта договора" javaValueClass="String"/>

		<!-- Регистрационный номер контрагента -->
		<field queryFldName="{lecm-contract:regNumContractor}"
				jrFldName="col_RegnumContractor"
				displayName="Регистрационный номер контрагента" javaValueClass="String"/>

		<!-- Подписант контрагента -->
		<field queryFldName="{lecm-contract:signatoryCounterparty}"
				jrFldName="col_SignatoryCounterparty"
				displayName="Подписант контрагента" javaValueClass="String"/>

		<!-- Полное наименование котрагента "lecm-contract:partner-assoc": target "lecm-contractor:contractor-type"
			и пр атрибуты котрагента
		  -->
		<field jrFldName="col_Contragent.fullname"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:fullname}" displayName="Контрагент.Полное наименование"/>
		<field jrFldName="col_Contragent.name"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:shortname}" displayName="Контрагент.Короткое"/>
		<field jrFldName="col_Contragent.phone" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:phone}" displayName="Контрагент.Тел" />

		<field jrFldName="col_Contragent.YurAddress" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:legal-address}" displayName="Контрагент.Юридический адрес" />
		<field jrFldName="col_Contragent.PhisAddress" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:physical-address}" displayName="Контрагент.Фактический адрес" />

		<!-- БИК Контрагента -->
		<field jrFldName="col_Contragent.BIK" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:BIK}" displayName="Контрагент.БИК" />

		<!-- Наименование банка Контрагента -->
		<field jrFldName="col_Contragent.Bankname" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:bankname}" displayName="Контрагент.БИК" />

		<!-- Расчетный счет -->
		<field jrFldName="col_Contragent.TransactAccount" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:transactional-account}" displayName="Контрагент.Расчётный счёт" />

		<!-- Корреспондентский счет -->
		<field jrFldName="col_Contragent.CorrAccount" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:correspondent-account}" displayName="Контрагент.Корреспондентский счет" />

		<!--Адресанты (типа "lecm-representative:representative-type")
			Фамилия Имя Отчество и Должность
		  -->
		<!--<field jrFldName="col_Executor.Family" queryFldName="{lecm-contract:representative-assoc/lecm-representative:surname}" displayName="КонтрагентаИсполнитель.Фамилия" />-->
		<!--<field jrFldName="col_Executor.Name" queryFldName="{lecm-contract:representative-assoc/lecm-representative:firstname}" displayName="КонтрагентаИсполнитель.Имя" />-->
		<!--<field jrFldName="col_Executor.Otchestvo" queryFldName="{lecm-contract:representative-assoc/lecm-representative:middlename}" displayName="КонтрагентаИсполнитель.Отчество" />-->
		<!--<field jrFldName="col_Executor.Staff" queryFldName="{lecm-contract:representative-assoc/lecm-representative:rank}" displayName="КонтрагентаИсполнитель.Должность" />-->

		<!-- Дата начала действия договора -->
		<field jrFldName="col_DateStart" queryFldName="{lecm-contract:startDate}" displayName="Дата начала действия договора"
				javaValueClass="java.util.Date"/>

		<!-- Дата окончания действия договора -->
		<field jrFldName="col_DateEnd" queryFldName="{lecm-contract:endDate}" displayName="Дата окончания действия договора"
				javaValueClass="java.util.Date"/>

		<!-- Бессрочный -->
		<field jrFldName="col_ContractIsUnlimited" queryFldName="{lecm-contract:unlimited}" displayName="Договор бессрочный"
				javaValueClass="boolean"/>

		<!--  Местонахождение договора -->
		<field jrFldName="col_Contract.Placehold" queryFldName="{lecm-contract:locationContract}" displayName="Местонахождение договора" />

		<!-- Место регистрации -->
		<field jrFldName="col_Contract.RegPlace" queryFldName="{lecm-contract:locationRegistration}" displayName="Место регистрации договора" />


		<!-- Данные по "Тематика договора" (с типом "lecm-doc-dic:subjects") -->
		<field jrFldName="col_Theme.code" queryFldName="{lecm-document:subject-assoc/lecm-doc-dic:subject-code}" displayName="Тематика.Код" />
		<field jrFldName="col_Theme.tname" queryFldName="{lecm-document:subject-assoc/cm:name}" displayName="Тематика.Название" />
		<field jrFldName="col_Theme.desc" queryFldName="{lecm-document:subject-assoc/lecm-doc-dic:subject-description}" displayName="Тематика.Описание" />

	</fields>
</ds.config>
