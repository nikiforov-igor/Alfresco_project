<?xml version='1.0' encoding='UTF-8'?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:jms="http://www.springframework.org/schema/jms"
       xmlns:amq="http://activemq.apache.org/schema/core"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
						   http://www.springframework.org/schema/jms
                           http://www.springframework.org/schema/jms/spring-jms.xsd
                           http://activemq.apache.org/schema/core
                           http://activemq.apache.org/schema/core/activemq-core.xsd">

	<bean id="${groupId}.${artifactId}.notificationsBootstrap" parent="dictionaryModelBootstrap"
	      depends-on="ru.it.lecm.notifications.notifications-repo.notificationsBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-dashlet-model.xml</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.notificationsTypeDashletBootstrap" parent="lecmDictionaryBootstrap"
	      depends-on="ru.it.lecm.notifications.notifications-repo.notificationsTypesBootstrap, businessJournalLogEventsPolicy">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-type-dashlet.xml</value>
			</list>
		</property>
	</bean>

	<util:constant id="NOTIFICATIONS_DASHLET_ROOT_ID" static-field="ru.it.lecm.notifications.dashlet.beans.NotificationsDashletChannel.NOTIFICATIONS_DASHLET_ROOT_ID"/>
	<util:constant id="NOTIFICATIONS_DASHLET_ROOT_NAME" static-field="ru.it.lecm.notifications.dashlet.beans.NotificationsDashletChannel.NOTIFICATIONS_DASHLET_ROOT_NAME"/>
	<util:constant id="NOTIFICATIONS_ROOT_NAME" static-field="ru.it.lecm.notifications.beans.NotificationsService.NOTIFICATIONS_ROOT_NAME"/>
	
	<bean id="notificationDashletChannel" init-method="init" class="ru.it.lecm.notifications.dashlet.beans.NotificationsDashletChannel"
          depends-on="ServiceRegistry, nodeService, repositoryHelper, notificationsService, serviceOrgstructure, namespaceService, transactionService" parent="baseBean">
		<property name="notificationsService" ref="notificationsService"/>
        <property name="orgstructureService" ref="serviceOrgstructure"/>
        <property name="namespaceService" ref="namespaceService"/>
		<!-- Автоматическое создание каталогов. -->
		<property name="folders">
			<map>
				<entry key="NOTIFICATIONS_DASHLET_ROOT_ID" value="#{NOTIFICATIONS_ROOT_NAME}/#{NOTIFICATIONS_DASHLET_ROOT_NAME}"/>
			</map>
		</property>
    </bean>

    <bean id="notificationsDashletScript" parent="baseScript" class="ru.it.lecm.notifications.dashlet.scripts.NotificationDashletWebScriptBean"
          depends-on="notificationDashletChannel">
        <property name="extensionName">
            <value>notificationDashlet</value>
        </property>
        <property name="service">
            <ref bean="notificationDashletChannel"/>
        </property>
    </bean>

	<bean id="notificationsDashletDeleteSchedule" class="ru.it.lecm.notifications.dashlet.schedule.NotificationsDashletDeleteSchedule" parent="baseTransactionalSchedule">
		<property name="cronExpression">
			<value>0 30 3 * * ?</value>
		</property>
		<property name="firstStartExpression">
			<value>0 */20 * * * ?</value>
		</property>
		<property name="onServerStart">
			<value>true</value>
		</property>
		<property name="jobName">
			<value>notificationa-dashlet-cleaner</value>
		</property>
		<property name="jobGroup">
			<value>notifications-dashlet</value>
		</property>
		<property name="triggerName">
			<value>notifications-dashlet-delete-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>notifications-dashlet-trigger</value>
		</property>
		<property name="actionName">
			<value>deleteAction</value>
		</property>
		<property name="namespaceService">
			<ref bean="namespaceService"/>
		</property>
		<property name="notificationsDashletChannel">
			<ref bean="notificationDashletChannel"/>
		</property>
	</bean>
</beans>
