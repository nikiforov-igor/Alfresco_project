<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
							http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

    <util:list id="ord.models">
	    <value>alfresco/module/${artifactId}/models/lecm-ord-table-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-ord-model.xml</value>
	</util:list>

    <util:list id="ord.models.labels">
		<value>alfresco/module/${artifactId}/messages/lecm-ord-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-ord-table-model</value>
	</util:list>

    <util:list id="ord.dictionaries">
		<value>alfresco/module/${artifactId}/dictionaries/lecm-ord-type.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-ord-item-status.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-ord-regnumbers-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-ord-br-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-ord-bj-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-ord-event-items.xml</value>
        <value>alfresco/module/${artifactId}/dictionaries/lecm-ord-type-items.xml</value>
        <value>alfresco/module/${artifactId}/dictionaries/lecm-ord-nt-items.xml</value>
	</util:list>
    <!-- Registration of ord models -->
    <bean id="ord.document.models.bootstrap" parent="modelsToRepositoryLoader"
          depends-on="
            ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap,
            eds.models.bootstrap, documents.LogicEcmModelsBootstrap,
            errands.LogicEcmModelsBootstrap,
            lecm.sign2.helper.model.bootstrap
            review.model.bootstrap"
          p:models-ref="ord.models"
		  p:labels-ref="ord.models.labels"/>

	<bean id="ord.dictionary.bootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="ru.it.lecm.business-journal.business-journal-repo.businessJournalDictionaryBootstrap,
		              ru.it.lecm.notifications.notifications-repo.notificationsTemplatesBootstrap,
                      ord.document.models.bootstrap,
					  businessJournalLogEventsPolicy,
                      documents.LogicEcmConnectionTypesBootstrap,
					  regNumbers.regNumbersTemplatesDicBootstrap"
		  p:dictionaries-ref="ord.dictionaries"
          />

	<bean id="ord.statemachine.bootstrap" parent="defaultStatemachines"
		  p:statemachineName="lecm-ord:document"
		  p:path="alfresco/module/${artifactId}/statemachine/lecm-ord-statemachine-default.xml"/>

	<util:list id="ord.taggedCounterRegistrator.tags">
		<value>project</value>
	</util:list>
	<bean id="ord.taggedCounterRegistrator"
		  parent="regNumbersTaggedCounterRegistrator"
		  depends-on="outgoing.model.bootstrap"
		  p:documentType="lecm-ord:document"
		  p:tags-ref="ord.taggedCounterRegistrator.tags"/>

	<bean id="ordReportsService" parent="baseBean"
		  class="ru.it.lecm.ord.ORDReportsServiceImpl"
		  p:reportsManager-ref="reportsManager"/>

	<!--service for various document utils-->
	<bean id="ordDocumentService" parent="baseBean"
		  class="ru.it.lecm.ord.ORDDocumentServiceImpl"
		  p:lecmDictionaryService-ref="serviceDictionary"
          p:documentService-ref="documentService"/>


        <bean id="ordCopySettings" class="ru.it.lecm.documents.beans.DocumentCopySettings">
        <property name="propsToCopy">
            <list>
                <value>lecm-document:title</value>
                <value>lecm-eds-document:summaryContent</value>
                <value>lecm-eds-document:note</value>
            </list>
        </property>
        <property name="assocsToCopy">
            <list>
                <value>lecm-eds-document:document-type-assoc</value>
                <value>lecm-document:subject-assoc</value>
                <value>lecm-eds-document:file-register-assoc</value>
                <value>lecm-ord:registrar-assoc</value> <!--??-->
                <value>lecm-ord:controller-assoc</value>
                <value>lecm-ord:canceled-assoc</value>
                <value>lecm-ord:accepted-assoc</value>
            </list>
        </property>
        <property name="categoriesToCopy">
            <list>
                <value>Документ</value>
            </list>
        </property>
        <property name="tableDataToCopy">
            <list>
                <value>lecm-ord-table-structure:itemsTable</value>
            </list>
        </property>

    </bean>
        <bean id="ordItemCopySettings" class="ru.it.lecm.documents.beans.DocumentCopySettings">
        <property name="propsToCopy">
            <list>
                <value>lecm-document:indexTableRow</value>
                <value>lecm-ord-table-structure:execution-date</value>
                <value>lecm-ord-table-structure:item-content</value>
                <value>lecm-ord-table-structure:item-comment</value>
            </list>
        </property>
        <property name="assocsToCopy">
            <list>
                <value>lecm-ord-table-structure:executor-assoc</value>
            </list>
        </property>
    </bean>

    <bean id="ordCopySettingsBean" parent="documentCopySettingsBean">
        <property name="settings">
            <map>
                <entry key="lecm-ord:document" value-ref="ordCopySettings"/>
                <entry key="lecm-ord-table-structure:item" value-ref="ordItemCopySettings"/>
            </map>
        </property>
    </bean>


	<!--notification-->
	<bean id="ordNotificationService" parent="baseBean"
		  class="ru.it.lecm.ord.ORDNotificationServiceImpl"
		  p:workCalendarService-ref="WorkCalendarService"
		  p:notificationsService-ref="notificationsService"/>

	<!--notification scheduler-->
	<bean id="ord.notification.schedule" class="ru.it.lecm.ord.scheduler.ORDNotificationScheduler"
          p:transactionMode="ISOLATED_TRANSACTIONS"
          p:compensatingActionMode="IGNORE"
          p:jobName="ord-notification"
          p:jobGroup="ord"
          p:triggerName="ord-notification-trigger"
          p:triggerGroup="ord-trigger"
          p:cronExpression="0 0 8/12 * * ? *"
          p:scheduler-ref="schedulerFactory"
          p:actionService-ref="ActionService"
          p:transactionService-ref="TransactionService"
          p:searchService-ref="searchService"
          p:runAsUser="System"/>

	<!--notification executor for scheduler-->
    <bean id="ordNotificationExecutor" class="ru.it.lecm.ord.scheduler.ORDNotificationExecutor" parent="action-executer"
          p:ignoreLock="false"
          p:publicAction="false"
		  p:ordNotificationService-ref="ordNotificationService"/>

	<util:list id="ord.groupOperations">
		<value>alfresco/module/${artifactId}/actions/create-ord-content.xml</value>
	</util:list>
	<bean parent="lecmDictionaryBootstrap" depends-on="groupActionsService"
		  p:rootPath="/Business platform/LECM/Сервис Групповые операции"
		  p:dictionaries-ref="ord.groupOperations"/>

    <bean id="ord.reports.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="reportsEditorService,reportsEditor.LogicEcmDictionariesBootstrap,
          reportsEditorOnCreateAssocsPolicy,reportsEditorTemplatePolicy,
          dataSourcePolicy,reportDescriptorPolicy">
        <property name="rootPath" value="/Business platform/LECM/Сервис Редактор Отчетов/Отчеты"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/reports/ord-content.xml</value>
                <value>alfresco/module/${artifactId}/reports/ord-reg-journal.xml</value>
            </list>
        </property>
        <property name="xmlImportListener" ref="ord.reportsDeployer"/>
    </bean>

    <bean id="ord.reportsDeployer" parent="reportsDeployer">
        <property name="reportsForDeploy">
            <list>
                <value>ord-content</value>
                <value>ord-reg-journal</value>
            </list>
        </property>
    </bean>


    <bean id="ord.ConfigToRepositoryLoader" parent="configsToRepositoryLoader">
        <property name="configs">
            <list>
                <value>alfresco/module/ord-repo/reports/configs/ords.properties</value>
            </list>
        </property>
    </bean>

    <bean parent="documentMessagesLoader">
        <property name="messages">
            <list>
                <value>alfresco/module/${artifactId}/messages/lecm-ord-document</value>
            </list>
        </property>
    </bean>

</beans>
