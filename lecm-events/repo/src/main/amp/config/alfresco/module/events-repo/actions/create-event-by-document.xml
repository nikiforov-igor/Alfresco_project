<?xml version='1.0' encoding='UTF-8'?>
<items updateMode="CreateOrUpdate">
    <item name="cm:Создать мероприятие по документу" type="lecm-group-actions:script-action">
        <property name="cm:name"><![CDATA[Создать мероприятие по документу]]></property>
        <property name="lecm-group-actions:statuses"><![CDATA[]]></property>
        <property name="lecm-group-actions:type"><![CDATA[]]></property>
        <property name="lecm-group-actions:order"><![CDATA[0]]></property>
        <property name="lecm-group-actions:expression"><![CDATA[doc.attr("lecm-statemachine:status") != "Удален"]]></property>
        <property name="lecm-group-actions:isGroup"><![CDATA[false]]></property>
        <property name="lecm-group-actions:forCollection"><![CDATA[false]]></property>
        <property name="cm:title"><![CDATA[Создать мероприятие по документу]]></property>
        <property name="lecm-group-actions:script"><![CDATA[if (document != null) {
    var params = 'documentType=lecm-events:document&formId=workflow-form&connectionType=eventOnBasis&connectionIsSystem=true&parentDocumentNodeRef=' + document.nodeRef.toString();

    var encodeParams = Packages.org.apache.commons.codec.binary.Base64.encodeBase64String(new java.lang.String(params).getBytes());
    model.redirect = 'event-create?documentType=lecm-events:document&p1=' + encodeURIComponent(encodeParams) + '&p2=' + encodeURIComponent(hashCode(params));
}

function hashCode(str) {
    var hash = 0, i, chr, len;
    if (str.length == 0) return hash;
    for (i = 0, len = str.length; i < len; i++) {
        chr   = str.charCodeAt(i);
        hash  = ((hash << 5) - hash) + chr;
        hash |= 0; // Convert to 32bit integer
    }
    return hash;
}]]></property>
    </item>
</items>