<?xml version='1.0' encoding='UTF-8'?>
<items updateMode="CreateOrUpdate">
    <item name="cm:Принять приглашение" type="lecm-group-actions:script-action">
        <property name="cm:name"><![CDATA[Принять приглашение]]></property>
        <property name="lecm-group-actions:statuses"><![CDATA[]]></property>
        <property name="lecm-group-actions:type"><![CDATA[[lecm-events:document]]]></property>
        <property name="lecm-group-actions:order"><![CDATA[0]]></property>
        <property
                name="lecm-group-actions:expression"><![CDATA[user.currentUser().hasDynamicBusinessRole(doc.getNodeRef(), "EVENTS_MEMBER_DYN") AND (@eventsService.getCurrentEmployeeMemberStatus(doc.getNodeRef()).equals("EMPTY") OR @eventsService.getCurrentEmployeeMemberStatus(doc.getNodeRef()).equals("DECLINED"))]]></property>
        <property name="lecm-group-actions:isGroup"><![CDATA[false]]></property>
        <property name="lecm-group-actions:forCollection"><![CDATA[false]]></property>
        <property name="lecm-group-actions:script"><![CDATA[var memberRow = events.getCurrentEmployeeEventMemberRow(document);
if (memberRow != null) {
	memberRow.properties["lecm-events-ts:members-status"] = "CONFIRMED";
	memberRow.save();

	var currentEmployee = orgstructure.getCurrentEmployee();
	var initiator = document.assocs["lecm-events:initiator-assoc"][0];
	if (currentEmployee != null && initiator != null) {
		var notificationText = "Сотрудник ";
		notificationText += documentScript.wrapperLink(currentEmployee, currentEmployee.properties["lecm-orgstr:employee-short-name"]);
		notificationText += " подтвердил свое участие в мероприятии ";
		notificationText += documentScript.wrapperDocumentLink(document, "{lecm-events:title}");

		var fromDate = document.properties["lecm-events:from-date"];
		if (fromDate != null) {
			var dateFormat = new Packages.java.text.SimpleDateFormat("dd.MM.yyyy");
			var timeFormat = new Packages.java.text.SimpleDateFormat("HH-mm");
			var date = new java.util.Date(fromDate.getTime());

			notificationText += " Начало: ";
			notificationText += dateFormat.format(date);
			notificationText += ", в ";
			notificationText += timeFormat.format(date);
		}

		var recipients = [];
		recipients.push(initiator);
		notifications.sendNotificationFromCurrentUser(recipients, notificationText, document);
	}
}]]></property>
    </item>
</items>