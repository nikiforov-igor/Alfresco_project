<?xml version="1.0" encoding="UTF-8"?>
<!-- xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd" -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- Registration of Delegations models -->
	<bean id="${groupId}.${artifactId}.securityBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap">
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/security</value>
			</list>
		</property>
	</bean>

	<!--  регистрируем свою часть подсистемы безопасности "Гуппы полномочий" -->
	<bean id="lecmModuleSecurePermissionModelBootstrap" parent="permissionModelBootstrap" depends-on="documents.LogicEcmModelsBootstrap">
		<property name="model">
			<value>alfresco/module/${artifactId}/alfresco/model/lecm/lecmPermissionDefinitions.xml</value>
		</property>
    </bean>


	<bean id="lecmSecurityGroupsBean" class="ru.it.lecm.security.beans.LECMSecurityGroupsBean" depends-on="lecmModuleSecurePermissionModelBootstrap">
		<property name="authorityService" ref="authorityService" />
		<property name="nodeService" ref="nodeService" />
		<property name="sVAspect" value="#{'${lecm.security.ou_sv.aspect}' == '$'+'{lecm.security.ou_sv.aspect}' ? null : '${lecm.security.ou_sv.aspect}'}"/>
		<property name="allowOUSV" value="#{'${lecm.security.allow.ou_sv}' == '$'+'{lecm.security.allow.ou_sv}' ? false : '${lecm.security.allow.ou_sv}'}"/>
		<property name="safeMode" value="true" />
		<!--
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="repositoryHelper" ref="repositoryHelper"/>
		  -->
	</bean>

	<bean id="lecmPermissionServiceBean" class="ru.it.lecm.security.beans.LecmPermissionServiceImpl"
			depends-on="lecmModuleSecurePermissionModelBootstrap">

		<property name="nodeService" ref="nodeService" />
		<property name="permissionService" ref="permissionService" />
		<property name="authorityService" ref="authorityService" />
		<property name="authService" ref="authenticationService"/>
		<property name="orgStructureNotifiers" ref="lecmSecurityGroupsBean" />
		<property name="orgstructureService" ref="serviceOrgstructure"/>

		<property name="modelDAOService" ref="permissionsModelDAO" />

		<!-- Наследование родительских прав для случая статики и динамики:
			по-умолчанию: статика НЕ наследует (false), динамика Наследует (true)
		  -->
		<property name="staticInheritParentPermissions" value="false" />
		<property name="dynamicInheritParentPermissions" value="true" />
	</bean>

    <bean id="permissionScript" parent="baseJavaScriptExtension" class="ru.it.lecm.security.script.LecmPermissionWebScript">
        <property name="extensionName">
            <value>lecmPermission</value>
        </property>
        <property name="authService" ref="authenticationService"/>
        <property name="authorityService" ref="authorityService"/>
        <property name="lecmPermissionService" ref="lecmPermissionServiceBean"/>
        <property name="orgstructureService" ref="serviceOrgstructure"/>
	    <property name="serviceRegistry" ref="ServiceRegistry" />
    </bean>
</beans>
