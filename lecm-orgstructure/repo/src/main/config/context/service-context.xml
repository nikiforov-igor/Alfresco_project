<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
	<!-- Registration of orgStructure models -->
	<bean id="${groupId}.${artifactId}.orgStructureBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary, ru.it.lecm.orgstructure.orgstructure-repo.orgDictionaryBootstrap, ru.it.lecm.subscriptions.subscriptions-repo.subscriptionsAspectBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalAspectBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/orgstructure</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.orgDictionaryBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-docTypes-model.xml</value>
			</list>
		</property>
	</bean>

	<!--
		"createOrUpdateDictionaries": создаёт или обновляет словарь Бизнес-ролей
		для создания надо иметь поднятой политику orgstructureBusinessRolePolicy
		а вот для "update" - все, которые работают с БР, должностями, подразделениями и сотрудниками.
	  -->
	<bean id="${groupId}.${artifactId}.orgBootstrap" parent="lecmDictionaryBootstrap"
		depends-on="businessJournalLogEventsPolicy, orgstructureBusinessRolePolicy, orgstructureBossPolicy
			, orgstructurePrimaryPositionPolicy, orgstructureEmployeePolicy, orgstructureEmployeeLinkPolicy
			, orgstructureUnitPolicy, orgstructureStaffListPolicy, orgstructureOrganizationPolicy
			, orgstructureStaffPositionPolicy, orgstructureWorkGroupPolicy, orgstructureWorkForcePolicy
		">

		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-roles.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-positions.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-docTypes.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-business-roles.xml</value>
			</list>
		</property>
		<property name="createOrUpdateDictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-business-roles-items.xml</value>
                <value>alfresco/module/${artifactId}/models/lecm-orgstructure-docTypes.xml</value>
			</list>
		</property>
	</bean>

	<bean id="orgstructureScript" parent="baseJavaScriptExtension" class="ru.it.lecm.orgstructure.scripts.OrgstructureWebScriptBean"
		  depends-on="serviceOrgstructure">
		<property name="extensionName">
			<value>orgstructure</value>
		</property>
		<property name="serviceRegistry">
			<ref bean="ServiceRegistry"/>
		</property>
		<property name="orgstructureService">
			<ref bean="serviceOrgstructure"/>
		</property>
		<property name="dictionaryService" ref="serviceDictionary"/>
	</bean>

	<util:constant id="ORGANIZATION_ROOT_ID" static-field="ru.it.lecm.orgstructure.beans.OrgstructureBeanImpl.ORGANIZATION_ROOT_ID"/>

	<bean id="serviceOrgstructure" class="ru.it.lecm.orgstructure.beans.OrgstructureBeanImpl" init-method="init" parent="baseBean"
		  depends-on="${groupId}.${artifactId}.orgStructureBootstrap">
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="personService" ref="personService"/>
		<property name="authService" ref="authenticationService"/>
		<property name="dictionaryService" ref="serviceDictionary"/>
		<property name="folders">
			<map>
				<entry key="#{ORGANIZATION_ROOT_ID}" value="Сервис Структура организации и сотрудников"/>
			</map>
		</property>
	</bean>

	<bean id="orgstructureSGNotifierBean" class="ru.it.lecm.orgstructure.beans.OrgstructureSGNotifierBeanImpl" init-method="init">
		<property name="authService" ref="authenticationService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="sgNotifier" ref="lecmSecurityGroupsBean" />
		<property name="orgstructureService" ref="serviceOrgstructure"/>
	</bean>

	<bean id="orgstructureBossPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureBossPolicy"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
	</bean>

	<bean id="orgstructureBusinessRolePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureBusinessRolePolicy"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
	</bean>

	<bean id="orgstructurePrimaryPositionPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructurePrimaryPositionPolicy"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<!-- <property name="orgSGNotifier" ref="orgstructureSGNotifierBean" /> -->
	</bean>

	<bean id="orgstructureEmployeePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureEmployeePolicy"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
		<property name="businessJournalService" ref="businessJournalService"/>
	</bean>

	<bean id="orgstructureEmployeeLinkPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureEmployeeLinkPolicy"
		  init-method="init" depends-on="lecmSecurityGroupsBean">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
		<property name="businessJournalService" ref="businessJournalService"/>
	</bean>


	<bean id="orgstructureUnitPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureUnitPolicy"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="authService" ref="authenticationService"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
	</bean>

	<bean id="orgstructureStaffListPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureStaffListPolicy"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
		<property name="businessJournalService" ref="businessJournalService"/>
	</bean>

	<bean id="orgstructureOrganizationPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureOrganizationPolicy"
		init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="businessJournalService" ref="businessJournalService" />
	</bean>

	<bean id="orgstructureStaffPositionPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureStaffPositionPolicy"
		init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
		<property name="businessJournalService" ref="businessJournalService"/>
	</bean>

	<bean id="orgstructureWorkGroupPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureWorkGroupPolicy"
		init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="orgstructureService" ref="serviceOrgstructure" />
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
		<property name="businessJournalService" ref="businessJournalService" />
	</bean>

	<bean id="orgstructureWorkForcePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureWorkForcePolicy"
		init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="orgstructureService" ref="serviceOrgstructure" />
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean" />
		<property name="businessJournalService" ref="businessJournalService" />
	</bean>
</beans>
