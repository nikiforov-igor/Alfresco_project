<?xml version='1.0' encoding='UTF-8'?>
<items updateMode="CreateOrUpdate">
    <item name="cm:Мероприятие. Удалить" type="lecm-group-actions:script-action">
        <property name="cm:name"><![CDATA[Мероприятие. Удалить]]></property>
        <property name="lecm-group-actions:statuses"><![CDATA[]]></property>
        <property name="lecm-group-actions:type"><![CDATA[[lecm-events:document]]]></property>
        <property name="lecm-group-actions:order"><![CDATA[0]]></property>
        <property name="lecm-group-actions:expression">
            <![CDATA[(user.currentUser().hasDynamicBusinessRole(doc.getNodeRef(), "BR_INITIATOR") OR user.currentUser().hasDynamicBusinessRole(doc.getNodeRef(), "EVENTS_INITIATOR_DYN")) AND doc.attr("lecm-events:repeatable") == false AND doc.attr("lecm-events:removed") == false]]></property>
        <property name="lecm-group-actions:isGroup"><![CDATA[false]]></property>
        <property name="lecm-group-actions:forCollection"><![CDATA[false]]></property>
        <property name="cm:title"><![CDATA[Удалить]]></property>
        <property name="lecm-group-actions:script"><![CDATA[var toDate = document.properties["lecm-events:to-date"];
document.properties["lecm-events:removed"] = true;
document.save();

if (toDate.getTime() >= new Date().getTime()) {
			events.sendCancelNotifications(document);
}]]></property>
    </item>
</items>