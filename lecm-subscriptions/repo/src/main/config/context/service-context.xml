<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
	<!-- Registration of orgStructure models -->
	<bean id="${groupId}.${artifactId}.subscriptionsBootstrap" parent="dictionaryModelBootstrap"
	      depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap, ru.it.lecm.notifications.notifications-repo.notificationsDictionaryBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-subscriptions-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/subscriptions</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.subscriptionsDictionaryBootstrap" parent="lecmDictionaryBootstrap"
	      depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-subscriptions-roles-items.xml</value>
			</list>
		</property>
	</bean>

	<!-- Registration of subscriptions aspects models -->
	<bean id="${groupId}.${artifactId}.subscriptionsAspectBootstrap" parent="dictionaryModelBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-subscriptions-aspects-model.xml</value>
			</list>
		</property>
	</bean>

	<bean id="subscriptionScript" parent="baseScript"
	      class="ru.it.lecm.subscriptions.scripts.SubscriptionsWebScriptBean"
	      depends-on="subscriptionsService">
		<property name="extensionName">
			<value>subscription</value>
		</property>
		<property name="repositoryHelper">
			<ref bean="repositoryHelper"/>
		</property>
		<property name="subscriptionsService">
			<ref bean="subscriptionsService"/>
		</property>
	</bean>

	<util:constant id="SUBSCRIPTIONS_ROOT_ID" static-field="ru.it.lecm.subscriptions.beans.SubscriptionsService.SUBSCRIPTIONS_ROOT_ID"/>
	<util:constant id="SUBSCRIPTIONS_ROOT_NAME" static-field="ru.it.lecm.subscriptions.beans.SubscriptionsService.SUBSCRIPTIONS_ROOT_NAME"/>

	<bean id="subscriptionsService" class="ru.it.lecm.subscriptions.beans.SubscriptionsServiceImpl" parent="baseBean"
	      depends-on="nodeService, serviceOrgstructure, businessJournalService">
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="folders">
			<map>
				<entry key="#{SUBSCRIPTIONS_ROOT_ID}" value="#{SUBSCRIPTIONS_ROOT_NAME}"/>
			</map>
		</property>
	</bean>

	<bean id="businessJournalSchedule" class="ru.it.lecm.subscriptions.schedule.BusinessJournalSchedule">
		<property name="transactionMode">
			<value>ISOLATED_TRANSACTIONS</value>
		</property>
		<property name="compensatingActionMode">
			<value>IGNORE</value>
		</property>
		<property name="searchService">
			<ref bean="SearchService"/>
		</property>
		<property name="nodeService">
			<ref bean="nodeService"/>
		</property>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="cronExpression">
			<value>0 0/1 * * * ?</value>
		</property>
		<property name="jobName">
			<value>receive-journal</value>
		</property>
		<property name="jobGroup">
			<value>subscribe</value>
		</property>
		<property name="triggerName">
			<value>receive-journal-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>subscribe-trigger</value>
		</property>
		<property name="scheduler">
			<ref bean="schedulerFactory"/>
		</property>
		<property name="actionService">
			<ref bean="ActionService"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
        <property name="orgstructureService" ref="serviceOrgstructure"/>
        <property name="subscriptionsService">
            <ref bean="subscriptionsService"/>
        </property>
        <property name="notificationsService">
            <ref bean="notificationsService"/>
        </property>
        <property name="transactionService">
			<ref bean="TransactionService"/>
		</property>
		<property name="runAsUser">
			<value>System</value>
		</property>
	</bean>

	<bean id="businessJournalScheduleExecutor" class="ru.it.lecm.subscriptions.schedule.BusinessJournalScheduleExecutor" parent="action-executer">
		<property name="nodeService">
			<ref bean="NodeService" />
		</property>
		<property name="subscriptionsService">
			<ref bean="subscriptionsService"/>
		</property>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="notificationsService">
			<ref bean="notificationsService"/>
		</property>
		<property name="searchService">
			<ref bean="SearchService"/>
		</property>
		<property name="orgstructureService">
			<ref bean="serviceOrgstructure"/>
		</property>
		<property name="ignoreLock">
			<value>false</value>
		</property>
	</bean>

	<bean id="subscriptionToTypeOnCreateAssocsPolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsOnCreateAssocsPolicy"
	      init-method="init" parent="logicEcmAssociationPolicy"/>

	<bean id="subscriptionsToObjectLogEventsPolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsToObjectLogEventsPolicy"
	      init-method="init">
		<property name="policyComponent">
			<ref bean="policyComponent"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
		<property name="orgstructureService">
			<ref bean="serviceOrgstructure"/>
		</property>
	</bean>

	<bean id="subscriptionsToTypeLogEventsEmployeePolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsToTypeLogEventEmployeePolicy"
	      init-method="init">
		<property name="policyComponent">
			<ref bean="policyComponent"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
	</bean>

	<bean id="subscriptionsToTypeLogEventsWorkGroupPolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsToTypeLogEventWorkGroupPolicy"
	      init-method="init">
		<property name="policyComponent">
			<ref bean="policyComponent"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
	</bean>

	<bean id="subscriptionsToTypeLogEventBusinessRolePolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsToTypeLogEventBusinessRolePolicy"
	      init-method="init">
		<property name="policyComponent">
			<ref bean="policyComponent"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
	</bean>

	<bean id="subscriptionsToTypeLogEventsOrganizationUnitPolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsToTypeLogEventOrganizationUnitPolicy"
		init-method="init">
		<property name="policyComponent">
			<ref bean="policyComponent"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
	</bean>

	<bean id="subscriptionsToTypeLogEventsPolicy" class="ru.it.lecm.subscriptions.policy.SubscriptionsToTypeLogEventPolicy"
	      init-method="init">
		<property name="policyComponent">
			<ref bean="policyComponent"/>
		</property>
		<property name="businessJournalService">
			<ref bean="businessJournalService"/>
		</property>
		<property name="nodeService">
			<ref bean="nodeService"/>
		</property>
	</bean>
</beans>
