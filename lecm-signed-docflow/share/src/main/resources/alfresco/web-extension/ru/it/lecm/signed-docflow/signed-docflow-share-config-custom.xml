<?xml version='1.0' encoding='UTF-8'?>
<alfresco-config>

	<config>
		<forms>
			<dependencies>
				<js src="/scripts/signed-docflow/signs-short-form.js"/>
				<js src="/scripts/signed-docflow/signs-all-form.js"/>
			</dependencies>
			<form id="signs-info-short">
				<create-form template="/ru/it/lecm/signed/docflow/forms/signs-short-form.ftl"/>
			</form>
			<form id="signs-info-all">
				<create-form template="/ru/it/lecm/signed/docflow/forms/signs-all-form.ftl"/>
			</form>
		</forms>
	</config>

	<config evaluator="node-type" condition="lecm-signed-docflow:sign">
		<forms>
			<form>
				<field-visibility>
					<show id="lecm-signed-docflow:owner"/>
					<show id="lecm-signed-docflow:owner-position"/>
					<show id="lecm-signed-docflow:owner-organization"/>
					<show id="lecm-signed-docflow:signing-date"/>
					<show id="lecm-signed-docflow:serial-number"/>
					<show id="lecm-signed-docflow:valid-from"/>
					<show id="lecm-signed-docflow:valid-through"/>
					<show id="lecm-signed-docflow:ca"/>
					<show id="lecm-signed-docflow:update-date"/>
					<show id="lecm-signed-docflow:is-valid"/>
					<show id="lecm-signed-docflow:is-our"/>
				</field-visibility>
			</form>
		</forms>
	</config>

	<config evaluator="string-compare" condition="DocumentLibrary">
		<aspects>
			<visible>
				<aspect name="lecm-signed-docflow:signable"/>
			</visible>
		</aspects>
	</config>

	<config evaluator="aspect" condition="lecm-signed-docflow:organization-attrs-aspect">
		<forms>
			<form>
				<field-visibility>
					<show id="lecm-signed-docflow:operator-code" for-mode="view,edit,create"/>
					<show id="lecm-signed-docflow:partner-key" for-mode="view,edit,create"/>
					<show id="lecm-signed-docflow:applet-key" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:applet-cert" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:applet-container" for-mode="edit,create"/>
				</field-visibility>
				<appearance>
					<set id="sign" appearance="" label-id="info.sign" />
					<field id="lecm-signed-docflow:operator-code" set="sign"/>
					<field id="lecm-signed-docflow:partner-key" set="sign"/>
					<field id="lecm-signed-docflow:applet-key" set="sign">
						<control template="/org/alfresco/components/form/controls/textarea.ftl">
							<control-param name="rows">3</control-param>
						</control>
					</field>
					<field id="lecm-signed-docflow:applet-cert" set="sign">
						<control template="/org/alfresco/components/form/controls/textarea.ftl">
							<control-param name="columns">120</control-param>
							<control-param name="rows">14</control-param>
						</control>
					</field>
					<field id="lecm-signed-docflow:applet-container" set="sign"/>
				</appearance>
			</form>
		</forms>
	</config>

	<!-- Конфиг для апплета АйТиШтамп -->
	<config>
		<forms>
			<dependencies>
				<js src="/scripts/signed-docflow/signApplet.js" />
				<!-- JS для регистрации action'а "Разблокировать документ, 
				добавлен сюда, ибо иначе на странице вложения не цепляется-->
				<js src="/scripts/signed-docflow/document-unlock.js" />
			</dependencies>
			<form id="auth-form">
				<create-form template="/ru/it/lecm/signed/docflow/forms/auth-form.ftl" />
			</form>
			<form id="multiple-sign-form">
				<create-form template="/ru/it/lecm/signed/docflow/forms/multiple-sign-form.ftl" />
			</form>
		</forms>
	</config>
	<!-- Добавление action'a "Разблокировать документа" -->	
	<config evaluator="string-compare" condition="DocLibActions">
		<actions>		
			<action id="document-unlock" type="javascript" label="actions.document.unlock">				
				<param name="function">onUnlockAction</param>
				<evaluator>evaluator.lecm.signed.docflow.showUnlockButton</evaluator>
			</action>
			<action id="document-upload-new-version" type="javascript" label="actions.document.upload-new-version">
				<param name="function">onActionUploadNewVersion</param>
				<permissions>
					<permission allow="true">Write</permission>
				</permissions>
				<evaluator>evaluator.lecm.signed.docflow.showNewVersionButton</evaluator>
			</action>
		</actions>
		<actionGroups>
			<actionGroup id="document-details">
				<action index="101" id="document-unlock" />
			</actionGroup>
			<actionGroup id="document-browse">
				<action index="101" id="document-unlock" />
			</actionGroup>
		</actionGroups>
	</config>	
</alfresco-config>