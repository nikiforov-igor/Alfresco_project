<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
	<bean id="${groupId}.${artifactId}.notificationsBootstrap" parent="dictionaryModelBootstrap"
	      depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap, ru.it.lecm.notifications.notifications-repo.notificationsDictionaryBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-model.xml</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.notificationsDictionaryBootstrap" parent="dictionaryModelBootstrap"
	      depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap, dictionaryBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-type-model.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-template-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/notifications_type</value>
				<value>alfresco/module/${artifactId}/messages/notifications_template</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.notificationsSettingsBootstrap" parent="dictionaryModelBootstrap"
	      depends-on="${groupId}.${artifactId}.notificationsDictionaryBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-settings-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/notifications_settings</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.notificationsTypesBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="businessJournalLogEventsPolicy,ru.it.lecm.notifications.notifications-repo.notificationsBootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-type.xml</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.notificationsTemplatesBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap,businessJournalLogEventsPolicy,ru.it.lecm.notifications.notifications-repo.notificationsBootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-notifications-templates-dic.xml</value>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-notifications-event-categories.xml</value>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-notification-objectType-items.xml</value>
			</list>
		</property>
	</bean>

	<bean id="notifications.arm.myProfile.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
	      depends-on="userProfile.arm.LogicEcmBootstrap">
		<property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/arm/default-arm-my-profile-items.xml</value>
			</list>
		</property>
	</bean>

	<bean id="notifications.arm.send-settings.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="arm.settings.LogicEcmBootstrap">
		<property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/arm/notifications-send-settings-arm.xml</value>
			</list>
		</property>
	</bean>

	<util:constant id="NOTIFICATIONS_ROOT_ID" static-field="ru.it.lecm.notifications.beans.NotificationsService.NOTIFICATIONS_ROOT_ID"/>
	<util:constant id="NOTIFICATIONS_ROOT_NAME" static-field="ru.it.lecm.notifications.beans.NotificationsService.NOTIFICATIONS_ROOT_NAME"/>

	<util:constant id="NOTIFICATIONS_GENERALIZATION_ROOT_ID" static-field="ru.it.lecm.notifications.beans.NotificationsService.NOTIFICATIONS_GENERALIZATION_ROOT_ID"/>
	<util:constant id="NOTIFICATIONS_GENERALIZATION_ROOT_NAME" static-field="ru.it.lecm.notifications.beans.NotificationsService.NOTIFICATIONS_GENERALIZATION_ROOT_NAME"/>

	<bean id="notificationsAsyncThreadPool" class="org.alfresco.util.ThreadPoolExecutorFactoryBean">
		<property name="poolName">
			<value>notificationsAsyncAction</value>
		</property>
		<property name="corePoolSize">
			<value>8</value>
		</property>
		<property name="maximumPoolSize">
			<value>20</value>
		</property>
		<property name="threadPriority">
			<value>5</value>
		</property>
	</bean>

	<bean id="notificationsService" init-method="init" class="ru.it.lecm.notifications.beans.NotificationsServiceImpl" parent="baseBean"
                depends-on="ServiceRegistry,
                            repositoryHelper,
                            serviceOrgstructure,
                            substitudeService,
                            nodeService,
                            transactionService,
                            lecmPermissionServiceBean,
                            serviceDictionary,
                            ${groupId}.${artifactId}.notificationsSettingsBootstrap"
        >
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="lecmPermissionService" ref="lecmPermissionServiceBean"/>
		<property name="dictionaryService" ref="serviceDictionary"/>
		<property name="substituteService" ref="substitudeService"/>
		<property name="threadPoolExecutor" ref="notificationsAsyncThreadPool"/>
		<property name="secretaryService" ref="secretaryService"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="fileFolderService" ref="fileFolderService"/>
		<property name="defaultEmailTemplatePath" value="${notifications.notificationsService.defaultEmailTemplatePath}"/>
		<!-- Автоматическое создание каталогов. -->
		<property name="folders">
			<map>
				<entry key="#{NOTIFICATIONS_ROOT_ID}" value="#{NOTIFICATIONS_ROOT_NAME}"/>
				<entry key="#{NOTIFICATIONS_GENERALIZATION_ROOT_ID}" value="#{NOTIFICATIONS_ROOT_NAME}/#{NOTIFICATIONS_GENERALIZATION_ROOT_NAME}"/>
			</map>
		</property>
	</bean>

	<bean id="notificationScript" parent="baseScript" class="ru.it.lecm.notifications.scripts.NotificationsWebScriptBean"
	      depends-on="notificationsService">
                <property name="lecmTransactionHelper" ref="lecmTransactionHelper"/>
		<property name="extensionName">
			<value>notifications</value>
		</property>
		<property name="service">
			<ref bean="notificationsService"/>
		</property>
		<property name="orgstructureService">
			<ref bean="serviceOrgstructure"/>
		</property>
		<property name="authService">
			<ref bean="authenticationService"/>
		</property>
		<property name="transactionService">
			<ref bean="transactionService"/>
		</property>
	</bean>

    <bean id="notifications.exportSettingsInitializer" parent="dictionary.exportSettingsInitializer" class="ru.it.lecm.dictionary.beans.ExportSettingsInitializerBean">
        <constructor-arg>
            <map>
                <entry key="lecm-notf-type:notification-type">
                    <list>
                        <value>cm:name</value>
                        <value>cm:title</value>
                        <value>lecm-notf-type:code</value>
                        <value>lecm-notf-type:spring-bean-id</value>
                        <value>lecm-notf-type:default-select</value>
                    </list>
                </entry>
            </map>
        </constructor-arg>
    </bean>

	<bean id="notificationTemplateBootstrap" parent="spacesStoreImporter">
		<property name="useExistingStore" value="true"/>
		<property name="bootstrapViews">
			<list>
				<props>
					<prop key="uuidBinding">UPDATE_EXISTING</prop>
					<prop key="path">/${spaces.company_home.childname}/${spaces.dictionary.childname}/${spaces.templates.email.childname}</prop>
					<prop key="location">alfresco/module/${artifactId}/bootstrap/defaultEmailNotificationTemplate.xml</prop>
					<prop key="messages">alfresco/messages/bootstrap-spaces</prop>
				</props>
			</list>
		</property>
	</bean>

	<bean id="notificationOnCreateExclusionPolicy" class="ru.it.lecm.notifications.policies.NotificationOnCreateExclusionPolicy"
		  parent="baseBean"
		  depends-on="${groupId}.${artifactId}.notificationsDictionaryBootstrap" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="orgstructureBean" ref="serviceOrgstructure"/>
	</bean>

	<bean id="notificationsOnCreateAssociationsPolicy" class="ru.it.lecm.notifications.policies.TemplatesOnCreateAssociationPolicy"
		  init-method="init" parent="logicEcmAssociationPolicy"/>
</beans>
