<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<util:list id="approve3.dictionaries">
		<value>alfresco/module/${artifactId}/dictionaries/lecm-approval-br-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-approval-event-category-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-approval-nt-items.xml</value>
	</util:list>

	<bean id="approve3.dictionary.bootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap,
					  ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap,
					  ru.it.lecm.notifications.notifications-repo.notificationsTemplatesBootstrap,
					  businessJournalLogEventsPolicy"
		  p:dictionaries-ref="approve3.dictionaries"/>

	<util:list id="approve3.helper.models">
		<value>alfresco/module/${artifactId}/models/lecm-approval-decision-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-approval-aspects-model.xml</value>
	</util:list>

	<util:list id="approve3.helper.labels">
		<value>alfresco/module/${artifactId}/messages/lecm-approval-decision-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-approval-aspects-model</value>
	</util:list>

	<bean id="lecm.approval3.helper.model.bootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap"
		  p:models-ref="approve3.helper.models"
		  p:labels-ref="approve3.helper.labels"/>

	<util:list id="approve3.models">
		<value>alfresco/module/${artifactId}/models/lecm-approval-global-settings-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-approval-model.xml</value>
	</util:list>

	<util:list id="approve3.labels">
		<value>alfresco/module/${artifactId}/messages/lecm-approval-global-settings-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-approval-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-approval-workflow</value>
	</util:list>
	
	<bean id="lecm.approve3.model.bootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, lecm.approval3.helper.model.bootstrap"
		  p:models-ref="approve3.models"
		  p:labels-ref="approve3.labels"/>

	<util:list id="approve3.arm.dictionaries">
		<value>alfresco/module/${artifactId}/arm/approval-settings-arm.xml</value>
	</util:list>
	<bean id="approve3.arm.bootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="eds.documents.arm.settings.LogicEcmBootstrap"
		  p:rootPath="/Business platform/LECM/Сервис АРМ/Настройки АРМ/Администрирование/Настройки СЭД"
		  p:dictionaries-ref="approve3.arm.dictionaries"/>

	<util:constant id="ENGINE_ID" static-field="org.alfresco.repo.workflow.WorkflowDeployer.ENGINE_ID"/>
	<util:constant id="LOCATION" static-field="org.alfresco.repo.workflow.WorkflowDeployer.LOCATION"/>
	<util:constant id="MIMETYPE" static-field="org.alfresco.repo.workflow.WorkflowDeployer.MIMETYPE"/>
	<util:constant id="REDEPLOY" static-field="org.alfresco.repo.workflow.WorkflowDeployer.REDEPLOY"/>
	<util:list id="approval3.workflows">
		<props>
			<prop key="#{ENGINE_ID}">activiti</prop>
			<prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/approval-workflow.bpmn20.xml</prop>
			<prop key="#{MIMETYPE}">text/xml</prop>
			<prop key="#{REDEPLOY}">${redeploy.process.definitions}</prop>
		</props>
	</util:list>

	<bean id="lecm.approval3.workflow.bootstrap" parent="workflowDeployer"
		  depends-on="lecm.approve3.model.bootstrap"
		  p:workflowDefinitions-ref="approval3.workflows"/>

	<util:constant id="approvalFolder" static-field="ru.it.lecm.workflow.approval.ApprovalServiceImpl.APPROVAL_FOLDER"/>
	<util:map id="approval.folders">
		<entry key="#{approvalFolder}" value="Сервис Согласование документов"/>
	</util:map>
	<bean id="approvalWorkflowService" parent="baseBean" init-method="init"
		  class="ru.it.lecm.workflow.approval.ApprovalServiceImpl"
		  depends-on="lecm.approve3.model.bootstrap"
		  p:defaultApprovalTerm="#{T(org.apache.commons.lang.math.NumberUtils).isNumber('${lecm.approval.defaultTerm}') ? T(java.lang.Integer).parseInt('${lecm.approval.defaultTerm}') : null}"
		  p:documentService-ref="documentService"
		  p:attachmentsService-ref="documentAttachmentsService"
		  p:contentService-ref="contentService"
		  p:folders-ref="approval.folders"/>
</beans>
