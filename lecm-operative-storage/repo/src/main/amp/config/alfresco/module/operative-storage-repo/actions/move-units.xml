<?xml version='1.0' encoding='UTF-8' ?>
<items>
    <item name="cm:Перемещение раздела номенклатуры дел" type="lecm-group-actions:script-action">
        <property name="cm:name">
            <![CDATA[Перемещение раздела номенклатуры дел]]>
        </property>
        <property name="cm:title">
            <![CDATA[Перемещение раздела номенклатуры дел]]>
        </property>
        <property name="lecm-group-actions:statuses">
            <![CDATA[]]>
        </property>
        <property name="lecm-group-actions:type">
            <![CDATA[lecm-os:nomenclature-unit-section]]>
        </property>
        <property name="lecm-group-actions:order">
            <![CDATA[0]]>
        </property>
        <property name="lecm-group-actions:expression">
            <![CDATA[]]>
        </property>
        <property name="lecm-group-actions:isGroup">
            <![CDATA[true]]>
        </property>
        <property name="lecm-group-actions:forCollection">
            <![CDATA[false]]>
        </property>
        <property name="lecm-group-actions:script">
            <![CDATA[(function() {
           function updateYearSection(obj, newYearRef) {
                if (obj.typeShort == 'lecm-os:nomenclature-case') {
                    var oldYearRef = obj.assocs["lecm-os:nomenclature-case-year-assoc"][0];
                    obj.removeAssociation(oldYearRef, "lecm-os:nomenclature-case-year-assoc");
                    obj.createAssociation(newYearRef, "lecm-os:nomenclature-case-year-assoc");
                } else {
                    var childs = obj.children;
                    for each (var child in childs) {
                        updateYearSection(child, newYearRef);
                    }
                }
            }
            var newYearSection = operativeStorage.getYearSection(folder);
            document.move(folder);
            updateYearSection(document, newYearSection);
            var logText = "Перемещение раздела номенклатуры дел";
            businessJournal.log(document.nodeRef.toString(), "OS_MOVE", logText, []);
})();]]>
        </property>
        <items>
			<item name="cm:folder" type="lecm-group-actions:form-field">
				<property name="cm:name"><![CDATA[Раздел]]></property>
				<property name="lecm-group-actions:field-default-value"><![CDATA[]]></property>
				<property name="lecm-group-actions:field-id"><![CDATA[folder]]></property>
				<property name="lecm-group-actions:field-is-mandatory"><![CDATA[true]]></property>
				<property name="lecm-group-actions:field-type"><![CDATA[lecm-os:base_copy_action]]></property>
				<property name="lecm-group-actions:field-priority"><![CDATA[0]]></property>
			</item>
			<item name="cm:Script" type="lecm-group-actions:form-field">
				<property name="cm:name"><![CDATA[Script]]></property>
				<property name="lecm-group-actions:field-default-value"><![CDATA[]]></property>
				<property name="lecm-group-actions:field-id"><![CDATA[Script]]></property>
				<property name="lecm-group-actions:field-is-mandatory"><![CDATA[false]]></property>
				<property name="lecm-group-actions:field-type"><![CDATA[lecm-os:copy-unit-validate-script]]></property>
				<property name="lecm-group-actions:field-priority"><![CDATA[0]]></property>
			</item>
		</items>
    </item>
</items>
