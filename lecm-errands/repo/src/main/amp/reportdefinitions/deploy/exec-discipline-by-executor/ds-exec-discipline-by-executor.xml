<?xml version="1.0" encoding="UTF-8"?>
<ds.config>
    <report.descriptor mnem="exec-discipline-by-executor">
        <l18>
            <item key="RU_RU" value="Исполнительская дисциплина по Исполнителям"/>
        </l18>
        <provider
            javaClass="ru.it.lecm.errands.reports.ErrandsDisciplineDSProvider" mnem="PROVIDER_ERRANDS">
            <l18>
                <item key="RU_RU" value="Провайдер Исполнительской Дисциплины по Исполнителям/Поразделениям"/>
            </l18>
        </provider>
        <templates>
            <template type="JASPER" filename="exec-discipline-by-executor_tmpl.jrxml" mnem="tmpl">
                <l18>
                    <item key="RU_RU" value="exec-discipline-by-executor"/>
                </l18>
            </template>
        </templates>
        <roles>ERRANDS_INITIATOR,ERRANDS_EXECUTOR,ERRANDS_CONTROLLER,ERRANDS_COEXECUTOR,ERRANDS_READER,ERRANDS_CURATOR,ERRANDS_CHOOSING_INITIATOR</roles>
    </report.descriptor>

    <query.descriptor>
        <offset>0</offset>
        <limit>-1</limit>
        <pgsize>-1</pgsize>
        <queryText><![CDATA[+TYPE:"lecm-errands:document"]]></queryText>
        <allVersions>true</allVersions>
        <preferedType>lecm-errands:document</preferedType>
        <isMultiRow>true</isMultiRow>
        <isCustom>false</isCustom>
    </query.descriptor>

	<!--
		groupBy.formats: Формат для группирования строк из НД, полученного после сбора всех поручений.
		В одну группу будут отнесены строки с одинаковым значением отформатированной строки.

		Пример форматной строки:

		[CDATA[{lecm-additional-document:additionalDocumentType/cm:name} <i>№{lecm-additional-document:number}</i> от {..lecm-connect:primary-document-assoc/lecm-connect:connected-document-assoc/lecm-contract:dateConclusionContracts} с {..lecm-connect:primary-document-assoc/lecm-connect:connected-document-assoc/lecm-contract:partner-assoc/lecm-contractor:shortname}
		]]
		детально:
		[CDATA[
				{lecm-additional-document:additionalDocumentType/cm:name}
				<i>№{lecm-additional-document:number}</i>
				от {..lecm-connect:primary-document-assoc/lecm-connect:connected-document-assoc/lecm-contract:dateConclusionContracts}
				с {..lecm-connect:primary-document-assoc/lecm-connect:connected-document-assoc/lecm-contract:partner-assoc/lecm-contractor:shortname}
		]]
		будет формировать для каждой выходной строки:
			<Название_документа> №<Номер> от <ДатаСоглОсновногоДокумента> с <НазваниеОгранизацииПартнёра>
	  -->
	<groupBy.formats>
		<map>
			<!-- ссылка на Сотрудника отсносительно Поручения -->
			<item key="byPerson">
				<![CDATA[ Исполнитель {lecm-errands:executor-assoc/cm:name}]]>
			</item>

			<!-- ссылка на организацию (отсносительно Персоны) "lecm-orgstr:organization-element" -->
			<item key="byOrgUnit">
				<![CDATA[ Подразделение {lecm-orgstr:element-short-name}]]>
			</item>

		</map>
	</groupBy.formats>

	<groupBy.source>
		<map>
			<!-- ссылка на Сотрудника-Исполнителя (относительно Поручения) -->
			<item key="byPerson">
				<![CDATA[lecm-errands:executor-assoc]]>
			</item>

			<!-- ссылка на организацию выбирается специально провайдером через Исполнителя -->
			<item key="byOrgUnit">
				<![CDATA[lecm-errands:executor-assoc]]>
			</item>

		</map>
	</groupBy.source>

    <fields>

        <field alfrescoType="d:text" order="0" displayName="Группировка"
            javaValueClass="java.lang.String" jrFldName="Col_GroupBy" queryFldName="byPerson">
            <l18>
                <item key="RU_RU" value="Способ группировки"/>
            </l18>
        </field>

        <!-- Период - это параметр для провеки сразу пары значений (начало и конец), 
          так что выносим его для обработки провайдером - помечаем "{{ }}".
          -->
        <field alfrescoType="d:date" order="1" displayName="Период"
            javaValueClass="java.util.Date" jrFldName="Col_Period" queryFldName="{lecm-errands:start-date}">
            <l18>
                <item key="RU_RU" value="Период"/>
            </l18>
            <parameter mnem="PARAM_TYPE_RANGE" paramType="PARAM_TYPE_RANGE">
                <l18>
                    <item key="RU_RU" value="Диапазон"/>
                </l18>
                <label1>
                    <item key="RU_RU" value=""/>
                </label1>
                <label2>
                    <item key="RU_RU" value=""/>
                </label2>
            </parameter>
        </field>

        <field alfrescoType="lecm-orgstr:employee"
            displayName="Исполнитель (сотрудник)"
            jrFldName="Col_Param_Person" order="2" queryFldName="{lecm-errands:executor-assoc-ref}">
            <l18>
                <item key="RU_RU" value="Исполнитель (сотрудник)"/>
            </l18>
            <parameter mnem="PARAM_TYPE_LIST" paramType="PARAM_TYPE_LIST">
                <l18>
                    <item key="RU_RU" value="Список"/>
                </l18>
                <label1>
                    <item key="RU_RU" value=""/>
                </label1>
                <label2>
                    <item key="RU_RU" value=""/>
                </label2>
            </parameter>
        </field>

        <!-- Подразделение -->
        <field alfrescoType="lecm-orgstr:organization-unit"
            displayName="Подразделение исполнителя" jrFldName="Col_Param_Exec_OrgUnit" order="3" 
            queryFldName="{{Executor.OrgUnit}}">
            <l18>
                <item key="RU_RU" value="Подразделение исполнителя"/>
            </l18>
            <!--
            <parameter mnem="PARAM_TYPE_LIST" paramType="PARAM_TYPE_LIST">
                <l18> <item key="RU_RU" value="Список"/> </l18>
                <label1> <item key="RU_RU" value=""/> </label1>
                <label2> <item key="RU_RU" value=""/> </label2>
            </parameter>
             -->
        </field>

        <field alfrescoType="d:text"
            displayName="Сотрудник или подразделение"
            javaValueClass="java.lang.String"
            jrFldName="Col_NameTag" order="4" queryFldName="{{Col_NameTag}}">
            <l18>
                <item key="RU_RU" value="Сотрудник или подразделение"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Выдано всего поручений за период"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Total" order="4" queryFldName="{{Col_Count_Total}}">
            <l18>
                <item key="RU_RU" value="Выдано всего поручений за период"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Выдано важных поручений за период"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Total_Important" order="5" queryFldName="{{Col_Count_Total_Important}}">
            <l18>
                <item key="RU_RU" value="Выдано важных поручений за период"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Закрыто всего поручений за период"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Closed" order="6" queryFldName="{{Col_Count_Closed}}">
            <l18>
                <item key="RU_RU" value="Закрыто всего поручений за период"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Закрытых важных поручений за период"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Closed_important" order="7" queryFldName="{{Col_Count_Closed_important}}">
            <l18>
                <item key="RU_RU" value="Закрытых важных поручений за период"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Кол-во исполнений в срок"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Intime" order="8" queryFldName="{{Col_Count_Intime}}">
            <l18>
                <item key="RU_RU" value="Кол-во исполнений в срок"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Кол-во поручений, отклонённых руководителем"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Boss_Refused" order="9" queryFldName="{{Col_Count_Boss_Refused}}">
            <l18>
                <item key="RU_RU" value="Кол-во поручений, отклонённых руководителем"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Кол-во важных поручений, неисполненных в срок"
            javaValueClass="java.lang.Integer"
            jrFldName="Col_Count_Important_Refused" order="10" queryFldName="{{Col_Count_Important_Refused}}">
            <l18>
                <item key="RU_RU" value="Кол-во важных поручений, неисполненных в срок"/>
            </l18>
        </field>

        <field alfrescoType="d:text"
            displayName="Среднее время исполнения поручения"
            javaValueClass="java.lang.Float"
            jrFldName="Col_Avg_Execution.Value" order="11" queryFldName="{{Col_Avg_Execution.Value}}">
            <l18>
                <item key="RU_RU" value="Среднее время исполнения поручения"/>
            </l18>
        </field>
    </fields>

</ds.config>
