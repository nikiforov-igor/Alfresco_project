<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<!-- Registration of Delegations models -->
	<bean id="${groupId}.${artifactId}.delegationBootstrap"
		  parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-delegation-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/delegation</value>
			</list>
		</property>
	</bean>

    <bean id="${groupId}.${artifactId}.businessJournalDictionaryBootstrap"
		  parent="lecmDictionaryBootstrap"
		  depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap, businessJournalLogEventsPolicy">
        <property name="createOrUpdateDictionaries">
            <list>
                <value>alfresco/module/${artifactId}/models/lecm-business-journal-eventCategory-items.xml</value>
            </list>
        </property>
    </bean>

	<bean id="testSearch" class="ru.it.lecm.delegation.beans.TestSearchBean" depends-on="nodeService, NodeService, repositoryHelper, WorkflowService">
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="repositoryHelper" ref="repositoryHelper"/>

		<property name="secureNodeService" ref="NodeService" />
		<property name="fastNodeService" ref="nodeService" />
		<property name="authorityService" ref="authorityService" />

		<property name="namespaceService" ref="namespaceService"/>
		<property name="workflowService" ref="WorkflowService"/>
	</bean>

	<util:constant id="delegationFolder" static-field="ru.it.lecm.delegation.beans.DelegationBean.DELEGATION_FOLDER"/>
	<bean id="delegationService" class="ru.it.lecm.delegation.beans.DelegationBean"
		  parent="baseBean"
		  depends-on="${groupId}.${artifactId}.delegationBootstrap"
		  init-method="init">
		<property name="folders">
			<map>
				<entry key="#{delegationFolder}" value="Сервис делегирования полномочий"/>
			</map>
		</property>
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="personService" ref="personService"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="sgNotifierService" ref="orgstructureSGNotifierBean"/>
	</bean>

	<bean id="webscript.ru.it.lecm.delegation.DelegationRepoWebScript.post" class="ru.it.lecm.delegation.beans.DelegationRepoWebScript" parent="webscript">
		<property name="tester" ref="testSearch"/>
	</bean>

	<bean id="delegationOptsPolicy" class="ru.it.lecm.delegation.policies.DelegationOptsPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="delegationService" ref="delegationService"/>
	</bean>

	<bean id="procuracyPolicy" class="ru.it.lecm.delegation.policies.ProcuracyPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="delegationService" ref="delegationService"/>
		<property name="nodeService" ref="nodeService"/>
	</bean>

	<bean id="delegationJavascriptExtension" class="ru.it.lecm.delegation.extensions.DelegationJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="delegation"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="delegationService" ref="delegationService"/>
	</bean>

<!--
	<bean id="mapperBusinessRole" class="ru.it.lecm.model.orm.DataMap">
		<property name="modelClazz" value="ru.it.lecm.model.BusinessRole" />
		<property name="namespacePrefixResolver">
			<ref bean="namespaceService"></ref>
		</property>
		<property name="enSkipUnmapedProps" value="true" />
		<property name="mapPropsIntoPojo">
			<map>
				<entry key="lecm-ba:role">
					<value>name</value>
				</entry>
				<entry key="lecm-ba:securityGroup">
					<value>securityGroup</value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="modelFactory" class="ru.it.lecm.model.orm.ModelFactory">
		<property name="namespacePrefixResolver" ref="namespaceService" />
		<property name="mappers">
			<list>
				<ref local="mapperBusinessRole"/>
			</list>
		</property>
	</bean>
  -->
</beans>
