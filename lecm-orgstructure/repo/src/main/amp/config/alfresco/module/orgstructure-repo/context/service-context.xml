<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
	<!-- Registration of orgStructure models -->
	<bean id="${groupId}.${artifactId}.orgStructureBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary, ru.it.lecm.orgstructure.orgstructure-repo.orgDictionaryBootstrap, ru.it.lecm.subscriptions.subscriptions-repo.subscriptionsAspectBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalAspectBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/orgstructure</value>
			</list>
		</property>
	</bean>

    <bean id="org.aspectsBootstrap" parent="dictionaryModelBootstrap"
          depends-on="dictionaryBootstrap, ${groupId}.${artifactId}.orgStructureBootstrap, ru.it.lecm.contractors.lecm-contractors-repo.contractors-dictionary-bootstrap">
        <property name="models">
            <list>
                <value>alfresco/module/${artifactId}/models/lecm-orgstructure-aspects-model.xml</value>
            </list>
        </property>
    </bean>

	<bean id="${groupId}.${artifactId}.orgDictionaryBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-docTypes-model.xml</value>
			</list>
		</property>
	</bean>

	<!--
		создаёт или обновляет словарь Бизнес-ролей
		для создания надо иметь поднятой политику orgstructureBusinessRolePolicy
		а вот для "update" - все, которые работают с БР, должностями, подразделениями и сотрудниками.
	  -->
	<bean id="${groupId}.${artifactId}.orgBootstrap" parent="lecmDictionaryBootstrap"
		depends-on="businessJournalLogEventsPolicy, orgstructureBusinessRolePolicy, orgstructureBossPolicy
			, orgstructurePrimaryPositionPolicy, orgstucturePersonEmployeeRelationsPolicy, orgstructureEmployeeLinkPolicy
			, orgstructureUnitPolicy, orgstructureStaffListPolicy, orgstructureOrganizationPolicy
			, orgstructureStaffPositionPolicy, orgstructureWorkGroupPolicy, orgstructureWorkForcePolicy, ${groupId}.${artifactId}.orgStructureBootstrap,
			ru.it.lecm.notifications.notifications-repo.notificationsTemplatesBootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-roles.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-positions.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-docTypes.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-business-roles.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-orgstructure-business-roles-items.xml</value>
                <value>alfresco/module/${artifactId}/models/lecm-orgstructure-docTypes-items.xml</value>
                <value>alfresco/module/${artifactId}/dictionary/lecm-orgstructure-nt-items.xml</value>
			</list>
		</property>
	</bean>

	<bean id="orgstructureScript" parent="baseScript" class="ru.it.lecm.orgstructure.scripts.OrgstructureWebScriptBean"
		  depends-on="serviceOrgstructure">
		<property name="extensionName">
			<value>orgstructure</value>
		</property>
		<property name="orgstructureService">
			<ref bean="serviceOrgstructure"/>
		</property>
        <property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
		<property name="dictionaryService" ref="serviceDictionary"/>
	</bean>

	<util:constant id="ORGANIZATION_ROOT_ID" static-field="ru.it.lecm.orgstructure.beans.OrgstructureBeanImpl.ORGANIZATION_ROOT_ID"/>

	<bean id="serviceOrgstructure" class="ru.it.lecm.orgstructure.beans.OrgstructureBeanImpl" parent="baseBean"
		  depends-on="${groupId}.${artifactId}.orgStructureBootstrap, auditModel.extractor.simpleValue, auditModel.extractor.nullValue, auditModel.generator.user, CMISChangeLogDataExtractor">
		<property name="personService" ref="personService"/>
		<property name="dictionaryService" ref="serviceDictionary"/>
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="authorityService" ref="authorityService" />
		<property name="userOrganizationsCache" ref="userOrganizationsCache"/>
		<property name="folders">
			<map>
				<entry key="#{ORGANIZATION_ROOT_ID}" value="Сервис Структура организации и сотрудников"/>
			</map>
		</property>
        <property name="namespaceService" ref="namespaceService"/>
	</bean>

	<!-- Настройки прав доступа на каталоги в рамках сервиса -->
	<bean id="${groupId}.${artifactId}.ServiceOrgstructure" parent="ServiceFolderPermissionHelper"
		  depends-on="${groupId}.${artifactId}.orgBootstrap" >
		<property name="serviceBean" ref="serviceOrgstructure"/>
		<property name="permissionsList">
			<list>
				<value>alfresco/module/${artifactId}/permissions/directories-permissions.xml</value>
			</list>
		</property>
	</bean>

    <bean id="${groupId}.${artifactId}.ServiceOrgstructureDictionariesPermissions" parent="ServiceFolderPermissionHelper"
          depends-on="serviceDictionary" >
        <property name="serviceBean" ref="serviceDictionary"/>
        <property name="permissionsList">
            <list>
                <value>alfresco/module/${artifactId}/permissions/dictionaries-permissions.xml</value>
            </list>
        </property>
    </bean>

	<bean id="orgstructureSGNotifierBean" class="ru.it.lecm.orgstructure.beans.OrgstructureSGNotifierBeanImpl"
		  init-method="init" parent="baseBean">
		<property name="sgNotifier" ref="lecmSecurityGroupsBean" />
		<property name="orgstructureService" ref="serviceOrgstructure"/>
	</bean>

	<bean id="securityNotificationsPolicyBase" class="ru.it.lecm.orgstructure.policies.SecurityNotificationsPolicyBase" init-method="init" abstract="true" parent="baseBean">
		<property name="orgSGNotifier" ref="orgstructureSGNotifierBean"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="policyComponent" ref="policyComponent"/>
		<property name="secretarySecurityService" ref="secretarySecurityService"/>
		<property name="secretaryService" ref="secretaryService"/>
	</bean>

	<bean id="securityJournalizedPolicyBase" class="ru.it.lecm.orgstructure.policies.SecurityJournalizedPolicyBase" parent="securityNotificationsPolicyBase" abstract="true">
		<property name="businessJournalService" ref="businessJournalService"/>
	</bean>

	<bean id="orgstructureBossPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureBossPolicy" parent="securityNotificationsPolicyBase"/>

	<bean id="orgstructureBusinessRolePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureBusinessRolePolicy" parent="securityNotificationsPolicyBase">
		<property name="propertiesService" ref="propertiesService"/>
	</bean>

	<bean id="orgstructurePrimaryPositionPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructurePrimaryPositionPolicy" parent="securityNotificationsPolicyBase"/>

	<bean id="orgstucturePersonEmployeeRelationsPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructurePersonEmployeeRelationsPolicy" parent="securityJournalizedPolicyBase">
		<property name="behaviourFilter" ref="policyBehaviourFilter" />
		<property name="scheduleService" ref="ScheduleService"/>
		<property name="propertiesService" ref="propertiesService"/>
	</bean>

	<bean id="orgstructureEmployeeLinkPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureEmployeeLinkPolicy" parent="securityJournalizedPolicyBase"/>

	<bean id="orgstructureUnitPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureUnitPolicy" parent="securityJournalizedPolicyBase">
		<property name="scheduleService" ref="ScheduleService"/>
		<property name="repositoryHelper" ref="repositoryHelper"/>
        <property name="permissionService" ref="permissionService"/>
        <property name="propertiesService" ref="propertiesService"/>
        <property name="dictionaryBean" ref="serviceDictionary"/>
    </bean>

	<bean id="orgstructureStaffListPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureStaffListPolicy" init-method="init" parent="securityJournalizedPolicyBase">
		<property name="propertiesService" ref="propertiesService"/>
	</bean>

	<bean id="orgstructureOrganizationPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureOrganizationPolicy"
		init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="businessJournalService" ref="businessJournalService" />
	</bean>

	<bean id="orgstructureStaffPositionPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureStaffPositionPolicy" parent="securityJournalizedPolicyBase">
		<property name="propertiesService" ref="propertiesService"/>
	</bean>

	<bean id="orgstructureWorkGroupPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureWorkGroupPolicy" parent="securityJournalizedPolicyBase">
		<property name="propertiesService" ref="propertiesService"/>
	</bean>

	<bean id="orgstructureWorkForcePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureWorkForcePolicy" parent="securityJournalizedPolicyBase"/>

    <bean id="orgstructureGenerateNamePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureGenerateNamesPolicy"
          init-method="init" parent="baseBean">
        <property name="policyComponent" ref="policyComponent" />
    </bean>

    <util:constant id="ORGANIZATION_ENGINEER" static-field="ru.it.lecm.orgstructure.beans.OrgstructureBean.BUSINESS_ROLE_ORGSTRUCTURE_ENGINEER_ID"/>

    <bean id="businessRolesInitiazer" class="ru.it.lecm.orgstructure.beans.AdminBRolesInitializerBean" init-method="init"
          depends-on="${groupId}.${artifactId}.orgStructureBootstrap, serviceOrgstructure" abstract="true">
        <property name="orgstructureBean" ref="serviceOrgstructure" />
        <property name="transactionService" ref="transactionService"/>
        <property name="nodeService" ref="nodeService" />
        <property name="personService" ref="personService" />
    </bean>

    <bean id="brOrgstructureEngineerInitiazer" class="ru.it.lecm.orgstructure.beans.BROrgstructureEngineerInitializerBean"
    		parent="businessRolesInitiazer" init-method="init" depends-on="serviceOrgstructure">
        <property name="businessRoles">
            <list>
                <value>#{ORGANIZATION_ENGINEER}</value>
            </list>
        </property>
    </bean>

    <bean id="staffListOnCreateAssocsPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureElementMemberCreateOrUpdatePolicy"
          init-method="init" depends-on="serviceOrgstructure" parent="logicEcmAssociationPolicy">
        <property name="substitudeService">
            <ref bean="substitudeService"/>
        </property>
    </bean>

    <bean id="webscript.ru.it.lecm.orgstructure.diagram.get"
          class="ru.it.lecm.orgstructure.scripts.diagram.DiagramScript"
          parent="webscript">
        <property name="orgstructureBean" ref="serviceOrgstructure" />
        <property name="nodeService" ref="nodeService" />
    </bean>

    <bean id="orgstructure.exportSettingsInitializer" parent="dictionary.exportSettingsInitializer" class="ru.it.lecm.dictionary.beans.ExportSettingsInitializerBean">
        <constructor-arg>
            <map>
                <entry key="lecm-orgstr:business-role">
                    <list>
                        <value>lecm-orgstr:business-role-identifier</value>
                        <value>cm:name</value>
                        <value>lecm-orgstr:business-role-description</value>
                        <value>lecm-orgstr:business-role-is-dynamic</value>
                    </list>
                </entry>
                <entry key="lecm-orgstr-docType:documentType">
                    <list>
                        <value>cm:name</value>
                    </list>
                </entry>
                <entry key="lecm-orgstr:staffPosition">
                    <list>
                        <value>cm:name</value>
                        <value>lecm-orgstr:staffPosition-name-d</value>
                        <value>lecm-orgstr:staffPosition-code</value>
                        <value>lecm-orgstr:staffPosition-name-g</value>
                    </list>
                </entry>
                <entry key="lecm-orgstr:workRole">
                    <list>
                        <value>cm:name</value>
                        <value>lecm-orgstr:workRole-description</value>
                    </list>
                </entry>
            </map>
        </constructor-arg>
    </bean>

    <bean id="listOfUsedOrgstructureTypes" parent="listOfUsedTypes">
        <property name="types">
            <map>
                <entry key="lecm-orgstr:organization-element" value="Организационная единица"/>
                <entry key="lecm-orgstr:organization-element-member" value="Позиция в структуре"/>
                <entry key="lecm-orgstr:organization-unit" value="Структурное подразделение"/>
                <entry key="lecm-orgstr:workGroup" value="Рабочая группа"/>
                <entry key="lecm-orgstr:workforce" value="Участник рабочей группы"/>
                <entry key="lecm-orgstr:staff-list" value="Штатное расписание"/>
                <entry key="lecm-orgstr:position" value="Позиция"/>
                <entry key="lecm-orgstr:staffPosition" value="Должностная позиция"/>
                <entry key="lecm-orgstr:workRole" value="Роль в рабочей группе"/>
                <entry key="lecm-orgstr:employee" value="Сотрудник"/>
                <entry key="lecm-orgstr:business-role" value="Бизнес-роль"/>
            </map>
        </property>
    </bean>

    <bean id="sharedFolderNotificationAction" class="ru.it.lecm.orgstructure.actions.SharedFolderNotificationAction"
          parent="action-executer">
        <property name="nodeService" ref="NodeService" />
        <property name="ignoreLock" value="false" />
        <property name="notificationService" ref="notificationsService"/>
        <property name="permissionService" ref="permissionService"/>
        <property name="orgstructureService" ref="serviceOrgstructure"/>
        <property name="authorityService" ref="authorityService"/>
        <property name="dictionaryService" ref="dictionaryService" />
        <property name="publicAction" value="false" />
    </bean>

    <bean id="orgstructure.exportEmployees.model" parent="dictionary.exportSettingsInitializer" class="ru.it.lecm.dictionary.beans.ExportSettingsInitializerBean">
        <constructor-arg>
            <map>
                <entry key="lecm-orgstr:employee">
                    <list>
                        <value>lecm-orgstr:employee-number</value>
                        <value>cm:name</value>
                        <value>lecm-orgstr:employee-middle-name</value>
                        <value>lecm-dic:active</value>
                        <value>lecm-orgstr:employee-fio-g</value>
                        <value>lecm-orgstr:employee-short-name</value>
                        <value>lecm-orgstr:employee-person-login</value>
                        <value>lecm-orgstr:employee-sex</value>
                        <value>lecm-orgstr:employee-first-name</value>
                        <value>lecm-orgstr:employee-phone</value>
                        <value>lecm-orgstr:employee-last-name</value>
                        <value>lecm-orgstr:employee-email</value>
                        <value>lecm-orgstr:employee-fio-d</value>
                    </list>
                </entry>
            </map>
        </constructor-arg>
    </bean>

    <bean id="webscript.ru.it.lecm.orgstructure.import.import.post"
          class="ru.it.lecm.orgstructure.imports.EmployeeImport"
          parent="webscript">
        <property name="dictionaryBean" ref="serviceDictionary"/>
        <property name="xmlImportBean" ref="lecmDictionaryImportBean"/>
        <property name="transactionService" ref="transactionService"/>
        <property name="dictionaryService" ref="dictionaryService"/>
        <property name="namespaceService" ref="namespaceService"/>
        <property name="behaviourFilter" ref="policyBehaviourFilter"/>
        <property name="nodeService" ref="NodeService" />
    </bean>

    <bean name="userOrganizationsSharedCache" factory-bean="cacheFactory" factory-method="createCache">
        <constructor-arg value="cache.userOrganizationsSharedCache"/>
    </bean>

    <bean name="userOrganizationsCache" class="org.alfresco.repo.cache.TransactionalCache">
        <property name="sharedCache">
            <ref bean="userOrganizationsSharedCache" />
        </property>
        <property name="name">
            <value>ru.it.lecm.cache.userOrganizationsCache</value>
        </property>
    </bean>

    <bean id="orgstructureEmployeeOrganizationPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureEmployeeOrganizationPolicy" parent="securityJournalizedPolicyBase"/>

    <bean id="inUserOrganizationProcessor" class="ru.it.lecm.orgstructure.processors.InSameOrganizationProcessor" parent="searchQueryBaseProccesor">
        <property name="id" value="IN_SAME_ORGANIZATION"/>
        <property name="orgstructureBean" ref="serviceOrgstructure"/>
        <property name="authorityService" ref="authorityService"/>
    </bean>

    <bean id="employeeHasLoginProcessor" class="ru.it.lecm.orgstructure.processors.EmployeeHasLoginProcessor" parent="searchQueryBaseProccesor">
        <property name="id" value="EMPLOYEE_HAS_LOGIN"/>
    </bean>

    <bean id="orgstructureOnCreateAssocsPolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureOnCreateAssocPolicy"
          parent="logicEcmAssociationPolicy" init-method="init">
        <property name="substitute" ref="substitudeService"/>
    </bean>

    <bean id="orgstructure.arm.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="arm.LogicEcmBootstrap, armService, arm.filters.LogicEcmBootstrap">
        <property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/dictionary/arm-orgstructure.xml</value>
            </list>
        </property>
    </bean>

    <bean id="orgstructure.arm.settings.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="arm.settings.LogicEcmBootstrap">
        <property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/arm/orgstructure-settings-arm.xml</value>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.it.lecm.orgstructure.arm.org-tree.get"
          class="ru.it.lecm.orgstructure.scripts.OrgstrDicWebScriptBean"
          parent="webscript">
        <property name="orgstructureService">
            <ref bean="serviceOrgstructure"/>
        </property>
        <property name="substitudeBean">
            <ref bean="substitudeService"/>
        </property>
        <property name="searchService">
            <ref bean="searchService"/>
        </property>
        <property name="namespaceService">
            <ref bean="namespaceService"/>
        </property>
    </bean>

    <bean id="orgstructure.ConfigToRepositoryLoader" parent="configsToRepositoryLoader">
        <property name="configs">
            <list>
                <value>alfresco/module/orgstructure-repo/reports/configs/orgstructure.properties</value>
            </list>
        </property>
    </bean>
	
	<bean id="orgstructureSitePolicy" class="ru.it.lecm.orgstructure.policies.OrgstructureSitePolicy" init-method="init" parent="baseBean">
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="policyComponent" ref="policyComponent"/>
	</bean>

</beans>
