<?xml version="1.0" encoding="UTF-8"?>

<model name="lecm-orgstr:organizationStructure" xmlns="http://www.alfresco.org/model/dictionary/1.0">
    <description>Orgstructure Model</description>
    <author>DBashmakov</author>
    <version>1.0</version>
    <imports>
        <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
        <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
        <import uri="http://www.it.ru/lecm/dictionary/1.0" prefix="lecm-dic"/>
        <import uri="http://www.it.ru/lecm/org/structure/docTypes/1.0" prefix="lecm-orgstr-docType"/>
        <import uri="http://www.it.ru/lecm/subscriptions/aspects/1.0" prefix="lecm-subscr-aspects"/>
    </imports>

    <namespaces>
        <namespace uri="http://www.it.ru/lecm/org/structure/1.0" prefix="lecm-orgstr"/>
    </namespaces>

    <constraints>
        <constraint name="lecm-orgstr:unit-type-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>SEPARATED</value>
                    <value>SEGREGATED</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="lecm-orgstr:employee-sex-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>MALE</value>
                    <value>FEMALE</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="lecm-orgstr:email-const" type="REGEX">
            <parameter name="expression"><value>^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$</value></parameter>
            <parameter name="requiresMatch"><value>true</value></parameter>
        </constraint>
	    <constraint name="lecm-orgstr:int-number-const" type="REGEX">
            <parameter name="expression"><value>^[0-9]\d*$</value></parameter>
            <parameter name="requiresMatch"><value>true</value></parameter>
        </constraint>
        <constraint name="lecm-orgstr:unique-property-const" type="ru.it.lecm.base.constraint.UniqueLongPropertyConstraint"/>
    </constraints>

    <types>
        <!-- Описание организационной единицы -->
        <type name="lecm-orgstr:organization-element">
            <title>Organization Element</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-orgstr:element-full-name">
                    <title>Full Name</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:element-short-name">
                    <title>Short Name</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
            <mandatory-aspects>
                <aspect>lecm-dic:aspect_active</aspect>
            </mandatory-aspects>
        </type>

        <!-- Описание позиции в структуре организации -->
        <type name="lecm-orgstr:organization-element-member">
            <title>Organization Element Member</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-orgstr:element-member-position-assoc-text-content">
                    <title>Position</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:element-member-employee-assoc-text-content">
                    <title>Member</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
            <associations>
                <!-- Ссылка на позицию -->
                <association name="lecm-orgstr:element-member-position-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:position</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Ссылка на сотрудника-->
                <child-association name="lecm-orgstr:element-member-employee-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:employee-link</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
            <mandatory-aspects>
                <aspect>lecm-dic:aspect_active</aspect>
            </mandatory-aspects>
        </type>

        <!-- Описание моделей -->
        <!-- Описание организации -->
        <type name="lecm-orgstr:organization">
            <title>Organization</title>
            <parent>lecm-orgstr:organization-element</parent>
            <properties>
                <property name="lecm-orgstr:org-leg-address">
                    <title>Legal Address</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:org-act-address">
                    <title>Actual Address</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-orgstr:org-off-site">
                    <title>Official Site</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:org-phone">
                    <title>Phone numbers</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-orgstr:org-fax">
                    <title>Fax numbers</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:org-email">
                    <title>E-mails</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-orgstr:org-tin">
                    <title>TIN</title>
                    <type>d:text</type>
                    <constraints>
                        <constraint type="REGEX">
                            <parameter name="expression"><value>^([\d])+$</value></parameter>
                            <parameter name="requiresMatch"><value>true</value></parameter>
                        </constraint>
                    </constraints>
                </property>
				<property name="lecm-orgstr:org-kpp">
					<type>d:text</type>
                    <constraints>
                        <constraint type="REGEX">
                            <parameter name="expression"><value>^[0-9]{9,9}$</value></parameter>
                            <parameter name="requiresMatch"><value>true</value></parameter>
                        </constraint>
                    </constraints>
				</property>
                <property name="lecm-orgstr:org-ownership-type">
                    <title>Type of ownership</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:org-incorporation-form">
                    <title>Form of incorporation</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:org-founding-docs">
                    <title>Information about the founding documents</title>
                    <type>d:text</type>
                </property>
            </properties>
            <associations>
                <!-- Ссылка на логотип -->
                <association name="lecm-orgstr:org-logo-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>cm:content</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>

        <!-- Папки объектов. DO NOT MODIFY -->

        <type name="lecm-orgstr:employees">
            <title>Employees Directory</title>
            <parent>cm:folder</parent>
        </type>

        <type name="lecm-orgstr:personal-data-container">
            <title>Personal Data Directory</title>
            <parent>cm:folder</parent>
        </type>

        <type name="lecm-orgstr:structure">
            <title>Structure</title>
            <parent>cm:folder</parent>
        </type>

        <!-- Структурное подразделение -->
        <type name="lecm-orgstr:organization-unit">
            <title>Organization Unit</title>
            <parent>lecm-orgstr:organization-element</parent>
            <properties>
                <property name="lecm-orgstr:unit-code">
                    <title>Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:unit-type">
                    <title>Type</title>
                    <type>d:text</type>
                    <default>SEGREGATED</default>
                    <constraints>
                       <constraint ref="lecm-orgstr:unit-type-const"/>
                    </constraints>
                </property>
            </properties>
            <associations>
                <!--Ссылка на общую папку подразделения -->
                <association name="lecm-orgstr:unit-folder-assoc">
                    <title>Shared Folder</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>cm:folder</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
            <mandatory-aspects>
                <aspect>cm:versionable</aspect>
            </mandatory-aspects>
        </type>

        <!-- Рабочая группа -->
        <type name="lecm-orgstr:workGroup">
            <title>Working Group</title>
            <parent>lecm-orgstr:organization-element</parent>
            <properties>
                <property name="lecm-orgstr:workGroup-description">
                    <title>Working Group Description</title>
                    <type>d:text</type>
                </property>
            </properties>
            <mandatory-aspects>
                <aspect>cm:versionable</aspect>
	            <aspect>lecm-subscr-aspects:subscribed</aspect>
            </mandatory-aspects>
        </type>

        <!-- Участник рабочей группы -->
        <type name="lecm-orgstr:workforce">
            <title>Workforce</title>
            <parent>lecm-orgstr:organization-element-member</parent>
            <properties>
                <property name="lecm-orgstr:workforce-comment">
                    <title>Comment</title>
                    <type>d:text</type>
                </property>
            </properties>
        </type>

        <!-- Штатное расписание -->
        <type name="lecm-orgstr:staff-list">
            <title>Staff List</title>
            <parent>lecm-orgstr:organization-element-member</parent>
            <properties>
                <property name="lecm-orgstr:staff-list-description">
                    <title>Description</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:staff-list-is-boss">
                    <title>Is Boss Position</title>
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
            </properties>
        </type>

        <!-- Должность -->
        <type name="lecm-orgstr:position">
            <title>Position</title>
            <parent>lecm-dic:plane_dictionary_values</parent>
            <mandatory-aspects>
                <aspect>lecm-dic:aspect_active</aspect>
            </mandatory-aspects>
        </type>

        <!-- Должность -->
        <type name="lecm-orgstr:staffPosition">
            <title>Position</title>
            <parent>lecm-orgstr:position</parent>
            <properties>
                <property name="lecm-orgstr:staffPosition-name-g">
                    <title>Name in genitive</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:staffPosition-name-d">
                    <title>Name in dative</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:staffPosition-code">
                    <title>Code</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
        </type>

        <!-- Роль в рабочей группе -->
        <type name="lecm-orgstr:workRole">
            <title>Working Role</title>
            <parent>lecm-orgstr:position</parent>
            <properties>
                <property name="lecm-orgstr:workRole-description">
                    <title>Description</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
        </type>

        <!-- Сотрудник организации -->
        <type name="lecm-orgstr:employee">
            <title>Еmployee</title>
            <parent>cm:content</parent>
            <properties>
                <property name="lecm-orgstr:employee-first-name">
                    <title>First Name</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:employee-middle-name">
                    <title>Middle Name</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:employee-last-name">
                    <title>Last Name</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:employee-sex">
                    <title>Sex</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref="lecm-orgstr:employee-sex-const"/>
                    </constraints>
                </property>
                <property name="lecm-orgstr:employee-phone">
                    <title>Phone Number</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:employee-email">
                    <title>E-Mail</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                    <constraints>
                        <constraint ref="lecm-orgstr:email-const"/>
                    </constraints>
                </property>
                <property name="lecm-orgstr:employee-number">
                    <title>Employee number</title>
                    <type>d:text</type>
	                <constraints>
		                <!--<constraint ref="lecm-orgstr:int-number-const"/>-->
                        <constraint ref="lecm-orgstr:unique-property-const"/>
                    </constraints>
                </property>
                <property name="lecm-orgstr:employee-fio-g">
                    <title>Full name in genitive</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:employee-fio-d">
                    <title>Full name in dative</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:employee-positions">
                    <title>Hidden property for List positions</title>
                    <type>d:text</type>
                    <multiple>true</multiple>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-orgstr:employee-roles">
                    <title>Hidden property for List roles</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:employee-person-login">
                    <title>Hidden property for Person Login</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:employee-short-name">
                    <title>Short Name</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
            <associations>
                <!--Ссылка на фото -->
                <association name="lecm-orgstr:employee-photo-assoc">
                    <title>Photo</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>cm:content</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Связь с учетной записью в системе -->
                <association name="lecm-orgstr:employee-person-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>cm:person</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!--  Связь с персональными данными -->
                <child-association name="lecm-orgstr:employee-person-data-assoc">
                    <source>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:personal-data</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
            <mandatory-aspects>
                <aspect>lecm-dic:aspect_active</aspect>
                <aspect>lecm-subscr-aspects:subscribed</aspect>
            </mandatory-aspects>
        </type>

       <!-- Персональные данные -->
        <type name="lecm-orgstr:personal-data">
            <title>Personal Data</title>
            <parent>cm:content</parent>
            <properties>
                <property name="lecm-orgstr:person-data-address">
                    <title>Person Address</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:person-data-email">
                    <title>Person E-Mail</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:person-data-phone">
                    <title>Person Phone</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:person-data-date">
                    <title>Person Birthday</title>
                    <type>d:date</type>
                </property>
                <property name="lecm-orgstr:person-data-service-id">
                    <title>Person Messaging service ID</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:person-data-doc-series">
                    <title>Person Document Series</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-orgstr:person-data-doc-number">
                    <title>Person Document Number</title>
                    <type>d:text</type>
                </property>
            </properties>
            <associations>
                <!--Ссылка на вид документа -->
                <association name="lecm-orgstr:person-data-docType-assoc">
                    <title>Doc Type</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr-docType:documentType</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>

        <!-- Связь с сотрудником -->
        <type name="lecm-orgstr:employee-link">
            <title>Link with Employee</title>
            <parent>cm:content</parent>
            <properties>
                <property name="lecm-orgstr:employee-link-is-primary">
                    <title>Is Primary</title>
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
            </properties>
            <associations>
                <!-- Ссылка на сотрудника -->
                <association name="lecm-orgstr:employee-link-employee-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:employee</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>

		<!-- Бизнес-роль -->
		<type name="lecm-orgstr:business-role">
			<parent>lecm-dic:plane_dictionary_values</parent>
			<properties>
				<property name="lecm-orgstr:business-role-description">
					<type>d:text</type>
					<index enabled="true">
						<atomic>true</atomic>
						<stored>false</stored>
						<tokenised>both</tokenised>
					</index>
				</property>
				<property name="lecm-orgstr:business-role-identifier">
					<type>d:text</type>
					<mandatory>true</mandatory>
					<index enabled="true">
						<atomic>true</atomic>
						<stored>false</stored>
						<tokenised>false</tokenised>
					</index>
				</property>
				<property name="lecm-orgstr:business-role-is-dynamic">
					<type>d:boolean</type>
					<default>false</default>
					<index enabled="true">
						<atomic>true</atomic>
						<stored>false</stored>
						<tokenised>both</tokenised>
					</index>
				</property>
			</properties>
			<associations>
				<association name="lecm-orgstr:business-role-employee-assoc">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>lecm-orgstr:employee</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>
				<association name="lecm-orgstr:business-role-organization-element-assoc">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>lecm-orgstr:organization-element</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>
				<association name="lecm-orgstr:business-role-organization-element-member-assoc">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>lecm-orgstr:organization-element-member</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>
			</associations>
		</type>

    </types>
</model>