<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<util:list id="routing.models">
		<value>alfresco/module/${artifactId}/models/lecm-workflow-route-model.xml</value>
	</util:list>

	<bean id="routing.model.bootstrap" parent="dictionaryModelBootstrap"
		  depends-on="statemachine.aspects.LogicEcmModelsBootstrap"
		  p:models-ref="routing.models"/>

	<util:constant id="ENGINE_ID" static-field="org.alfresco.repo.workflow.WorkflowDeployer.ENGINE_ID"/>
	<util:constant id="LOCATION" static-field="org.alfresco.repo.workflow.WorkflowDeployer.LOCATION"/>
	<util:constant id="MIMETYPE" static-field="org.alfresco.repo.workflow.WorkflowDeployer.MIMETYPE"/>
	<util:constant id="REDEPLOY" static-field="org.alfresco.repo.workflow.WorkflowDeployer.REDEPLOY"/>
	<util:list id="route.workflows">
		<props>
			<prop key="#{ENGINE_ID}">activiti</prop>
			<prop key="#{LOCATION}">alfresco/module/${artifactId}/workflow/route-workflow.bpmn20.xml</prop>
			<prop key="#{MIMETYPE}">text/xml</prop>
			<prop key="#{REDEPLOY}">${redeploy.process.definitions}</prop>
		</props>
	</util:list>
	<bean id="route.workflow.bootstrap" parent="workflowDeployer"
		  depends-on="routing.model.bootstrap"
		  p:workflowDefinitions-ref="route.workflows"/>

	<bean id="abstract.workflowRunner" abstract="true"/>

	<bean id="approval.workflowRunner" parent="abstract.workflowRunner"
		  class="ru.it.lecm.workflow.beans.ApprovalWorkflowRunner"/>

	<bean id="signing.workflowRunner" parent="abstract.workflowRunner"
		  class="ru.it.lecm.workflow.beans.SigningWorkflowRunner"/>

	<util:constant id="APPROVAL" static-field="ru.it.lecm.workflow.WorkflowType.APROVAL"/>
	<util:constant id="SIGNING" static-field="ru.it.lecm.workflow.WorkflowType.SIGNING"/>
	<util:map id="workflow.runners">
		<entry key-ref="APPROVAL" value-ref="approval.workflowRunner"/>
		<entry key-ref="SIGNING" value-ref="signing.workflowRunner"/>
	</util:map>
	<bean id="workflowRunnerService" class="ru.it.lecm.workflow.beans.WorkflowRunnerFactory"
		  p:runners-ref="workflow.runners"/>

</beans>
