<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<bean id="${groupId}.${artifactId}.wCalendarBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/calendar-model.xml</value>
				<value>alfresco/module/${artifactId}/models/absence-model.xml</value>
				<value>alfresco/module/${artifactId}/models/schedule-model.xml</value>
				<value>alfresco/module/${artifactId}/models/wcal-common-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/calendar</value>
			</list>
		</property>
	</bean>
	<bean id="${groupId}.${artifactId}.wCalendarBusinessRolesDicBootstrap"
		  parent="lecmDictionaryBootstrap" depends-on="${groupId}.${artifactId}.wCalendarBootstrap, businessJournalLogEventsPolicy, ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap" >
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/wcalendar-business-roles-dictionary-items.xml</value>
			</list>
		</property>
	</bean>
	<bean id="${groupId}.${artifactId}.absenceReasonDicBootstrap"
		  parent="lecmDictionaryBootstrap" depends-on="${groupId}.${artifactId}.wCalendarBootstrap, businessJournalLogEventsPolicy" >
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/absence-reason-dictionary.xml</value>
				<value>alfresco/module/${artifactId}/models/absence-reason-dictionary-items.xml</value>
			</list>
		</property>
	</bean>

	<!-- Добавление новых категорий событий -->
	<bean id="${groupId}.${artifactId}.businessJournalDictionaryBootstrap"
			  parent="lecmDictionaryBootstrap"
			  depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalDictionaryBootstrap, businessJournalLogEventsPolicy">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-buisness-journal-eventCategory-items.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-buisness-journal-objectType-items.xml</value>
			</list>
		</property>
	</bean>

	<!-- Настройки прав доступа на каталоги в рамках сервиса -->
	<bean id="${groupId}.${artifactId}.ScheduleServicePermissions" parent="ServiceFolderPermissionHelper"
		  depends-on="${groupId}.${artifactId}.wCalendarBootstrap, ${groupId}.${artifactId}.wCalendarBusinessRolesDicBootstrap" >
		<property name="serviceBean" ref="ScheduleService"/>
		<property name="permissionsList">
			<list>
				<value>alfresco/module/${artifactId}/models/directories-permissions.xml</value>
			</list>
		</property>
	</bean>

	<bean id="wcalendar.arm.myProfile.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
	      depends-on="userProfile.arm.LogicEcmBootstrap">
		<property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/arm/default-arm-my-profile-items.xml</value>
			</list>
		</property>
	</bean>

	<util:constant id="WORK_CALENDAR_FOLDER_ID" static-field="ru.it.lecm.wcalendar.beans.AbstractCommonWCalendarBean.WORK_CALENDAR_FOLDER_ID"/>
	<bean id="commonWCalendarBean" class="ru.it.lecm.wcalendar.beans.AbstractCommonWCalendarBean"
		  abstract="true" parent="baseBean" init-method="initizlize">
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="authService" ref="authenticationService"/>
		<property name="folders">
			<map>
				<entry key="#{WORK_CALENDAR_FOLDER_ID}" value="Сервис Рабочий календарь"/>
			</map>
		</property>
	</bean>
	<!-- Бины для сервисов календарей, графиков работы и отсутствий -->
	<bean id="WCalendarService" class="ru.it.lecm.wcalendar.calendar.beans.CalendarBean" init-method="init"
		  parent="commonWCalendarBean" depends-on="${groupId}.${artifactId}.wCalendarBootstrap">
		<!--На сколько лет вперед сгенерировать календари-->
		<property name="yearsNumberToCreate" value="3"/>
	</bean>
	<bean id="ScheduleService" class="ru.it.lecm.wcalendar.schedule.beans.ScheduleBean" init-method="init"
		  parent="commonWCalendarBean" depends-on="${groupId}.${artifactId}.wCalendarBootstrap">
		<property name="defaultScheduleStartTime" value="09:00"/>
		<property name="defaultScheduleEndTime" value="18:00"/>
	</bean>
	<bean id="AbsenceService" class="ru.it.lecm.wcalendar.absence.beans.AbsenceBean" init-method="init"
		  parent="commonWCalendarBean" depends-on="${groupId}.${artifactId}.wCalendarBootstrap">
		<property name="delegationService" ref="delegationService"/>
	</bean>
	<bean id="WorkCalendarService" class="ru.it.lecm.wcalendar.beans.WorkCalendarBean" init-method="init">
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="wCalendarService" ref="WCalendarService"/>
		<property name="absenceService" ref="AbsenceService"/>
		<property name="scheduleService" ref="ScheduleService"/>
	</bean>
	<!-- JavaScript root-object для календарей, отсутствий и графиков работы  -->
	<bean id="WCalendarJavascriptExtension" class="ru.it.lecm.wcalendar.calendar.extensions.CalendarJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="calendar"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="wCalendarService" ref="WCalendarService"/>
	</bean>
	<bean id="AbsenceJavascriptExtension" class="ru.it.lecm.wcalendar.absence.extensions.AbsenceJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="nodeService" ref="nodeService"/>
		<property name="extensionName" value="absence"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<bean id="ScheduleJavascriptExtension" class="ru.it.lecm.wcalendar.schedule.extensions.ScheduleJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="schedule"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="scheduleService" ref="ScheduleService"/>
	</bean>
	<bean id="WorkCalendarJavascriptExtension" class="ru.it.lecm.wcalendar.extensions.WorkCalendarJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="workCalendar"/>
		<property name="workCalendarService" ref="WorkCalendarService"/>
	</bean>
	<!-- Web-скрипты на Java -->
	<bean id="webscript.ru.it.lecm.wcalendar.absence.AbsenceCancelShowDialogWebScript.get" class="ru.it.lecm.wcalendar.absence.extensions.AbsenceCancelShowDialogWebScript" parent="webscript">
		<property name="absenceService" ref="AbsenceService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
	</bean>
	<!-- Бины шедулера для отсутствий (начало отсутствия) -->
	<bean id="absenceStartScheduleExecutor" class="ru.it.lecm.wcalendar.absence.schedule.AbsenceStartScheduleExecutor" parent="action-executer">
		<property name="ignoreLock">
			<value>false</value>
		</property>
		<property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
                <property name="publicAction" value="false" />
    </bean>
	<bean id="absenceStartSchedule" class="ru.it.lecm.wcalendar.absence.schedule.AbsenceStartSchedule" depends-on="${groupId}.${artifactId}.wCalendarBootstrap"  parent="baseTransactionalSchedule">
		<property name="jobName">
			<value>absence-start</value>
		</property>
		<property name="jobGroup">
			<value>absence</value>
		</property>
		<property name="triggerName">
			<value>absence-start-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>absence-trigger</value>
		</property>
		<property name="actionName">
			<value>absenceStartScheduleExecutor</value>
		</property>
		<property name="cronExpression">
			<value>0 1 * * * ? *</value> <!-- каждый час в xx:01 -->
		</property>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<!-- Бины шедулера для отсутствий (окончание отсутствия) -->
	<bean id="absenceEndScheduleExecutor" class="ru.it.lecm.wcalendar.absence.schedule.AbsenceEndScheduleExecutor" parent="action-executer">
		<property name="ignoreLock">
			<value>false</value>
		</property>
		<property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
        <property name="publicAction" value="false" />
    </bean>
	<bean id="absenceEndSchedule" class="ru.it.lecm.wcalendar.absence.schedule.AbsenceEndSchedule" depends-on="${groupId}.${artifactId}.wCalendarBootstrap" parent="baseTransactionalSchedule">
		<property name="jobName">
			<value>absence-end</value>
		</property>
		<property name="jobGroup">
			<value>absence</value>
		</property>
		<property name="triggerName">
			<value>absence-end-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>absence-trigger</value>
		</property>
		<property name="actionName">
			<value>absenceEndScheduleExecutor</value>
		</property>
		<property name="cronExpression">
			<value>0 59 * * * ? *</value> <!-- каждый час в xx:59 -->
		</property>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<!-- Бины шедулера для отсутствий (продление бессрочных отсутствий) -->
	<bean id="absenceProlongationScheduleExecutor" class="ru.it.lecm.wcalendar.absence.schedule.AbsenceProlongationScheduleExecutor" parent="action-executer">
		<property name="ignoreLock">
			<value>false</value>
		</property>
		<property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
        <property name="publicAction" value="false" />
    </bean>
	<bean id="absenceProlongationSchedule" class="ru.it.lecm.wcalendar.absence.schedule.AbsenceProlongationSchedule" depends-on="${groupId}.${artifactId}.wCalendarBootstrap" parent="baseTransactionalSchedule">
		<property name="jobName">
			<value>absence-prolongation</value>
		</property>
		<property name="jobGroup">
			<value>absence</value>
		</property>
		<property name="triggerName">
			<value>absence-prolongation-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>absence-trigger</value>
		</property>
		<property name="actionName">
			<value>absenceProlongationScheduleExecutor</value>
		</property>
		<property name="cronExpression">
			<value>0 1 * * * ? *</value> <!-- каждый час в xx:01 -->
		</property>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<!-- Полиси для сервиса календарей -->
	<bean id="calendarModifyPolicy" class="ru.it.lecm.wcalendar.calendar.policy.CalendarModifyPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="wCalendarService" ref="WCalendarService"/>
		<property name="nodeService" ref="nodeService"/>
	</bean>
	<!-- Полиси для сервиса отсутствий -->
	<bean id="absenceStartPolicy" class="ru.it.lecm.wcalendar.absence.policy.AbsenceStartPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<bean id="absenceEndPolicy" class="ru.it.lecm.wcalendar.absence.policy.AbsenceEndPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<bean id="absenceAssociationPolicy" class="ru.it.lecm.wcalendar.absence.policy.AbsenceAssociationPolicy" init-method="init" parent="logicEcmAssociationPolicy"/>
	<!-- Полиси для сервиса графиков -->
	<bean id="scheduleDeletePolicy" class="ru.it.lecm.wcalendar.schedule.policy.ScheduleDeletePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="scheduleService" ref="ScheduleService"/>
	</bean>
	<bean id="scheduleCreatePolicy" class="ru.it.lecm.wcalendar.schedule.policy.ScheduleCreatePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="scheduleService" ref="ScheduleService"/>
	</bean>
	<bean id="scheduleAssociationPolicy" class="ru.it.lecm.wcalendar.schedule.policy.SheduleAssociationPolicy" init-method="init" parent="logicEcmAssociationPolicy"/>

	<bean id="calendar.exportSettingsInitializer" parent="dictionary.exportSettingsInitializer" class="ru.it.lecm.dictionary.beans.ExportSettingsInitializerBean">
		<constructor-arg>
			<map>
				<entry key="lecm-absence:reason">
					<list>
						<value>cm:name</value>
						<value>cm:title</value>
						<value>lecm-absence:color</value>
						<value>lecm-absence:code</value>
					</list>
				</entry>
			</map>
		</constructor-arg>
	</bean>

    <bean id="calendar.arm.settings.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="arm.settings.LogicEcmBootstrap">
        <property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/arm/calendar-settings-arm.xml</value>
            </list>
        </property>
    </bean>
</beans>
