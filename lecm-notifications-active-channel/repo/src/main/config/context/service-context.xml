<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
	<bean id="${groupId}.${artifactId}.notificationsBootstrap" parent="dictionaryModelBootstrap"
	      depends-on="ru.it.lecm.notifications.notifications-repo.notificationsBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-active-channel-model.xml</value>
			</list>
		</property>
	</bean>

	<bean id="${groupId}.${artifactId}.notificationsTypeActiveChannelBootstrap" parent="lecmDictionaryBootstrap"
	      depends-on="ru.it.lecm.notifications.notifications-repo.notificationsTypesBootstrap,businessJournalLogEventsPolicy">
		<property name="createOrUpdateDictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-notifications-type-active-channel.xml</value>
			</list>
		</property>
	</bean>

	<util:constant id="NOTIFICATIONS_ACTIVE_CHANNEL_ROOT_ID" static-field="ru.it.lecm.notifications.channel.active.beans.NotificationsActiveChannel.NOTIFICATIONS_ACTIVE_CHANNEL_ROOT_ID"/>
	<util:constant id="NOTIFICATIONS_ACTIVE_CHANNEL_ROOT_NAME" static-field="ru.it.lecm.notifications.channel.active.beans.NotificationsActiveChannel.NOTIFICATIONS_ACTIVE_CHANNEL_ROOT_NAME"/>
	<util:constant id="NOTIFICATIONS_ROOT_NAME" static-field="ru.it.lecm.notifications.beans.NotificationsService.NOTIFICATIONS_ROOT_NAME"/>

	<bean id="notificationActiveChannel" init-method="init" class="ru.it.lecm.notifications.channel.active.beans.NotificationsActiveChannel" parent="baseBean"
	      depends-on="ServiceRegistry, nodeService, repositoryHelper, notificationsService, serviceOrgstructure, SearchService, namespaceService, transactionService">
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="notificationsService" ref="notificationsService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="searchService" ref="SearchService"/>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="transactionService" ref="transactionService"/>
		<!-- Автоматическое создание каталогов. -->
		<property name="folders">
			<map>
				<entry key="#{NOTIFICATIONS_ACTIVE_CHANNEL_ROOT_ID}" value="#{NOTIFICATIONS_ROOT_NAME}/#{NOTIFICATIONS_ACTIVE_CHANNEL_ROOT_NAME}"/>
			</map>
		</property>
	</bean>

	<bean id="notificationActiveChannelScript" parent="baseJavaScriptExtension" class="ru.it.lecm.notifications.channel.active.scripts.NotificationsActiveChannelWebScriptBean"
	      depends-on="notificationActiveChannel">
		<property name="extensionName">
			<value>notificationsActiveChannel</value>
		</property>
		<property name="service">
			<ref bean="notificationActiveChannel"/>
		</property>
	</bean>

	<bean id="notificationsActiveChannelDeleteSchedule" class="ru.it.lecm.notifications.channel.active.schedule.NotificationsActiveChannelDeleteSchedule">
		<property name="transactionMode">
			<value>ISOLATED_TRANSACTIONS</value>
		</property>
		<property name="compensatingActionMode">
			<value>IGNORE</value>
		</property>
		<property name="cronExpression">
			<value>0 15 3 * * ?</value>
		</property>
		<property name="jobName">
			<value>notificationa-active-channel-cleaner</value>
		</property>
		<property name="jobGroup">
			<value>notifications-active-channel</value>
		</property>
		<property name="triggerName">
			<value>notifications-active-channel-delete-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>notifications-active-channel-trigger</value>
		</property>
		<property name="scheduler">
			<ref bean="schedulerFactory"/>
		</property>
		<property name="actionService">
			<ref bean="ActionService"/>
		</property>
		<property name="searchService">
			<ref bean="SearchService"/>
		</property>
		<property name="nodeService">
			<ref bean="nodeService"/>
		</property>
		<property name="transactionService">
			<ref bean="TransactionService"/>
		</property>
		<property name="namespaceService">
			<ref bean="namespaceService"/>
		</property>
		<property name="runAsUser">
			<value>System</value>
		</property>
		<property name="notificationsActiveChannel">
			<ref bean="notificationActiveChannel"/>
		</property>
	</bean>
</beans>
