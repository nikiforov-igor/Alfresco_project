<?xml version="1.0"?>
<?eclipse.ant.import?>
<project basedir="." default="jar" name="scanner-applet">
	<target name="clean">
		<delete dir="${dir.target}"/>
	</target>
	
	<target name="init" depends="clean">
		<mkdir dir="${dir.target.classes}"/>
	</target>
	
	<target name="compile" depends="init">
		<echo message="Compiling scanner-applet classes"/>
		
		<javac debug="true" debuglevel="${debuglevel}" 
			destdir="${dir.target.classes}"
			source="${source}" 
			target="${target}"
			encoding="${encoding}">
			<src path="${dir.src.main.java}"/>
			<classpath>
				<pathelement location="../${mmsc.location}/${dir.target.classes}"/>
				<pathelement location="${java.home}/lib/plugin.jar"/>
				<fileset dir="lib" includes="*.jar"/>
			</classpath>
		</javac>
		
		<copy todir="${dir.target.classes}">
			<fileset dir="${dir.src.main.resources}">
				<include name="**/*.*"/>
			</fileset>
		</copy>
	</target>
	
	<target name="jar" depends="compile">
		<!--<jarjar jarfile="${dir.target}/${scanner-applet.name}">
			<fileset dir="${dir.target.classes}"/>
			<fileset dir="../${mmsc.location}/${dir.target.classes}"/>
			<zipfileset src="lib/commons-codec-1.2.jar" excludes="META-INF/**/*.*"/>
			<zipfileset src="lib/commons-httpclient-3.1.jar" excludes="META-INF/**/*.*"/>
			<zipfileset src="lib/commons-io-1.4.jar" excludes="META-INF/**/*.*"/>
			<zipfileset src="lib/commons-logging-1.0.4.jar" excludes="META-INF/**/*.*"/>
			<zipfileset src="lib/itext-2.1.7.jar" excludes="META-INF/**/*.*"/>
			<zipfileset src="lib/swing-worker-1.1.jar" excludes="META-INF/**/*.*"/>
			<keep pattern="com.aplana.**"/>
			<keep pattern="uk.co.mmscomputing.**"/>
			<manifest>
				<attribute name="Extension-List" value="jai_imageio"/>
				<attribute name="jai_imageio-Extension-Name" value="com.sun.media.imageio"/>
				<attribute name="jai_imageio-Specification-Version" value="1.1"/>
				<attribute name="jai_imageio-Implementation-Version" value="1.1"/>
				<attribute name="jai_imageio-Implementation-Vendor-Id" value="com.sun"/>
				<attribute name="jai_imageio-Implementation-URL" value="http://${deploy.host}:${deploy.port}/${UserPortlets.name}/jai_imageio_windows-i586.jar"/>
			</manifest>
		</jarjar>-->
		
		<signjar
			jar="${dir.target}/${scanner-applet.name}"
			keystore="${AppletsSignature.keystore.location}"
			storepass="${AppletsSignature.keystore.password}"
			keypass="${AppletsSignature.key.password}"
			alias="${AppletsSignature.key.alias}"
		/>
	</target>
</project>