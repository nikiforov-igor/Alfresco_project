<?xml version="1.0" encoding="UTF-8"?>
<!--
	Опись изменений договора.

	model of the contract/document:
		.\lecm-contracts\repo\src\main\config\models\lecm-contracts-model.xml

Входные данные:
•	ID документа-договора

Выходные данные отчета:
•	несколько полей документа:
		<Вид договора>
		№<Рег.номер>
		<Дата регистрации>
		<Контрагент (краткое наименование)>
•	табличка с вложениями:
	<Тип документа> (изменения к договору, спецификация, протокол согласования разногласий)
	<Номер>
	<Дата документа>
	<Статус>

( ($F{col_Item.Regnum} != null && !"Не присвоено".equals($F{col_Item.Regnum}) )? $F{col_Item.Regnum} : "нет")

	-->

<ds.config>
    <report.descriptor mnem="contract-delta-list-byid">
        <l18>
            <item key="RU_RU" value="Опись изменений договора"/>
        </l18>
        <provider mnem="DSProviderContractsDeltaById" javaClass="ru.it.lecm.contracts.reports.DSProviderContractsDeltaById" >
           <l18>
               <item key="RU_RU" value="Провайдер Jasper отчётов: Опись изменений договора"/>
           </l18>
        </provider>
        <templates>
            <template mnem="tmpl" type="JASPER" filename="contract-delta-list-byid_tmpl.jrxml"/>
        </templates>
        <roles>CONTRACT_READER,CONTRACT_RECORDER,CONTRACT_EXECUTOR,CONTRACT_CURATOR,CONTRACT_SIGNER</roles>
    </report.descriptor>

	<query.descriptor>
		<offset>0</offset>
		<limit>-1</limit>
		<pgsize>-1</pgsize>
		<allVersions>true</allVersions>
		<preferedType>lecm-contract:document</preferedType>
		<isMultiRow>false</isMultiRow>
		<isCustom>false</isCustom>
		<queryText><![CDATA[]]></queryText>
		<flags>
				<!-- соответствия входных параметров (values) свойствам бина провайдера (keys) -->
				<property.nodeRef> <![CDATA[ID;id]]> </property.nodeRef>
		</flags>
	</query.descriptor>

	<fields>
		<!-- Данные по "Виду договора" (с типом "lecm-contract-dic:contract-type") -->
		<field jrFldName="col_DocString" queryFldName="{lecm-document:present-string}"
			displayName="Строка представления"
			inMainDoc="true">
        </field>

		<!-- атрибуты для таблицы вложенных файлов надо обозначать 
			относительно связи с типом "lecm-connect:connection"
		  -->

		<field jrFldName="col_Item.DocName"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-document:ext-present-string}"
				displayName="Вложение.Название" />

		<!-- Статус вложенного -->
		<field jrFldName="col_Item.Status"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-statemachine:status}"
				displayName="Вложение.Статус" />

		<!-- Дата изменения статуса вложенного -->
		<field jrFldName="col_Item.StatusDate"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-document:status-changed-date}"
				displayName="Вложение.Дата смены статус"
				javaValueClass="java.util.Date"/>

	</fields>

</ds.config>
