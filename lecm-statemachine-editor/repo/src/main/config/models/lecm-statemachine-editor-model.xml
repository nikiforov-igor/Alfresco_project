<?xml version="1.0" encoding="UTF-8"?>
<model name="lecm-stmeditor:model" xmlns="http://www.alfresco.org/model/dictionary/1.0">
	<description>Logic ECM statemachine model for editor</description>
	<author>Logic ECM</author>
	<version>1.0</version>
	<imports>
		<import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
		<import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
		<import uri="http://www.it.ru/lecm/org/structure/1.0" prefix="lecm-orgstr"/>
	</imports>
	<namespaces>
		<namespace uri="http://www.it.ru/logicECM/statemachine/editor/1.0" prefix="lecm-stmeditor"/>
	</namespaces>

	<constraints>
		<constraint name="lecm-stmeditor:toTypeList" type="LIST">
			<parameter name="allowedValues">
				<list>
					<value>FIELD</value>
					<value>VARIABLE</value>
				</list>
			</parameter>
		</constraint>
		<constraint name="lecm-stmeditor:fromTypeList" type="LIST">
			<parameter name="allowedValues">
				<list>
					<value>FIELD</value>
					<value>VARIABLE</value>
					<value>VALUE</value>
				</list>
			</parameter>
		</constraint>
	</constraints>

	<types>

		<!-- Основной объект хранилища описаний процессов -->
		<type name="lecm-stmeditor:statemachine">
			<title>Logic ECM Base Document</title>
			<parent>cm:folder</parent>
			<properties>
				<property name="lecm-stmeditor:archiveFolder">
					<type>d:text</type>
					<mandatory>true</mandatory>
                    <constraints>
                        <constraint name="lecm-stmeditor:archiveFolder-const" type="REGEX">
                            <parameter name="expression"><value><![CDATA[(.*[\"\*\\\>\<\?\:\|]+.*)|(.*[\.]?.*[\.]+$)|(.*[ ]+$)]]></value></parameter>
                            <parameter name="requiresMatch"><value>false</value></parameter>
                        </constraint>
                    </constraints>
				</property>
                <property name="lecm-stmeditor:archiveFolderAdditional">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
				<property name="lecm-stmeditor:staticRolesList">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
				<property name="lecm-stmeditor:dynamicRolesList">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
                <property name="lecm-stmeditor:alternativesFolder">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
			</properties>
			<associations>
				<association name="lecm-stmeditor:documentsFolder">
					<source>
						<mandatory>false</mandatory>
						<many>false</many>
					</source>
					<target>
						<class>cm:folder</class>
						<mandatory>false</mandatory>
						<many>false</many>
					</target>
				</association>
			</associations>
		</type>

		<!-- Список ролей для машины состояний -->
		<type name="lecm-stmeditor:roles">
			<title>Logic ECM Base Roles</title>
			<parent>cm:folder</parent>
		</type>

		<!-- Deprecated: Роль для машины состояний -->
		<type name="lecm-stmeditor:role">
			<title>Logic ECM Role</title>
			<parent>cm:content</parent>
			<properties>
				<property name="lecm-stmeditor:creationDocument">
					<type>d:boolean</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:business-role</aspect>
			</mandatory-aspects>
		</type>

        <!-- Список статичных ролей для машины состояний -->
        <type name="lecm-stmeditor:static-role-item">
            <title>Logic ECM Static Role Item</title>
            <parent>cm:content</parent>
            <properties>
                <property name="lecm-stmeditor:isCreator">
                    <type>d:boolean</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
            <mandatory-aspects>
                <aspect>lecm-stmeditor:business-role</aspect>
            </mandatory-aspects>
        </type>

        <!-- Список динамических ролей для машины состояний -->
        <type name="lecm-stmeditor:dynamic-role-item">
            <title>Logic ECM Dynamic Role Item</title>
            <parent>cm:content</parent>
            <mandatory-aspects>
                <aspect>lecm-stmeditor:business-role</aspect>
            </mandatory-aspects>
        </type>

        <!-- статичная роль для статуса -->
		<type name="lecm-stmeditor:static-role">
			<title>Logic ECM Static Role</title>
			<parent>cm:content</parent>

			<mandatory-aspects>
				<aspect>lecm-stmeditor:business-role</aspect>
				<aspect>lecm-stmeditor:permissionTypeAspect</aspect>
			</mandatory-aspects>
		</type>

		<!-- динамическая роль для статуса -->
		<type name="lecm-stmeditor:dynamic-role">
			<title>Logic ECM Dynamic Role</title>
			<parent>cm:content</parent>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:business-role</aspect>
				<aspect>lecm-stmeditor:permissionTypeAspect</aspect>
			</mandatory-aspects>
		</type>

		<!-- Список статусов для машины состояний -->
		<type name="lecm-stmeditor:statuses">
			<title>Logic ECM Base Statuses</title>
			<parent>cm:folder</parent>
		</type>

		<!-- Список действий для для статуса -->
		<type name="lecm-stmeditor:actions">
			<title>Logic ECM Base Actions</title>
			<parent>cm:folder</parent>
		</type>

		<type name="lecm-stmeditor:status">
			<title>Logic ECM Base Status</title>
			<parent>cm:folder</parent>
		</type>

		<!-- Объект Статус -->
		<type name="lecm-stmeditor:taskStatus">
			<title>Logic ECM Base Document</title>
			<parent>lecm-stmeditor:status</parent>
			<properties>
				<property name="lecm-stmeditor:startStatus">
					<type>d:boolean</type>
					<mandatory>false</mandatory>
				</property>
				<property name="lecm-stmeditor:forDraft">
					<type>d:boolean</type>
					<mandatory>true</mandatory>
				</property>
				<property name="lecm-stmeditor:statusUUID">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
				<!-- Ссылки на действия -->
				<property name="lecm-stmeditor:takeFinishStateWithTransitionUser">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:takeFinishStateWithTransitionWorkflow">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

                <property name="lecm-stmeditor:takeFinishStateWithTransitionForm">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>

                <property name="lecm-stmeditor:takeFinishStateWithTransitionFormTrans">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>

                <property name="lecm-stmeditor:startStartWorkflow">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:endStartWorkflow">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:startScriptAction">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:endScriptAction">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:startWaitForDocumentChange">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:takeUserWorkflow">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:endTransitionAction">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:staticRoles">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

				<property name="lecm-stmeditor:dynamicRoles">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>

                <property name="lecm-stmeditor:timerDuration">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>

                <property name="lecm-stmeditor:startTimerAction">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>

            </properties>

            <mandatory-aspects>
                <aspect>lecm-stmeditor:transitionStatusAspect</aspect>
            </mandatory-aspects>

		</type>

		<!-- Объект Статус -->
		<type name="lecm-stmeditor:endEvent">
			<title>Logic ECM End Event</title>
			<parent>lecm-stmeditor:status</parent>
			<properties>
				<!-- Ссылки на действия -->
				<property name="lecm-stmeditor:endEventScriptAction">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>
			</properties>
		</type>

		<!-- Объект Действие. Используется как основной объект для расширения конкретный объектов действий -->
		<type name="lecm-stmeditor:action">
			<title>Logic ECM Statemachine Action Object</title>
			<parent>cm:folder</parent>
			<properties>
				<property name="lecm-stmeditor:actionId">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
				<property name="lecm-stmeditor:actionExecution">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</type>

		<!-- Объект описывающий переход для действия -->
		<type name="lecm-stmeditor:transition">
			<title>Logic ECM Statemachine Transition Object</title>
			<parent>cm:content</parent>
			<properties>
				<property name="lecm-stmeditor:transitionExpression">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:transitionStatusAspect</aspect>
			</mandatory-aspects>
		</type>

		<!-- Объект действие StartWorkflow -->
		<type name="lecm-stmeditor:StartWorkflow">
			<title>Logic ECM Statemachine StartWorkflow Action Object</title>
			<parent>lecm-stmeditor:action</parent>
		</type>

		<type name="lecm-stmeditor:StartWorkflowEntity">
			<title>Logic ECM Statemachine StartWorkflow Action Object</title>
			<parent>lecm-stmeditor:action</parent>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:workflowAspect</aspect>
				<aspect>lecm-stmeditor:assigneeAspect</aspect>
			</mandatory-aspects>
		</type>

		<!-- Объект действие FinishStateWithTransition -->
		<type name="lecm-stmeditor:FinishStateWithTransition">
			<title>Logic ECM Statemachine FinishStateWithTransition Action Object</title>
			<parent>lecm-stmeditor:action</parent>
			<properties>
				<property name="lecm-stmeditor:transitionVariable">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</type>

		<!-- Объект действие WaitForDocumentChange -->
		<type name="lecm-stmeditor:WaitForDocumentChange">
			<title>Logic ECM Statemachine WaitForDocumentChange Action Object</title>
			<parent>lecm-stmeditor:action</parent>
		</type>

		<!-- Объект действие UserWorkflow -->
		<type name="lecm-stmeditor:UserWorkflow">
			<title>Logic ECM Statemachine UserWorkflow Action Object</title>
			<parent>lecm-stmeditor:action</parent>
		</type>

		<type name="lecm-stmeditor:UserWorkflowEntity">
			<title>Logic ECM Statemachine UserWorkflow Action Object</title>
			<parent>lecm-stmeditor:action</parent>
			<properties>
				<property name="lecm-stmeditor:workflowLabel">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:workflowAspect</aspect>
			</mandatory-aspects>
		</type>

		<!-- Объект действие TransitionAction -->
		<type name="lecm-stmeditor:TransitionAction">
			<title>Logic ECM Statemachine UserWorkflow Action Object</title>
			<parent>lecm-stmeditor:action</parent>
		</type>

		<!-- Объект действие TimerAction -->
		<type name="lecm-stmeditor:TimerAction">
			<title>Logic ECM Statemachine Timer Action Object</title>
			<parent>lecm-stmeditor:action</parent>
		</type>

		<!-- User Transition -->
		<type name="lecm-stmeditor:userTransition">
			<title>Logic ECM Statemachine User Transition Object</title>
			<parent>cm:folder</parent>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:transitionStatusAspect</aspect>
				<aspect>lecm-stmeditor:transitionLabelAspect</aspect>
			</mandatory-aspects>
		</type>

		<!-- Объект действие ScriptAction -->
		<type name="lecm-stmeditor:ScriptAction">
			<title>Logic ECM Statemachine Script Action Object</title>
			<parent>lecm-stmeditor:action</parent>
		</type>

		<type name="lecm-stmeditor:ScriptActionEntity">
			<title>Logic ECM Statemachine Script Action Object</title>
			<parent>cm:content</parent>
			<properties>
				<property name="lecm-stmeditor:scriptLabel">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
				<property name="lecm-stmeditor:actionScript">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</type>

		<!-- transitionWorkflow -->
		<type name="lecm-stmeditor:transitionWorkflow">
			<title>Logic ECM Statemachine WaitForDocumentChange Action Object</title>
			<parent>cm:folder</parent>
			<mandatory-aspects>
				<aspect>lecm-stmeditor:transitionStatusAspect</aspect>
				<aspect>lecm-stmeditor:transitionLabelAspect</aspect>
				<aspect>lecm-stmeditor:workflowAspect</aspect>
			</mandatory-aspects>
		</type>

        <!-- transition form -->
        <type name="lecm-stmeditor:transitionForm">
            <title>Logic ECM Statemachine Form Action Object</title>
            <parent>cm:folder</parent>
            <mandatory-aspects>
                <aspect>lecm-stmeditor:transitionLabelAspect</aspect>
                <aspect>lecm-stmeditor:transitionFormAspect</aspect>
            </mandatory-aspects>
        </type>

        <!-- transition form -->
        <type name="lecm-stmeditor:transitionFormTrans">
            <title>Logic ECM Statemachine Form Action Object</title>
            <parent>cm:folder</parent>
            <mandatory-aspects>
                <aspect>lecm-stmeditor:transitionLabelAspect</aspect>
                <aspect>lecm-stmeditor:transitionFormAspect</aspect>
                <aspect>lecm-stmeditor:transitionStatusAspect</aspect>
            </mandatory-aspects>
        </type>


        <!--          Workflow Variables         -->
		<type name="lecm-stmeditor:workflowVariableData">
			<title>Logic ECM Statemachine Workflow Variable</title>
			<parent>cm:content</parent>
		</type>

		<type name="lecm-stmeditor:inputVariable">
			<title>Logic ECM Statemachine Input Workflow Variable</title>
			<parent>lecm-stmeditor:workflowVariableData</parent>
			<properties>
				<property name="lecm-stmeditor:inputToType">
					<type>d:text</type>
					<mandatory>true</mandatory>
					<constraints>
						<constraint ref="lecm-stmeditor:toTypeList" />
					</constraints>
				</property>
				<property name="lecm-stmeditor:inputToValue">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
				<property name="lecm-stmeditor:inputFromType">
					<type>d:text</type>
					<mandatory>true</mandatory>
					<constraints>
						<constraint ref="lecm-stmeditor:fromTypeList" />
					</constraints>
				</property>
				<property name="lecm-stmeditor:inputFromValue">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</type>
		<type name="lecm-stmeditor:outputVariable">
			<title>Logic ECM Statemachine Output Workflow Variable</title>
			<parent>lecm-stmeditor:workflowVariableData</parent>
			<properties>
				<property name="lecm-stmeditor:outputToType">
					<type>d:text</type>
					<mandatory>true</mandatory>
					<constraints>
						<constraint ref="lecm-stmeditor:toTypeList" />
					</constraints>
				</property>
				<property name="lecm-stmeditor:outputToValue">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
				<property name="lecm-stmeditor:outputFromType">
					<type>d:text</type>
					<mandatory>true</mandatory>
					<constraints>
						<constraint ref="lecm-stmeditor:fromTypeList" />
					</constraints>
				</property>
				<property name="lecm-stmeditor:outputFromValue">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</type>
		<!--         #Workflow Variables         -->

        <type name="lecm-stmeditor:documentField">
            <title>Logic ECM Statemachine Document Field</title>
            <parent>cm:content</parent>
            <properties>
                <property name="lecm-stmeditor:editableField">
                    <type>d:boolean</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <!-- Condition Access Object -->
        <type name="lecm-stmeditor:conditionAccess">
            <title>Condition Access Object</title>
            <parent>cm:content</parent>
            <properties>
                <property name="lecm-stmeditor:condition">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-stmeditor:conditionErrorMessage">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-stmeditor:hideAction">
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
            </properties>
        </type>

        <!-- Versions Root -->
        <type name="lecm-stmeditor:versions">
            <title>Versions Root</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-stmeditor:last_version">
                    <type>d:long</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <!-- Version Object -->
        <type name="lecm-stmeditor:versionContainer">
            <title>Version Object</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-stmeditor:version">
                    <type>d:long</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-stmeditor:publishDate">
                    <type>d:datetime</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-stmeditor:publishComment">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <type name="lecm-stmeditor:alternative">
            <title>Version Object</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-stmeditor:alternativeExpression">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
            <associations>
                <association name="lecm-stmeditor:alternativeStatus">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-stmeditor:status</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>
        </type>

    </types>

	<aspects>

		<aspect name="lecm-stmeditor:transitionStatusAspect">
			<title>Transition Status Aspect</title>
            <properties>
                <property name="lecm-stmeditor:stopSubWorkflows">
                    <type>d:boolean</type>
                </property>
            </properties>
            <associations>
                <association name="lecm-stmeditor:transitionStatus">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>lecm-stmeditor:status</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>
			</associations>
		</aspect>

		<aspect name="lecm-stmeditor:transitionLabelAspect">
			<title>Transition Label Aspect</title>
			<properties>
				<property name="lecm-stmeditor:transitionLabel">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</aspect>

        <aspect name="lecm-stmeditor:transitionFormAspect">
            <title>Transition Label Form</title>
            <properties>
                <property name="lecm-stmeditor:transitionFormType">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-stmeditor:transitionFormFolder">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
            </properties>
        </aspect>

        <aspect name="lecm-stmeditor:workflowAspect">
			<title>Workflow Aspect</title>
			<properties>
				<property name="lecm-stmeditor:workflowId">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</aspect>

        <aspect name="lecm-stmeditor:assigneeAspect">
            <title>Assignee Aspect</title>
            <properties>
                <property name="lecm-stmeditor:assignee">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </aspect>

		<aspect name="lecm-stmeditor:business-role">
			<title>Business Role Association</title>
			<associations>
				<association name="lecm-stmeditor:role-assoc">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>lecm-orgstr:business-role</class>
						<mandatory>true</mandatory>
						<many>false</many>
					</target>
				</association>
			</associations>
		</aspect>

		<aspect name="lecm-stmeditor:permissionTypeAspect">
			<title>Business Role PermissionType</title>
			<properties>
				<property name="lecm-stmeditor:permissionTypeValue">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</aspect>

	</aspects>

</model>