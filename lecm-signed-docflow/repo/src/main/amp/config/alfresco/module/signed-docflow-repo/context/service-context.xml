<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<bean id="unicloudService" class="ru.it.lecm.signed.docflow.UnicloudService" init-method="init">
		<!--<property name="gateWcfService" ref="gateWcfService.https"/>-->
		<property name="gateWcfService" ref="gateWcfService.http"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="contentService" ref="contentService"/>
		<property name="signedDocflowService" ref="signedDocflowService"/>
	</bean>

	<bean id="lecm.signed-docflow.model-bootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/signed-docflow-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/signed-docflow</value>
			</list>
		</property>
	</bean>

	<bean id="lecm.signed-docflow.dictionary-bootstrap"
		  parent="lecmDictionaryBootstrap"
		  depends-on="lecm.signed-docflow.model-bootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap,
						ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap,
						ru.it.lecm.business-journal.business-journal-repo.businessJournalDictionaryBootstrap,
						businessJournalLogEventsPolicy, regNumbers.regNumbersTemplatesDicBootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-business-journal-eventCategory-items.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-business-journal-objectType-items.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-signed-docflow-roles-items.xml</value>
				<value>alfresco/module/${artifactId}/models/signed-docflow-regnumbers.xml</value>
			</list>
		</property>
	</bean>

	<bean id="lecm.signed-docflow.mail-templates-bootstrap" parent="spacesStoreImporter"
		  depends-on="lecm.signed-docflow.model-bootstrap">
		<property name="useExistingStore" value="true" />
		<property name="bootstrapViews">
			<list>
				<props>
					<prop key="uuidBinding">REMOVE_EXISTING</prop>
					<prop key="path">/${spaces.company_home.childname}/${spaces.dictionary.childname}/${spaces.templates.email.childname}</prop>
					<prop key="location">alfresco/module/${artifactId}/models/signed-docflow-mail-templates.xml</prop>
					<prop key="messages">alfresco/messages/bootstrap-spaces</prop>
				</props>
			</list>
		</property>
	</bean>


	<!-- Настройки прав доступа на каталоги в рамках сервиса -->
	<bean id="signedDocflowServicePermissions" parent="ServiceFolderPermissionHelper" depends-on="lecm.signed-docflow.model-bootstrap, lecm.signed-docflow.dictionary-bootstrap">
		<property name="serviceBean" ref="signedDocflowService"/>
		<property name="permissionsList">
			<list>
				<value>alfresco/module/${artifactId}/models/directories-permissions.xml</value>
			</list>
		</property>
	</bean>

	<bean id="signedDocflow.arm.myProfile.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
	      depends-on="userProfile.arm.LogicEcmBootstrap">
		<property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/arm/default-arm-my-profile-items.xml</value>
			</list>
		</property>
	</bean>

	<bean id="cspdllpathstr" class="java.lang.String">
        <constructor-arg value="${cspdll.path}"/>
    </bean>

    <bean id="catalinahomestr" class="java.lang.String">
        <constructor-arg value="${catalina.home}"/>
    </bean>

    <bean id="enforcedurlstr" class="java.lang.String">
        <constructor-arg value="${enforced.url}"/>
    </bean>

	<util:constant id="signedDocflowFolder" static-field="ru.it.lecm.signed.docflow.beans.SignedDocflowImpl.SIGNED_DOCFLOW_FOLDER"/>
	<bean id="signedDocflowService" class="ru.it.lecm.signed.docflow.beans.SignedDocflowImpl" parent="baseBean"
		  depends-on="lecm.signed-docflow.model-bootstrap">
		<property name="folders">
			<map>
				<entry key="#{signedDocflowFolder}" value="Сервис ЮЗД"/>
			</map>
		</property>

		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="versionService" ref="versionService"/>
		<property name="contentService" ref="contentService"/>
		<property name="behaviourFilter" ref="policyBehaviourFilter"/>
		<property name="lockService" ref="lockService"/>
		<property name="cspdllpath" ref="cspdllpathstr"/>
        <property name="catalinahome" ref="catalinahomestr"/>
        <property name="enforcedurl" ref="enforcedurlstr"/>
	</bean>

	<bean id="sendContentToPartnerService" class="ru.it.lecm.signed.docflow.SendContentToPartnerService" init-method="init"
		  depends-on="lecm.signed-docflow.mail-templates-bootstrap">
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="unicloudService" ref="unicloudService"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="mailService" ref="mailService"/>
		<property name="templateService" ref="templateService"/>
		<property name="signedDocflowService" ref="signedDocflowService"/>
		<property name="fileFolderService" ref="fileFolderService"/>
		<property name="zipSignedContentService" ref="zipSignedContentService"/>
		<property name="regNumbersService" ref="regNumbersService"/>
		<property name="defaultFromEmail" value="${mail.from.default}"/>
	</bean>

	<bean id="zipSignedContentService" class="ru.it.lecm.signed.docflow.ZipSignedContentService"
		  parent="baseBean" init-method="init">
		<property name="fileFolderService" ref="fileFolderService"/>
		<property name="signedDocflowService" ref="signedDocflowService"/>
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>

	<bean id="receiveContentByEmailService" class="ru.it.lecm.signed.docflow.ReceiveContentByEmailService"
		  parent="baseBean" init-method="init">
		<property name="zipSignedContentService" ref="zipSignedContentService"/>
		<property name="mailHost" value="imap.googlemail.com"/>
		<property name="mailUsername" value="datateh.alfresco"/>
		<property name="mailPassword" value="ZSE4zse4"/>
		<property name="mailProtocol" value="imaps"/>
		<property name="mailInboxFolder" value="INBOX"/>
		<property name="mailDestinationFolder" value="signedDocflowProcessedMail"/>
	</bean>

</beans>
