<?xml version='1.0' encoding='UTF-8'?>

<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
							http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<util:list id="eds.models">
		<value>alfresco/module/${artifactId}/models/lecm-eds-global-settings-model.xml</value>
	</util:list>
	<util:list id="eds.document.models">
        <value>alfresco/module/${artifactId}/models/lecm-doc-type-dictionary-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-eds-document-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-eds-aspects-model.xml</value>
	</util:list>
	<util:list id="eds.models.labels">
		<value>alfresco/module/${artifactId}/messages/lecm-eds-document-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-eds-aspects-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-eds-global-settings-model</value>
	</util:list>
	<bean id="eds.models.bootstrap" parent="modelsToRepositoryLoader"
		  depends-on="dictionaryBootstrap,
					  documents.LogicEcmModelsBootstrap,
					  arm.LogicEcmBootstrap,
					  ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap,
					  documents.dictionaries.LogicEcmModelsBootstrap,
					  dictionary.fileRegister.LogicEcmModelsBootstrap,
					  operative.storage.model.bootstrap"
		  p:models-ref="eds.document.models"
		  p:labels-ref="eds.models.labels"/>

	<bean id="eds.other.models.bootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap,
					  documents.LogicEcmModelsBootstrap,
					  ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap,
					  documents.dictionaries.LogicEcmModelsBootstrap,
					  arm.LogicEcmModelsBootstrap,
					  dictionary.fileRegister.LogicEcmModelsBootstrap"
		  p:models-ref="eds.models"
		  p:labels-ref="eds.models.labels"/>

	<util:list id="eds.dictionaries">
		<value>alfresco/module/${artifactId}/dictionaries/lecm-eds-potential-roles.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-eds-br-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-eds-nt-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-eds-objectType-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-business-journal-eventCategory-items.xml</value>
        <value>alfresco/module/${artifactId}/dictionaries/lecm-document-type.xml</value>
	</util:list>
	<bean id="eds.dictionary.bootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap,
					  ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap,
					  businessJournalLogEventsPolicy"
		  p:dictionaries-ref="eds.dictionaries"/>

	<bean id="eds.arm.filters.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="arm.LogicEcmModelsBootstrap, armService, arm.LogicEcmBootstrap, arm.filters.LogicEcmBootstrap">
		<property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-eds-arm-filters.xml</value>
			</list>
		</property>
	</bean>

	<util:constant id="EDS_GLOBAL_SETTINGS_FOLDER_ID" static-field="ru.it.lecm.eds.api.EDSGlobalSettingsService.EDS_GLOBAL_SETTINGS_FOLDER_ID"/>
	<util:constant id="EDS_GLOBAL_SETTINGS_FOLDER_NAME" static-field="ru.it.lecm.eds.api.EDSGlobalSettingsService.EDS_GLOBAL_SETTINGS_FOLDER_NAME"/>
	<util:map id="eds.global-settings.folders">
		<entry key="#{EDS_GLOBAL_SETTINGS_FOLDER_ID}" value="#{EDS_GLOBAL_SETTINGS_FOLDER_NAME}"/>
	</util:map>
	<bean id="eds.global-settings.service" parent="baseBean"
            depends-on="eds.other.models.bootstrap"
		  class="ru.it.lecm.eds.EDSGlobalSettingsServiceImpl"
		  p:orgstructureService-ref="serviceOrgstructure"
		  p:namespaceService-ref="namespaceService"
		  p:dictionaryService-ref="serviceDictionary"
		  p:folders-ref="eds.global-settings.folders"
		  p:documentGlobalSettingsService-ref="documents.global-settings.service"/>

    <bean id="eds.reports.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="reportsEditorService,reportsEditor.LogicEcmDictionariesBootstrap,
          reportsEditorOnCreateAssocsPolicy,reportsEditorTemplatePolicy,
          dataSourcePolicy,reportDescriptorPolicy">
        <property name="rootPath" value="/Business platform/LECM/Сервис Редактор Отчетов/Отчеты"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/reports/eds-by-kind-stat.xml</value>
                <value>alfresco/module/${artifactId}/reports/eds-by-subject-stat.xml</value>
                <value>alfresco/module/${artifactId}/reports/eds-by-subject-stat-all-in.xml</value>
                <value>alfresco/module/${artifactId}/reports/eds-by-type-stat.xml</value>
            </list>
        </property>
        <property name="xmlImportListener" ref="eds.reportsDeployer"/>
    </bean>

    <bean id="eds.reportsDeployer" parent="reportsDeployer">
        <property name="reportsForDeploy">
            <list>
                <value>eds-by-kind-stat</value>
                <value>eds-by-subject-stat</value>
                <value>eds-by-subject-stat-all-in</value>
                <value>eds-by-type-stat</value>
            </list>
        </property>
    </bean>

    <bean id="eds.document.businessJournalDictionaryBootstrap"
          parent="lecmDictionaryBootstrap"
          depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap, ru.it.lecm.business-journal.business-journal-repo.businessJournalDictionaryBootstrap, businessJournalLogEventsPolicy">
        <property name="dictionaries">
            <list>
                <value>alfresco/module/eds-documents-repo/models/lecm-business-journal-eventCategory-items.xml</value>
            </list>
        </property>
    </bean>

    <bean id="eds.documents.arm.settings.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="arm.settings.LogicEcmBootstrap">
        <property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/arm/eds-documents-settings-arm.xml</value>
            </list>
        </property>
    </bean>

	<bean id="eds.arm.settings.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="arm.LogicEcmBootstrap, armService, arm.filters.LogicEcmBootstrap, eds.arm.filters.LogicEcmBootstrap, documents.LogicEcmConnectionTypesBootstrap">
		<property name="rootPath" value="/Business platform/LECM/Сервис АРМ"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/arm/default-arm-sed.xml</value>
			</list>
		</property>
	</bean>

    <bean id="eds.ConfigToRepositoryLoader" parent="configsToRepositoryLoader">
        <property name="configs">
            <list>
                <value>alfresco/module/${artifactId}/reports/configs/eds.properties</value>
            </list>
        </property>
    </bean>
    <bean id="edsService" class="ru.it.lecm.eds.EDSDocumentServiceImpl" parent="baseBean"
          depends-on="eds.models.bootstrap">
        <property name="calendarBean" ref="WorkCalendarService"/>
        <property name="calendarDayTypeString" value="к.д."/>
        <property name="workDayTypeString" value="р.д."/>
        <property name="limitlessString" value="Без срока"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
    </bean>

	<bean id="edsExecutorPolicy" class="ru.it.lecm.eds.policy.EDSExecutorPolicy"
		   init-method="init" depends-on="eds.models.bootstrap, eds.dictionary.bootstrap">
		<property name="authenticationService" ref="authenticationService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="notificationsService" ref="notificationsService"/>
		<property name="lecmPermissionService" ref="lecmPermissionServiceBean"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="policyComponent" ref="policyComponent"/>
		<property name="documentService" ref="documentService"/>
		<property name="stateMachineService" ref="stateMachineHelper"/>
	</bean>

	<bean id="filterByDictionaryAttributeValueProcessor" class="ru.it.lecm.eds.processors.FilterByDictionaryAttributeValueProcessor" parent="searchQueryBaseProccesor">
		<property name="id" value="FILTER_BY_DICTIONARY_ATTRIBUTE_VALUE"/>
		<property name="dictionaryBean" ref="serviceDictionary"/>
	</bean>
	<bean id="edsBaseDocumentTypeBean" class="ru.it.lecm.eds.policy.EDSBaseDocumentTypePolicy"
		  init-method="init" abstract="true">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="edsDocumentService" ref="edsService"/>
		<property name="documentService" ref="documentService"/>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="stateMachineService" ref="stateMachineHelper"/>
		<property name="errandsService" ref="errandsService"/>
	</bean>
</beans>
