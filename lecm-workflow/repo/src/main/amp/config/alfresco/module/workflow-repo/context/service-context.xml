<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<util:constant id="WORKFLOW_FOLDER" static-field="ru.it.lecm.workflow.beans.WorkflowFoldersServiceImpl.WORKFLOW_FOLDER"/>
	<util:constant id="WORKFLOW_GLOBAL_RESULT_FOLDER" static-field="ru.it.lecm.workflow.beans.WorkflowFoldersServiceImpl.WORKFLOW_GLOBAL_RESULT_FOLDER"/>
	<util:constant id="ASSIGNEES_LISTS_WORKING_COPY_FOLDER" static-field="ru.it.lecm.workflow.beans.WorkflowFoldersServiceImpl.ASSIGNEES_LISTS_WORKING_COPY_FOLDER"/>
	<util:map id="lecm.workflow.folders">
		<entry key="#{WORKFLOW_FOLDER}" value="Сервис Бизнес процессов"/>
		<entry key="#{WORKFLOW_GLOBAL_RESULT_FOLDER}" value="Сервис Бизнес процессов/Результаты исполнения"/>
		<entry key="#{ASSIGNEES_LISTS_WORKING_COPY_FOLDER}" value="Сервис Бизнес процессов/Рабочии копии списков исполнителей"/>
	</util:map>
	<bean id="lecm.workflow.folders.bootstrap" parent="baseBean"
		  class="ru.it.lecm.workflow.beans.WorkflowFoldersServiceImpl"
		  p:folders-ref="lecm.workflow.folders"/>

	<util:list id="workflow.models">
		<value>alfresco/module/${artifactId}/models/lecm-workflow-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-workflow-result.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-route-aspects-model.xml</value>
	</util:list>
	<util:list id="workflow.labels">
		<value>alfresco/module/${artifactId}/messages/lecm-workflow-result</value>
		<value>alfresco/module/${artifactId}/messages/lecm-workflow</value>
	</util:list>
	<bean id="workflow.model.bootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap"
		  p:models-ref="workflow.models"
		  p:labels-ref="workflow.labels"/>

	<bean id="workflow.utils" class="ru.it.lecm.workflow.Utils"
		  depends-on="nodeService dictionaryService serviceOrgstructure versionService documentAttachmentsService"/>

	<bean id="lecmWorkflowService" abstract="true" parent="baseBean"
		  class="ru.it.lecm.workflow.beans.WorkflowServiceAbstract"
		  depends-on="workflow.model.bootstrap"
		  p:orgstructureService-ref="serviceOrgstructure"
		  p:lecmPermissionService-ref="lecmPermissionServiceBean"
		  p:documentService-ref="documentService"
		  p:documentMembersService-ref="documentMembersService"
		  p:notificationsService-ref="notificationsService"
		  p:workflowService-ref="WorkflowService"
		  p:workflowFoldersService-ref="lecm.workflow.folders.bootstrap"
		  p:delegationService-ref="delegationService"
		  p:workflowResultListService-ref="workflowResultListService"
		  p:stateMachineService-ref="stateMachineHelper"/>

	<bean id="workflowAssigneesListService" parent="baseBean"
		  class="ru.it.lecm.workflow.beans.WorkflowAssigneesListServiceImpl"
		  p:workCalendarService-ref="WorkCalendarService"
		  p:wCalendarService-ref="WCalendarService"
		  p:orgstructureService-ref="serviceOrgstructure"
		  p:workflowFoldersService-ref="lecm.workflow.folders.bootstrap"
		  p:copyService-ref="copyService"
		  p:delegationService-ref="delegationService"
		  p:behaviourFilter-ref="policyBehaviourFilter"/>

	<bean id="workflowResultListService" parent="baseBean"
		  class="ru.it.lecm.workflow.beans.WorkflowResultListServiceImpl"
		  p:workflowFoldersService-ref="lecm.workflow.folders.bootstrap"/>

	<bean id="routeService" parent="baseBean"
		  class="ru.it.lecm.workflow.beans.RouteServiceImpl"
		  p:workflowFoldersServiceImpl-ref="lecm.workflow.folders.bootstrap"
		  p:orgstructureBean-ref="serviceOrgstructure"/>

	<!-- Настройки прав доступа на каталоги в рамках сервиса -->
	<bean id="${groupId}.${artifactId}.workflowServicePermissions" parent="ServiceFolderPermissionHelper"
	      depends-on="workflow.model.bootstrap, lecm.workflow.folders.bootstrap" >
		<property name="serviceBean" ref="lecm.workflow.folders.bootstrap"/>
		<property name="permissionsList">
			<list>
				<value>alfresco/module/${artifactId}/permissions/directories-permissions.xml</value>
			</list>
		</property>
	</bean>

</beans>
