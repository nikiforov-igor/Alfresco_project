<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:activiti="http://activiti.org/bpmn"
             typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://www.it.ru/logicECM/errands/workflow/requestDueDateChange/1.0">
	<process id="errandsRequestDueDateChange" name="Запросить изменение срока поручения">

        <startEvent id="startRequestDueDateChange" name="Запрос переноса срока поручения" activiti:formKey="lecmErrandWf:requestDueDateChange"></startEvent>

        <scriptTask id="requestDueDateChange" scriptFormat="javascript">
            <extensionElements>
                <activiti:executionListener event="start" class="org.alfresco.repo.workflow.activiti.listener.ScriptExecutionListener">
                    <activiti:field name="script">
                        <activiti:string>
                            <!--errands.requestDueDateChange();                               //stub!!!-->
                        </activiti:string>
                    </activiti:field>
                </activiti:executionListener>
            </extensionElements>
            <script></script>
        </scriptTask>

        <receiveTask id="requestDueDateChangeReceiveTask" name="Receive Task"></receiveTask>

        <userTask id="changeRequestedDueDate" name="Перенести срок поручения" activiti:formKey="lecmErrandWf:changeRequestedDueDate">
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>
                            task.setAssignee("admin");   //stub!!!
                            task.setVariable("lecmErrandWf_changeRequestedDueDateNewDate", task.getVariable("lecmErrandWf_requestDueDateChangeNewDate"));
                            task.setVariable("lecmErrandWf_changeRequestedDueDateReason", task.getVariable("lecmErrandWf_requestDueDateChangeReason"));
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>

                <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>
                            //<![CDATA[
			            //]]>
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>

            </extensionElements>
        </userTask>

        <endEvent id="endRequestDueDateChange" name="End"></endEvent>

        <sequenceFlow id="flow1" name="" sourceRef="startRequestDueDateChange" targetRef="requestDueDateChange"></sequenceFlow>
        <sequenceFlow id="flow2" name="" sourceRef="requestDueDateChange" targetRef="requestDueDateChangeReceiveTask"></sequenceFlow>
        <sequenceFlow id="flow3" name="" sourceRef="requestDueDateChangeReceiveTask" targetRef="changeRequestedDueDate"></sequenceFlow>
        <sequenceFlow id="flow4" name="" sourceRef="changeRequestedDueDate" targetRef="endRequestDueDateChange"></sequenceFlow>

    </process>
</definitions>