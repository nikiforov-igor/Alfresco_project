<?xml version="1.0" encoding="UTF-8"?>
<!--
	Договорная деятельность.

Фильтры отчета:
•	Период 
•	Контрагент
•	Актуальные/все
•	Сумма
•	Вид договора
•	Тематика договора

Выходные данные отчета:
•	Номер договора
•	(A) Контрагент
•	(A) Вид договора

•	(A) Тематика договора
•	(!) Статус договора
•	Дата начала действия договора
•	Дата завершения действия договора
•	(!) Исполнитель

  -->

<ds.config>
    <report.descriptor mnem="contracts-list">
        <l18>
            <item key="RU_RU" value="Реестр договоров"/>
        </l18>
        <provider mnem="DSProviderReestrDogovorov" javaClass="ru.it.lecm.contracts.reports.DSProviderReestrDogovorov" >
           <l18>
               <item key="RU_RU" value="Провайдер Jasper отчётов: Договорная деятельность"/>
           </l18>
        </provider>
        <templates>
            <template mnem="tmpl" type="JASPER" filename="contracts-list_tmpl.jrxml"/>
        </templates>
        <roles>CONTRACT_READER,CONTRACT_RECORDER,CONTRACT_EXECUTOR,CONTRACT_CURATOR,CONTRACT_SIGNER</roles>
    </report.descriptor>

	<query.descriptor>
		<offset>0</offset>
		<limit>-1</limit>
		<pgsize>-1</pgsize>
		<allVersions>true</allVersions>
		<preferedType>lecm-contract:document</preferedType>
		<isMultiRow>true</isMultiRow>
		<isCustom>false</isCustom>
		<queryText><![CDATA[+TYPE:"lecm-contract:document"]]></queryText>
	</query.descriptor>

	<fields>
        <!-- Parameters-->
        <field jrFldName="dateStart" order="0" queryFldName="{lecm-contract:startDate}" displayName="Дата начала действия"
               javaValueClass="java.util.Date" alfrescoType="d:date">
            <parameter mnem="PARAM_TYPE_RANGE" paramType="PARAM_TYPE_RANGE">
                <l18>
                    <item key="RU_RU" value="Диапазон"/>
                </l18>
                <label1>
                    <item key="RU_RU" value="С"/>
                </label1>
                <label2>
                    <item key="RU_RU" value="По"/>
                </label2>
            </parameter>
        </field>

        <field jrFldName="dateEnd" order="1" queryFldName="{lecm-contract:endDate}" displayName="Дата окончания действия"
               javaValueClass="java.util.Date" alfrescoType="d:date">
            <parameter mnem="PARAM_TYPE_RANGE" paramType="PARAM_TYPE_RANGE">
                <l18>
                    <item key="RU_RU" value="Диапазон"/>
                </l18>
                <label1>
                    <item key="RU_RU" value="С"/>
                </label1>
                <label2>
                    <item key="RU_RU" value="По"/>
                </label2>
            </parameter>
        </field>

        <field jrFldName="contractSum" order="2" queryFldName="{lecm-contract:totalAmount}" displayName="Сумма"
               javaValueClass="java.lang.Float" alfrescoType="d:float" >
            <parameter mnem="PARAM_TYPE_RANGE" paramType="PARAM_TYPE_RANGE">
                <l18>
                    <item key="RU_RU" value="Диапазон"/>
                </l18>
                <label1>
                    <item key="RU_RU" value="От"/>
                </label1>
                <label2>
                    <item key="RU_RU" value="До"/>
                </label2>
            </parameter>
        </field>

        <field jrFldName="contragents" order="3" queryFldName="{lecm-contract:partner-assoc-ref}" displayName="Контрагент(ы)"
               javaValueClass="java.lang.String" alfrescoType="lecm-contractor:contractor-type">
            <l18>
                <item key="RU_RU" value="Контрагент(ы)"/>
            </l18>
            <parameter mnem="PARAM_TYPE_LIST" paramType="PARAM_TYPE_LIST">
                <l18> <item key="RU_RU" value="Список"/> </l18>
            </parameter>
        </field>

        <field alfrescoType="lecm-contract-dic:contract-type" order="4" displayName="Вид договора"
               javaValueClass="java.lang.String" jrFldName="contractType" queryFldName="{lecm-contract:typeContract-assoc-ref}">
            <l18>
                <item key="RU_RU" value="Вид договора"/>
            </l18>
            <parameter mnem="PARAM_TYPE_LIST" paramType="PARAM_TYPE_LIST">
                <l18> <item key="RU_RU" value="Список"/> </l18>
            </parameter>
        </field>

        <field alfrescoType="lecm-doc-dic:subjects" order="5" displayName="Тематика договора"
               javaValueClass="java.lang.String" jrFldName="contractSubject" queryFldName="{lecm-document:subject-assoc-ref}">
            <l18>
                <item key="RU_RU" value="Тематика договора"/>
            </l18>
            <parameter mnem="PARAM_TYPE_LIST" paramType="PARAM_TYPE_LIST">
                <l18> <item key="RU_RU" value="Список"/> </l18>
            </parameter>
        </field>

        <field alfrescoType="d:boolean" order="6" displayName="Только актуальные"
               javaValueClass="java.lang.Boolean" jrFldName="contractActualOnly" queryFldName="#contractActualOnly">
            <l18>
                <item key="RU_RU" value="Только актуальные"/>
            </l18>
            <parameter mnem="PARAM_TYPE_VALUE" paramType="PARAM_TYPE_VALUE">
                <l18> <item key="RU_RU" value="Значение"/> </l18>
            </parameter>
        </field>

        <!-- данные для отчета-->
        <field queryFldName="{lecm-contract:regNumSystem}"
               jrFldName="col_Regnum"
               displayName="Регистрационный номер договора" javaValueClass="java.lang.String"/>

		<field jrFldName="col_numContragent" queryFldName="lecm-contract:regNumContractor" displayName="Регистрационный номер контрагента" />

		<!-- Данные по контрагенту (с типом "lecm-contractor:contractor-type") 
			в виде "а-ля форматной" строки
		  -->
		<field jrFldName="col_Contragent.name"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:shortname}" displayName="Контрагент"/>
		<field jrFldName="col_Contragent.phone" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:phone}" displayName="Тел Контрагента" />

		<!-- Данные по "Виду договора" (с типом "lecm-contract-dic:contract-type") -->
		<field jrFldName="col_DocKind" queryFldName="{lecm-contract:typeContract-assoc/cm:name}" displayName="Вид договора" />

		<!-- Данные по "Тематика договора" (с типом "lecm-contract-dic:contract-subjects") -->
		<field jrFldName="col_Theme" queryFldName="{lecm-document:subject-assoc/cm:name}" displayName="Тематика.Название" />

		<!-- Статус -->
		<field jrFldName="col_Status" queryFldName="{lecm-statemachine:status}" displayName="Статус" />

        <field jrFldName="col_DateStart" queryFldName="{lecm-contract:startDate}" displayName="Дата начала действия договора"
               javaValueClass="java.util.Date"/>

        <field jrFldName="col_DateEnd" queryFldName="{lecm-contract:endDate}" displayName="Дата окончания действия договора"
               javaValueClass="java.util.Date"/>

		<field jrFldName="col_Executor" queryFldName="{~AUTHOR}" displayName="Исполнитель" />
	</fields>
</ds.config>
