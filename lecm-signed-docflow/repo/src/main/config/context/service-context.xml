<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<import resource="classpath:gate-wcf-service-context.xml"/>
	<import resource="classpath:alfresco/module/${artifactId}/context/webscript-context.xml" />
	<import resource="classpath:alfresco/module/${artifactId}/context/policy-context.xml" />

	<bean id="unicloudService" class="ru.it.lecm.signed.docflow.UnicloudService" init-method="init">
		<property name="gateWcfService" ref="gateWcfService.https"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="contentService" ref="contentService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="signedDocflowService" ref="signedDocflowService"/>
	</bean>

	<bean id="lecm.signed-docflow.model-bootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/signed-docflow-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/signed-docflow</value>
			</list>
		</property>
	</bean>

	<bean id="lecm.signed-docflow.dictionary-bootstrap"
		  parent="lecmDictionaryBootstrap"
		  depends-on="lecm.signed-docflow.model-bootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap,
						ru.it.lecm.business-journal.business-journal-repo.businessJournalBootstrap,
						ru.it.lecm.business-journal.business-journal-repo.businessJournalDictionaryBootstrap,
						businessJournalLogEventsPolicy, regNumbers.regNumbersTemplatesDicBootstrap">
		<property name="createOrUpdateDictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-business-journal-eventCategory-items.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-business-journal-objectType-items.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-signed-docflow-roles-items.xml</value>
				<value>alfresco/module/${artifactId}/models/signed-docflow-regnumbers.xml</value>
			</list>
		</property>
	</bean>

	<bean id="lecm.signed-docflow.mail-templates-bootstrap" parent="spacesStoreImporter"
		  depends-on="lecm.signed-docflow.model-bootstrap">
		<property name="useExistingStore" value="true" />
		<property name="bootstrapViews">
			<list>
				<props>
					<prop key="uuidBinding">REMOVE_EXISTING</prop>
					<prop key="path">/${spaces.company_home.childname}/${spaces.dictionary.childname}/${spaces.templates.email.childname}</prop>
					<prop key="location">alfresco/module/${artifactId}/models/signed-docflow-mail-templates.xml</prop>
					<prop key="messages">alfresco/messages/bootstrap-spaces</prop>
				</props>
			</list>
		</property>
	</bean>

	<util:constant id="signedDocflowFolder" static-field="ru.it.lecm.signed.docflow.beans.SignedDocflowImpl.SIGNED_DOCFLOW_FOLDER"/>
	<bean id="signedDocflowService" class="ru.it.lecm.signed.docflow.beans.SignedDocflowImpl" parent="baseBean"
		  depends-on="lecm.signed-docflow.model-bootstrap" init-method="init">
		<property name="folders">
			<map>
				<entry key="#{signedDocflowFolder}" value="Сервис ЮЗД"/>
			</map>
		</property>
		<property name="nodeService" ref="nodeService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="unicloudService" ref="unicloudService"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="authService" ref="authenticationService"/>
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="versionService" ref="versionService"/>
		<property name="contentService" ref="contentService"/>
		<property name="behaviourFilter" ref="policyBehaviourFilter"/>
	</bean>

	<bean id="sendContentToPartnerService" class="ru.it.lecm.signed.docflow.SendContentToPartnerService" init-method="init"
		  depends-on="lecm.signed-docflow.mail-templates-bootstrap">
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="unicloudService" ref="unicloudService"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="lockService" ref="lockService"/>
		<property name="mailService" ref="mailService"/>
		<property name="templateService" ref="templateService"/>
		<property name="signedDocflowService" ref="signedDocflowService"/>
		<property name="fileFolderService" ref="fileFolderService"/>
		<property name="zipSignedContentService" ref="zipSignedContentService"/>
		<property name="regNumbersService" ref="regNumbersService"/>
		<property name="defaultFromEmail" value="${mail.from.default}"/>
	</bean>
	
	<bean id="zipSignedContentService" class="ru.it.lecm.signed.docflow.ZipSignedContentService" init-method="init">
		<property name="nodeService" ref="nodeService"/>
		<property name="fileFolderService" ref="fileFolderService"/>
		<property name="signedDocflowService" ref="signedDocflowService"/>
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>

</beans>
