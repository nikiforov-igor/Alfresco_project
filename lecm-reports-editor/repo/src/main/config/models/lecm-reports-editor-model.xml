<?xml version="1.0" encoding="UTF-8"?>

<model name="lecm-rpeditor:model" xmlns="http://www.alfresco.org/model/dictionary/1.0">
    <description>Reports Editor Model</description>
    <author>DBashmakov</author>
    <version>1.0</version>
    <imports>
        <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
        <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
        <import uri="http://www.it.ru/lecm/dictionary/1.0" prefix="lecm-dic"/>
        <import uri="http://www.it.ru/lecm/org/structure/1.0" prefix="lecm-orgstr"/>
    </imports>

    <namespaces>
        <namespace uri="http://www.it.ru/logicECM/reports/editor/1.0" prefix="lecm-rpeditor"/>
    </namespaces>

    <constraints>
        <constraint name="lecm-rpeditor:unique-property-const" type="ru.it.lecm.base.constraint.UniqueLongPropertyConstraint"/>
    </constraints>

    <types>
        <!-- Справочники-->
        <!-- Тип отчета -->
        <type name="lecm-rpeditor:reportType">
            <title>Report Type</title>
            <parent>lecm-dic:plane_dictionary_values</parent>
            <properties>
                <property name="lecm-rpeditor:reportTypeCode">
                    <title>Report Type Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <!-- Тип провайдера-->
        <type name="lecm-rpeditor:reportProvider">
            <title>Report Provider</title>
            <parent>lecm-dic:plane_dictionary_values</parent>
            <properties>
                <property name="lecm-rpeditor:reportProviderCode">
                    <title>Report Provider Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-rpeditor:reportProviderClass">
                    <title>Report Provider Class</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <!-- Тип колонок в отчете-->
        <type name="lecm-rpeditor:reportColumnType">
            <title>Report Column Type</title>
            <parent>lecm-dic:plane_dictionary_values</parent>
            <properties>
                <property name="lecm-rpeditor:reportColumnTypeCode">
                    <title>Report Column Type Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-rpeditor:reportColumnTypeClass">
                    <title>Report Column Type Class</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <!-- Тип параметра-->
        <type name="lecm-rpeditor:reportParameterType">
            <title>Report Parameter Type</title>
            <parent>lecm-dic:plane_dictionary_values</parent>
            <properties>
                <property name="lecm-rpeditor:reportParameterTypeCode">
                    <title>Report Parameter Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
                <property name="lecm-rpeditor:reportParameterTypeLabel1">
                    <title>Report Parameter Label 1</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-rpeditor:reportParameterTypeLabel2">
                    <title>Report Parameter Label 2</title>
                    <type>d:text</type>
                </property>
            </properties>
        </type>

        <!-- Шаблон отчета -->
        <type name="lecm-rpeditor:reportTemplate">
            <title>Report Template</title>
            <parent>cm:cmobject</parent>
            <properties>
                <property name="lecm-rpeditor:templateCode">
                    <title>Template Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref="lecm-rpeditor:unique-property-const"/>
                    </constraints>
                </property>
                <property name="lecm-rpeditor:reportTemplateType-text-content">
                    <title>Type Text Content</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-rpeditor:reportTemplateType-ref">
                    <title>Type Ref</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-rpeditor:reportTemplateFile-text-content">
                    <title>Report Template File Assoc Text</title>
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
            <associations>
                <!-- Ссылка на файл -->
                <association name="lecm-rpeditor:reportTemplateFile">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>cm:content</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <association name="lecm-rpeditor:reportTemplateType">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-rpeditor:reportType</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>

        <!-- Описатель отчета -->
        <type name="lecm-rpeditor:reportDescriptor">
            <title>Report Descriptor</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-rpeditor:reportCode">
                    <title>Report Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref="lecm-rpeditor:unique-property-const"/>
                    </constraints>
                </property>
                <property name="lecm-rpeditor:reportDocType">
                    <title>Report DocType</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="lecm-rpeditor:reportObjectsMultiplicity">
                    <title>Report Multiplicity</title>
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
                <property name="lecm-rpeditor:reportQuery">
                    <title>Report Query</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="lecm-rpeditor:reportQueryOffset">
                    <title>Report Query Offset</title>
                    <type>d:int</type>
                    <default>0</default>
                </property>
                <property name="lecm-rpeditor:reportQueryLimit">
                    <title>Report Query Limit</title>
                    <type>d:int</type>
                    <default>-1</default>
                </property>
                <property name="lecm-rpeditor:reportQueryPgSize">
                    <title>Report Query Page Size</title>
                    <type>d:int</type>
                    <default>-1</default>
                </property>
                <property name="lecm-rpeditor:reportQuerySort">
                    <title>Report Query Sorting</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="lecm-rpeditor:reportIsDeployed">
                    <title>Report Is Deployed</title>
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
            </properties>
            <associations>
                <association name="lecm-rpeditor:reportProviderAssoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-rpeditor:reportProvider</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <association name="lecm-rpeditor:reportTemplateAssoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-rpeditor:reportTemplate</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
                <!-- Бизнес роли -->
                <association name="lecm-rpeditor:businessRolesAssoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:business-role</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>
            <mandatory-aspects>
                <aspect>lecm-rpeditor:reportExtFlagsAspect</aspect>
            </mandatory-aspects>
        </type>

        <type name="lecm-rpeditor:subReportDescriptor">
            <title>Sub Report Descriptor</title>
            <parent>lecm-rpeditor:reportDescriptor</parent>
            <associations>
                <association name="lecm-rpeditor:parentReportTemplateAssoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-rpeditor:reportTemplate</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>

        <!-- Набор данных -->
        <type name="lecm-rpeditor:reportDataSource">
            <title>Data Source</title>
            <parent>cm:folder</parent>
            <properties>
                <property name="lecm-rpeditor:dataSourceCode">
                    <title>Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                </property>
            </properties>
        </type>

        <!-- Колонка данных -->
        <type name="lecm-rpeditor:reportDataColumn">
            <title>Data Column</title>
            <parent>cm:cmobject</parent>
            <properties>
                <property name="lecm-rpeditor:dataColumnCode">
                    <title>Data Column Code</title>
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <property name="lecm-rpeditor:dataColumnExpression">
                    <title>Data Column Expression</title>
                    <type>d:text</type>
                </property>
                <property name="lecm-rpeditor:dataColumnClass">
                    <title>Data Column Alfresco Class</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="lecm-rpeditor:dataColumnOrder">
                    <title>Data Column Order</title>
                    <type>d:int</type>
                    <default>0</default>
                </property>
            </properties>
            <associations>
                <association name="lecm-rpeditor:columnTypeAssoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-rpeditor:reportColumnType</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <association name="lecm-rpeditor:columnParameterTypeAssoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-rpeditor:reportParameterType</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>
    </types>

    <aspects>
        <aspect name="lecm-rpeditor:reportExtFlagsAspect">
            <properties>
                <property name="lecm-rpeditor:reportExtFlags">
                    <title>Report Ext Flags</title>
                    <type>d:text</type>
                </property>
            </properties>
        </aspect>
    </aspects>
</model>