<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<bean id="routes.model.bootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap,
					  ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap,
					  ru.it.lecm.contractors.lecm-contractors-repo.contractors-model-bootstrap,
					  lecm.approval3.helper.model.bootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-routes-macros-model.xml</value>
				<value>alfresco/module/${artifactId}/models/lecm-routes-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/lecm-routes</value>
				<value>alfresco/module/${artifactId}/messages/lecm-routes-macros</value>
			</list>
		</property>
	</bean>

	<bean id="routes.dictionaries.bootstrap"
		  parent="lecmDictionaryBootstrap"
		  depends-on="routes.model.bootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/dictionaries/routes-br-items.xml</value>
			</list>
		</property>
	</bean>

	<util:constant id="routesServiceFolderID" static-field="ru.it.lecm.workflow.routes.beans.RoutesServiceImpl.ROUTES_FOLDER_ID"/>
	<bean id="routesService" class="ru.it.lecm.workflow.routes.beans.RoutesServiceImpl"
		  parent="baseBean" depends-on="routes.model.bootstrap"
		  init-method="init">
		<property name="approvalService" ref="approvalWorkflowService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="searchService" ref="searchService"/>
		<property name="copyService" ref="copyService"/>
		<property name="documentService" ref="documentService"/>
		<property name="scriptService" ref="scriptService"/>
		<property name="folders">
			<map>
				<entry key="#{routesServiceFolderID}" value="Сервис маршрутов"/>
			</map>
		</property>
	</bean>

	<bean id="routes.delete.temp.schedule"
	  class="ru.it.lecm.workflow.routes.schedule.DeleteTempRoutesSchedule" parent="baseTransactionalSchedule"
	  depends-on="routes.model.bootstrap"
	  p:jobName="routes-delete-temp"
	  p:jobGroup="routes"
	  p:triggerName="routes-delete-temp-trigger"
	  p:triggerGroup="routes-trigger"
	  p:actionName="deleteAction"
	  p:cronExpression="0 0 4 * * ? *"
	/>

	<bean id="routesOnCreateAssocPolicy" class="ru.it.lecm.workflow.routes.policy.RoutesOnCreateAssocPolicy"
		  init-method="init" parent="logicEcmAssociationPolicy"/>

	<util:list id="routes.permissions">
		<value>alfresco/module/${artifactId}/permissions/routes-permissions.xml</value>
	</util:list>

	<bean parent="ServiceFolderPermissionHelper" depends-on="ru.it.lecm.orgstructure.orgstructure-repo.orgBootstrap"
		  p:serviceBean-ref="routesService"
		  p:permissionsList-ref="routes.permissions"/>
</beans>
