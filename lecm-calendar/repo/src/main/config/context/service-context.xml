<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<bean id="${groupId}.${artifactId}.wCalendarBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap, ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap, ru.it.lecm.dictionary.dictionary-repo.dictionary">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/calendar-model.xml</value>
				<value>alfresco/module/${artifactId}/models/absence-model.xml</value>
				<value>alfresco/module/${artifactId}/models/shedule-model.xml</value>
				<value>alfresco/module/${artifactId}/models/wcal-common.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/calendar</value>
			</list>
		</property>
	</bean>
	<bean id="${groupId}.${artifactId}.absenceReasonDicBootstrap"
		  parent="lecmDictionaryBootstrap" depends-on="${groupId}.${artifactId}.wCalendarBootstrap,businessJournalLogEventsPolicy" >
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/absence-reason-dictionary.xml</value>
			</list>
		</property>
		<property name="createOrUpdateDictionaries">
			<list>
				<value>alfresco/module/${artifactId}/models/absence-reason-dictionary-items.xml</value>
			</list>
		</property>
	</bean>
	<!-- Бины для сервисов календарей, графиков работы и отсутствий -->
	<bean id="WCalendarService" class="ru.it.lecm.wcalendar.calendar.beans.CalendarBean" init-method="bootstrap" depends-on="${groupId}.${artifactId}.wCalendarBootstrap">
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="transactionService" ref="transactionService"/>
		<!--На сколько лет вперед сгенерировать календари-->
		<property name="yearsAmountToCreate" value="3"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="authService" ref="authenticationService"/>
	</bean>
	<bean id="SheduleService" class="ru.it.lecm.wcalendar.shedule.beans.SheduleBean" init-method="bootstrap" depends-on="${groupId}.${artifactId}.wCalendarBootstrap">
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="authService" ref="authenticationService"/>
	</bean>
	<bean id="AbsenceService" class="ru.it.lecm.wcalendar.absence.beans.AbsenceBean" init-method="bootstrap" depends-on="${groupId}.${artifactId}.wCalendarBootstrap">
		<property name="repositoryHelper" ref="repositoryHelper"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="delegationService" ref="delegationService"/>
		<property name="businessJournalService" ref="businessJournalService"/>
		<property name="authService" ref="authenticationService"/>
	</bean>
	<!-- JavaScript root-object для  календарей, отсутствий и графиков работы  -->
	<bean id="WCalendarJavascriptExtension" class="ru.it.lecm.wcalendar.extensions.WCalendarJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="calendar"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="wCalService" ref="WCalendarService"/>
	</bean>
	<bean id="AbsenceJavascriptExtension" class="ru.it.lecm.wcalendar.absence.extensions.AbsenceJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="absence"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="absenceService" ref="AbsenceService"/>
		<property name="wCalService" ref="AbsenceService"/>
	</bean>
	<bean id="SheduleJavascriptExtension" class="ru.it.lecm.wcalendar.shedule.extensions.SheduleJavascriptExtension" parent="baseJavaScriptExtension">
		<property name="extensionName" value="shedule"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="sheduleService" ref="SheduleService"/>
		<property name="wCalService" ref="SheduleService"/>
	</bean>
	<!-- Web-скрипты на Java -->
	<bean id="webscript.ru.it.lecm.wcalendar.absence.AbsenceCancelShowDialogWebScript.get" class="ru.it.lecm.wcalendar.absence.extensions.AbsenceCancelShowDialogWebScript" parent="webscript">
		<property name="absenceService" ref="AbsenceService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
	</bean>
	<!-- Бины шедулера для отсутствий (начало отсутствия) -->
	<bean id="absenceStartScheduleExecutor" class="ru.it.lecm.wcalendar.absence.shedule.AbsenceStartScheduleExecutor" parent="action-executer">
		<property name="ignoreLock">
			<value>false</value>
		</property>
		<property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
	</bean>
	<bean id="absenceStartShedule" class="ru.it.lecm.wcalendar.absence.shedule.AbsenceStartShedule">
		<property name="transactionMode">
			<value>ISOLATED_TRANSACTIONS</value>
		</property>
		<property name="compensatingActionMode">
			<value>IGNORE</value>
		</property>
		<property name="jobName">
			<value>absence-start</value>
		</property>
		<property name="jobGroup">
			<value>absence</value>
		</property>
		<property name="triggerName">
			<value>absence-start-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>absence-trigger</value>
		</property>
		<property name="cronExpression">
			<value>0 30 * * * ? *</value> <!-- каждый час в xx:30 -->
		</property>
		<property name="scheduler" ref="schedulerFactory"/>
		<property name="actionService" ref="ActionService"/>
		<property name="absenceService" ref="AbsenceService"/>
		<property name="transactionService" ref="TransactionService"/>
		<property name="searchService" ref="searchService"/>
		<property name="runAsUser">
			<value>System</value>
		</property>
	</bean>
	<!-- Бины шедулера для отсутствий (окончание отсутствия) -->
	<bean id="absenceEndScheduleExecutor" class="ru.it.lecm.wcalendar.absence.shedule.AbsenceEndScheduleExecutor" parent="action-executer">
		<property name="ignoreLock">
			<value>false</value>
		</property>
		<property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
	</bean>
	<bean id="absenceEndShedule" class="ru.it.lecm.wcalendar.absence.shedule.AbsenceEndShedule">
		<property name="transactionMode">
			<value>ISOLATED_TRANSACTIONS</value>
		</property>
		<property name="compensatingActionMode">
			<value>IGNORE</value>
		</property>
		<property name="jobName">
			<value>absence-end</value>
		</property>
		<property name="jobGroup">
			<value>absence</value>
		</property>
		<property name="triggerName">
			<value>absence-end-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>absence-trigger</value>
		</property>
		<property name="cronExpression">
			<value>0 30 * * * ? *</value> <!-- каждый час в xx:30 -->
		</property>
		<property name="scheduler" ref="schedulerFactory"/>
		<property name="actionService" ref="ActionService"/>
		<property name="absenceService" ref="AbsenceService"/>
		<property name="transactionService" ref="TransactionService"/>
		<property name="searchService" ref="searchService"/>
		<property name="runAsUser">
			<value>System</value>
		</property>
	</bean>
	<!-- Бины шедулера для отсутствий (продление бессрочных отсутствий) -->
	<bean id="absenceProlongationScheduleExecutor" class="ru.it.lecm.wcalendar.absence.shedule.AbsenceProlongationScheduleExecutor" parent="action-executer">
		<property name="ignoreLock">
			<value>false</value>
		</property>
		<property name="absenceService">
			<ref bean="AbsenceService"/>
		</property>
	</bean>
	<bean id="absenceProlongationShedule" class="ru.it.lecm.wcalendar.absence.shedule.AbsenceProlongationShedule">
		<property name="transactionMode">
			<value>ISOLATED_TRANSACTIONS</value>
		</property>
		<property name="compensatingActionMode">
			<value>IGNORE</value>
		</property>
		<property name="jobName">
			<value>absence-prolongation</value>
		</property>
		<property name="jobGroup">
			<value>absence</value>
		</property>
		<property name="triggerName">
			<value>absence-prolongation-trigger</value>
		</property>
		<property name="triggerGroup">
			<value>absence-trigger</value>
		</property>
		<property name="cronExpression">
			<value>0 30 * * * ? *</value> <!-- каждый час в xx:30 -->
		</property>
		<property name="scheduler" ref="schedulerFactory"/>
		<property name="actionService" ref="ActionService"/>
		<property name="absenceService" ref="AbsenceService"/>
		<property name="transactionService" ref="TransactionService"/>
		<property name="searchService" ref="searchService"/>
		<property name="runAsUser">
			<value>System</value>
		</property>
	</bean>
	<!-- Полиси для сервиса календарей -->
	<bean id="calendarModifyPolicy" class="ru.it.lecm.wcalendar.calendar.policy.CalendarModifyPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="wCalendarService" ref="WCalendarService"/>
	</bean>
	<!-- Полиси для сервиса отсутствий -->
	<bean id="absenceStartPolicy" class="ru.it.lecm.wcalendar.absence.policy.AbsenceStartPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<bean id="absenceEndPolicy" class="ru.it.lecm.wcalendar.absence.policy.AbsenceEndPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="absenceService" ref="AbsenceService"/>
	</bean>
	<!-- Полиси для сервиса графиков -->
	<bean id="sheduleDeletePolicy" class="ru.it.lecm.wcalendar.shedule.policy.SheduleDeletePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="sheduleService" ref="SheduleService"/>
	</bean>
	<bean id="SheduleCreatePolicy" class="ru.it.lecm.wcalendar.shedule.policy.SheduleCreatePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="sheduleService" ref="SheduleService"/>
	</bean>
</beans>
