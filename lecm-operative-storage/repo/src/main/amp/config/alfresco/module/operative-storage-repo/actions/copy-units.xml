<?xml version='1.0' encoding='UTF-8' ?>
<items>
    <item name="cm:Копирование раздела номенклатуры дел" type="lecm-group-actions:script-action">
        <property name="cm:name">
            <![CDATA[Копирование раздела номенклатуры дел]]>
        </property>
        <property name="cm:title">
            <![CDATA[Копирование раздела номенклатуры дел]]>
        </property>
        <property name="lecm-group-actions:statuses">
            <![CDATA[]]>
        </property>
        <property name="lecm-group-actions:type">
            <![CDATA[lecm-os:nomenclature-unit-section]]>
        </property>
        <property name="lecm-group-actions:order">
            <![CDATA[0]]>
        </property>
        <property name="lecm-group-actions:expression">
            <![CDATA[doc.attr("lecm-os:nomenclature-unit-section-status") == "PROJECT" OR doc.attr("lecm-os:nomenclature-unit-section-status") == "APPROVED" OR doc.attr("lecm-os:nomenclature-unit-section-status") == "CLOSED"]]>
        </property>
        <property name="lecm-group-actions:isGroup">
            <![CDATA[true]]>
        </property>
        <property name="lecm-group-actions:forCollection">
            <![CDATA[false]]>
        </property>
        <property name="lecm-group-actions:script">
            <![CDATA[(function() {
	function copyAllExceptDocs(src, dest) {
		var copy = src.copy(dest, false);
		var childs = src.childAssocs["contains"];
		if (childs == null) return copy;
		for (var i = 0; i < childs.length; i++) {
			var child = childs[i];
			var yearSection;
			if (child.isSubType("lecm-document:base")) continue;
			if ("lecm-os:nomenclature-case" == child.typeShort) {
				var yearSection = child.assocs["lecm-os:nomenclature-case-year-assoc"][0];
				child.removeAssociation(yearSection, "lecm-os:nomenclature-case-year-assoc");
				var childCopy = copyAllExceptDocs(child, copy);
				child.createAssociation(yearSection, "lecm-os:nomenclature-case-year-assoc");
			} else {
				var childCopy = copyAllExceptDocs(child, copy);
			}
		}
		return copy;
	}


	var copy = copyAllExceptDocs(document, folder);
	var logText = "Скопирован раздел номенклатуры";
	var logObjects = ["" + copy.nodeRef.toString()];
	businessJournal.log(document.nodeRef.toString(), "FMS_COPY", logText, logObjects);
})();
]]>
        </property>
        <items>
            <item name="cm:folder" type="lecm-group-actions:form-field">
                <property name="cm:name">
                    <![CDATA[Раздел]]>
                </property>
                <property name="lecm-group-actions:field-default-value">
                    <![CDATA[]]>
                </property>
                <property name="lecm-group-actions:field-id">
                    <![CDATA[folder]]>
                </property>
                <property name="lecm-group-actions:field-type">
                    <![CDATA[lecm-os:base]]>
                </property>
                <property name="lecm-group-actions:field-priority">
                    <![CDATA[0]]>
                </property>
            </item>
        </items>
    </item>
</items>

