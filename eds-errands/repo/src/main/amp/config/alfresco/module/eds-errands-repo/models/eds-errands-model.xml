<?xml version="1.0" encoding="UTF-8"?>
<model name="eds-errands:model" xmlns="http://www.alfresco.org/model/dictionary/1.0">
    <description>Поручения</description>
    <author>EDS</author>
    <version>1.0</version>
    <imports>
        <import uri="http://www.it.ru/logicECM/document/1.0" prefix="lecm-document"/>
        <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
        <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
        <import uri="http://www.it.ru/lecm/org/structure/1.0" prefix="lecm-orgstr"/>
        <import uri="http://www.it.ru/lecm/document/aspects/1.0" prefix="lecm-document-aspects"/>
        <import uri="http://www.it.ru/logicECM/eds-document-aspects/1.0" prefix="eds-document-aspect"/>
        <import uri="http://www.it.ru/logicECM/links/1.0" prefix="lecm-links"/>
        <import uri="http://www.it.ru/logicECM/document/dictionaries/1.0" prefix="lecm-doc-dic"/>
        <import uri="http://www.it.ru/logicECM/eds-errands/table-structure/1.0" prefix="eds-errands-ts"/>
        <import uri="http://www.it.ru/logicECM/eds-errands/dictionaries/1.0" prefix="eds-errands-dic"/>


    </imports>
    <namespaces>
        <namespace uri="http://www.it.ru/logicECM/eds-errands/1.0" prefix="eds-errands"/>
    </namespaces>
    <constraints>
        <constraint name="eds-errands:present-string-constraint" type="ru.it.lecm.documents.constraints.PresentStringConstraint">
            <parameter name="presentString">
                <value><![CDATA[№ {eds-errands:number}, {eds-errands:title}, исполнитель {eds-errands:executor-assoc/lecm-orgstr:employee-short-name}, срок {eds-errands:limitation-date?dd.MM.yyyy}]]></value>
            </parameter>
        </constraint>
        <constraint name="eds-errands:attachment-categories" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>Поручение|ERRAND</value>
                    <value>Контроль|CONTROL</value>
                    <value>Исполнение|EXECUTION</value>
                    <value>Отчеты соисполнителей|EXECUTION_REPORTS</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="eds-errands:settings-mode-choosing-executors-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>ORGANIZATION</value>
                    <value>UNIT</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="eds-errands:author-property-constraint" type="ru.it.lecm.documents.constraints.AuthorPropertyConstraint">
            <parameter name="authorProperty">
                <value>eds-errands:initiator-assoc-ref</value>
            </parameter>
        </constraint>
        <constraint name="eds-errands:reg-number-properties-constraint" type="ru.it.lecm.documents.constraints.RegNumberPropertiesConstraint">
            <parameter name="regNumbersProperties">
                <value>eds-errands:number</value>
            </parameter>
        </constraint>
        <constraint name="eds-errands:arm-url-constraint" type="ru.it.lecm.documents.constraints.ArmUrlConstraint">
            <parameter name="armUrl">
                <value>arm?code=SED</value>
            </parameter>
        </constraint>
        <constraint name="eds-errands:recipient-type-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>CONTROLLER</value>
                    <value>AUTHOR</value>
                    <value>AUTHOR_AND_CONTROLLER</value>
                </list>
            </parameter>
        </constraint>

        <constraint name="eds-errands:period-repeat-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>DAILY</value>
                    <value>WEEKLY</value>
                    <value>MONTHLY</value>
                    <value>QUARTERLY</value>
                    <value>ANNUALLY</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="eds-errands:periodically-radio-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>DATERANGE</value>
                    <value>DURING</value>
                    <value>REPEAT_COUNT</value>
                    <value>ENDLESS</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="eds-errands:period-during-const" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>DAYS</value>
                    <value>WEEKS</value>
                    <value>MONTHS</value>
                    <value>YEARS</value>
                </list>
            </parameter>
        </constraint>
    </constraints>
    <types>
        <type name="eds-errands:document">
            <title>EDS Errands Document</title>
            <parent>lecm-document:base</parent>
            <properties>
                <!-- Тип поручения -->
                <property name="eds-errands:type-assoc-ref">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>false</tokenised>
                    </index>
                </property>
                <!-- Заголовок -->
                <property name="eds-errands:title">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <!-- Текст Поручения -->
                <property name="eds-errands:content">
                    <type>d:text</type>
                </property>
                <!-- Точно в срок-->
                <property name="eds-errands:just-in-time">
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
                <!-- Важность-->
                <property name="eds-errands:is-important">
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
                <!-- Требуется отчет -->
                <property name="eds-errands:report-required">
                    <type>d:boolean</type>
                    <default>false</default>
                </property>
                <!-- Получатель отчета-->
                <property name="eds-errands:recipient-type">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <constraints>
                        <constraint ref="eds-errands:recipient-type-const"/>
                    </constraints>
                </property>

                <!-- Направлять периодически -->
                <property name="eds-errands:periodically">
                    <type>d:boolean</type>
                    <default>false</default>
                </property>

                <!--Периодичность-->
                <property name="eds-errands:periodically-radio">
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                    <constraints>
                        <constraint ref="eds-errands:periodically-radio-const"/>
                    </constraints>
                </property>
                <!--Повторять-->
                <property name="eds-errands:repeat">
                    <type>d:text</type>
                    <constraints>
                        <constraint ref="eds-errands:period-repeat-const" />
                    </constraints>
                </property>
                <!--Дата начала периода-->
                <property name="eds-errands:period-start">
                    <type>d:date</type>
                </property>
                <!--Дата окончания периода-->
                <property name="eds-errands:period-end">
                    <type>d:date</type>
                </property>
                <!-- В течение -->
                <property name="eds-errands:period-during">
                    <type>d:text</type>
                    <constraints>
                        <constraint ref="eds-errands:period-during-const"/>
                    </constraints>
                </property>
                <!--число повторений-->
                <property name="eds-errands:repeat-count">
                    <type>d:int</type>
                    <default>1</default>
                </property>
                <!--нет конечной даты-->
                <property name="eds-errands:endless">
                    <type>d:boolean</type>
                </property>

                <!-- Атрибуты исполнения поручения-->
                <!-- Отчет об исполнении -->
                <property name="eds-errands:execution-report">
                    <type>d:text</type>
                </property>
                <!-- Дата исполнения -->
                <property name="eds-errands:execution-date">
                    <type>d:date</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <!-- Просрочено-->
                <property name="eds-errands:is-expired">
                    <type>d:boolean</type>
                    <default>false</default>
                </property>

                <!-- Служебные-->
                <!-- Короткое -->
                <property name="eds-errands:is-short">
                    <type>d:boolean</type>
                    <mandatory>true</mandatory>
                    <default>true</default>
                </property>
                <!-- Признак того, что поручение было когда-либо отклонено -->
                <property name="eds-errands:was-rejected">
                    <type>d:boolean</type>
                    <mandatory>true</mandatory>
                    <default>false</default>
                </property>
                <!-- Фактическая дата начала работы с поручением -->
                <property name="eds-errands:work-start-date">
                    <type>d:date</type>
                </property>
                <!-- Дата перехода в статус "Ожидает исполнения"-->
                <property name="eds-errands:wait-for-execution-date">
                    <type>d:date</type>
                </property>
                <!-- Переход после исполнения -->
                <property name="eds-errands:execute-result">
                    <type>d:text</type>
                </property>
                <!-- Переход после утверждения контролёром -->
                <property name="eds-errands:controller-approve-result">
                    <type>d:text</type>
                </property>

                <!-- Поиск/сортировка ассоциаций-->
                <!-- Соисполнитель -->
                <property name="eds-errands:coexecutors-assoc-ref">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>false</tokenised>
                    </index>
                </property>
                <property name="eds-errands:coexecutors-assoc-text-content">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>

                <!--Автор-->
                <property name="eds-errands:author-assoc-ref">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>false</tokenised>
                    </index>
                </property>
                <property name="eds-errands:author-assoc-text-content">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>

                <!--Контроллер-->
                <property name="eds-errands:controller-assoc-ref">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>false</tokenised>
                    </index>
                </property>
                <property name="eds-errands:controller-assoc-text-content">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
                <!--  документ-основание -->
                <property name="eds-errands:additional-document-assoc-ref">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>false</tokenised>
                    </index>
                </property>
                <!-- Номер документа основания - поле для атрибутивного поиска-->
                <property name="eds-errands:base-doc-number">
                    <type>d:text</type>
                    <index enabled="true">
                        <atomic>true</atomic>
                        <stored>false</stored>
                        <tokenised>both</tokenised>
                    </index>
                </property>
            </properties>
            <associations>
                <!-- Тип поручения -->
                <association name="eds-errands:type-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>eds-errands-dic:errand-type</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Автор -->
                <association name="eds-errands:initiator-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:employee</class>
                        <mandatory>true</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Соисполнители -->
                <association name="eds-errands:coexecutors-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:employee</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
                <!-- Контролер -->
                <association name="eds-errands:controller-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:employee</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Ссылка на основной документ, если есть -->
                <association name="eds-errands:additional-document-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-document:base</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Ссылки -->
                <association name="eds-errands:links-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-links:link</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
                <!-- Атрибуты исполнения поручения - Ссылки -->
                <association name="eds-errands:execution-links-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-links:link</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>
            <mandatory-aspects>
                <aspect>eds-errands-ts:coexecutor-reports-aspect</aspect>
                <aspect>eds-document-aspect:executionAspect</aspect>
            </mandatory-aspects>
        </type>

        <type name="eds-errands:settings">
            <title>EDS Errands Global Settings</title>
            <parent>cm:cmobject</parent>
            <properties>
                <!-- Режим выбора исполнителей  -->
                <property name="eds-errands:settings-mode-choosing-executors">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <default>UNIT</default>
                    <constraints>
                        <constraint ref="eds-errands:settings-mode-choosing-executors-const"/>
                    </constraints>
                </property>
                <!-- Передавать права на документ-основание  -->
                <property name="eds-errands:settings-transfer-rights">
                    <type>d:boolean</type>
                    <mandatory>true</mandatory>
                    <default>false</default>
                </property>
                <!-- Скрывать расширенные атрибуты поручения -->
                <property name="eds-errands:settings-hide-additional-attrs">
                    <type>d:boolean</type>
                    <default>true</default>
                </property>
            </properties>
        </type>

        <type name="eds-errands:user-settings">
            <title>EDS Errands User Settings</title>
            <parent>cm:cmobject</parent>
            <properties>
                <!-- Режим выбора исполнителей  -->
                <property name="eds-errands:user-settings-without-initiator-approval">
                    <type>d:boolean</type>
                    <mandatory>true</mandatory>
                    <default>false</default>
                </property>
            </properties>
            <associations>
                <!-- Инициатор по умолчанию -->
                <association name="eds-errands:user-settings-default-initiator-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-orgstr:employee</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
                <!-- Тематика по умолчанию -->
                <association name="eds-errands:user-settings-default-subject-assoc">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>lecm-doc-dic:subjects</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </type>
        <type name="eds-errands:dashlet-settings">
            <title>EDS Errands Dashlet Settings</title>
            <parent>cm:cmobject</parent>
            <properties>
                <!-- Код арм  -->
                <property name="eds-errands:dashlet-settings-arm">
                    <type>d:text</type>
                    <mandatory>true</mandatory>
                    <default>SED</default>
                </property>

                <!-- Путь до узла с поручениями -->
                <property name="eds-errands:dashlet-settings-path">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с неисполненными поручениями -->
                <property name="eds-errands:dashlet-settings-unexecuted">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с выжными неисполненными поручениями -->
                <property name="eds-errands:dashlet-settings-unexecuted-important">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с ожидающими исполнения поручениями -->
                <property name="eds-errands:dashlet-settings-await-execution">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с важными ожидающими исполнения поручениями -->
                <property name="eds-errands:dashlet-settings-await-execution-important">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с просроченными поручениями -->
                <property name="eds-errands:dashlet-settings-expired">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с важными просроченными поручениями -->
                <property name="eds-errands:dashlet-settings-expired-important">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с поручениями с прибилжающимся сроком -->
                <property name="eds-errands:dashlet-settings-approaching-deadline">
                    <type>d:text</type>
                    <default></default>
                </property>

                <!-- Путь до узла с важными поручениями с прибилжающимся сроком -->
                <property name="eds-errands:dashlet-settings-approaching-deadline-important">
                    <type>d:text</type>
                    <default></default>
                </property>

            </properties>
        </type>

    </types>


</model>