<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:http="http://cxf.apache.org/transports/http/configuration"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd



						   http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd
						   http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd">

	<http:conduit name="{http://it.ru/}ItsWebService.http-conduit">
		<http:client AutoRedirect="true" Connection="Keep-Alive"/>
	</http:conduit>

	<jaxws:client id="itsWebService.http"
				  address="http://127.0.0.1:4466/"
				  serviceClass="ru.it.soap.ItsWebServiceSoap"
				  serviceName="s:ItsWebService"
				  endpointName="s:ItsWebServiceSoap"
				  xmlns:s="http://it.ru/">
	</jaxws:client>

	<bean id="br5.semantic.modelBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap">
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-br5-semantic-aspects-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
			</list>
		</property>
	</bean>

	<bean id="br5.integration.DocumentBr5AspectPolicy" class="ru.it.lecm.br5.semantic.policies.DocumentBr5AspectPolicy" init-method="init" depends-on="br5.semantic.modelBootstrap">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="documentService" ref="documentService"/>
		<property name="documentAttachmentsService" ref="documentAttachmentsService"/>
	</bean>

	<bean id="br5.semantic.SemanticBeanImpl" parent="baseBean" class="ru.it.lecm.br5.semantic.beans.SemanticBeanImpl">
		<property name="nodeService" ref="nodeService"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
		<property name="itsWebService" ref="itsWebService.http"/>
		<property name="serviceRegistry" ref="ServiceRegistry"/>
		<property name="documentMembersService" ref="documentMembersService"/>
        <property name="documentAttachmentsService" ref="documentAttachmentsService"/>
		<property name="searchService" ref="searchService"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>

	<bean id="br5.semantic.SemanticWebScriptBean" parent="baseScript" class="ru.it.lecm.br5.semantic.webscripts.SemanticWebScriptBean">
		<property name="extensionName">
			<value>integration</value>
		</property>
		<property name="nodeService" ref="nodeService"/>
		<property name="semanticService" ref="br5.semantic.SemanticBeanImpl"/>
		<property name="orgstructureService" ref="serviceOrgstructure"/>
	</bean>

	<bean id="br5.semantic.templateActionModelFactory" class="org.alfresco.repo.action.scheduled.FreeMarkerWithLuceneExtensionsModelFactory">
        <property name="serviceRegistry">
            <ref bean="ServiceRegistry"/>
        </property>
    </bean>

<!--	<bean id="br5.semantic.refreshBR5IndexScheduler" class="org.alfresco.repo.action.scheduled.CronScheduledQueryBasedTemplateActionDefinition">
		<property name="transactionMode">
			<value>UNTIL_FIRST_FAILURE</value>
		</property>
		<property name="compensatingActionMode">
			<value>IGNORE</value>
		</property>
		<property name="searchService">
			<ref bean="SearchService"/>
		</property>
		<property name="templateService">
			<ref bean="TemplateService"/>
		</property>
		<property name="queryLanguage">
			<value>lucene</value>
		</property>
		<property name="stores">
			<list>
				<value>workspace://SpacesStore</value>
			</list>
		</property>
-->
		<!-- Find all nodes that do not have the aspect -->
<!--		<property name="queryTemplate">
			<value>ASPECT:"{http://www.it.ru/lecm/br5/semantic/aspects/1.0}br5"</value>
		</property> 
-->
		<!--		do every minute in debug-->
<!--		<property name="cronExpression">
			<value>0 0 2 * * ?</value>
		</property>
		<property name="jobName">
			<value>updateIndex</value>
		</property>
		<property name="jobGroup">
			<value>br5Group</value>
		</property>
		<property name="triggerName">
			<value>onceAMinuteTrigger</value>
		</property>
		<property name="triggerGroup">
			<value>triggerGroup</value>
		</property>
-->		
		<!-- Inject the scheduler - the trigger will be registered with this scheduler -->
<!--		<property name="scheduler">
			<ref bean="schedulerFactory"/>
		</property>
		<property name="actionService">
			<ref bean="ActionService"/>
		</property>
		<property name="templateActionModelFactory">
			<ref bean="br5.semantic.templateActionModelFactory"/>
		</property>
		<property name="templateActionDefinition">
			<ref bean="br5.semantic.runUpdateIndexScriptAction"/>
		</property>
		<property name="transactionService">
			<ref bean="TransactionService"/>
		</property>
		<property name="runAsUser">
			<value>System</value>
		</property>
	</bean>
-->
	
	<bean id="br5.semantic.runUpdateIndexScriptAction" class="org.alfresco.repo.action.scheduled.SimpleTemplateActionDefinition">
		<property name="actionName">
			<value>br5.semantic.updateIndex</value>
		</property>
		<property name="parameterTemplates">
			<map>
<!--				<entry>
					<key>
						<value>script-ref</value>
					</key>
					 Note that as of Alfresco 4.0, due to a  Spring upgrade, the FreeMarker ${foo} entries must be escaped
					<value>\$\{selectSingleNode('workspace://SpacesStore', 'lucene', 'PATH:"/app:company_home/cm:Record_x0020_Management/cm:testscript.js"' )\}</value>
				</entry>-->
			</map>
		</property>
		<property name="templateActionModelFactory">
			<ref bean="br5.semantic.templateActionModelFactory"/>
		</property>
		<property name="dictionaryService">
			<ref bean="DictionaryService"/>
		</property>
		<property name="actionService">
			<ref bean="ActionService"/>
		</property>
		<property name="templateService">
			<ref bean="TemplateService"/>
		</property>
	</bean>

	<bean id="br5.semantic.updateIndex" class="ru.it.lecm.br5.semantic.actions.UpdateIndexAction" parent="action-executer">
        <property name="semanticService">
            <ref bean="br5.semantic.SemanticBeanImpl" />
        </property><!--
        <property name="transactionService">
            <ref bean="TransactionService" />
        </property>
        <property name="ignoreLock">
            <value>false</value>
        </property>-->
        <property name="publicAction" value="false" />
    </bean>


</beans>
