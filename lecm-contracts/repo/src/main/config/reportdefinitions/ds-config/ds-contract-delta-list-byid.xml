<?xml version="1.0" encoding="UTF-8"?>
<!--
	Опись изменений договора.

	model of the contract/document:
		.\lecm-contracts\repo\src\main\config\models\lecm-contracts-model.xml

Входные данные:
•	ID документа-договора

Выходные данные отчета:
•	несколько полей документа:
		<Вид договора>
		№<Рег.номер>
		<Дата регистрации>
		<Контрагент (краткое наименование)>
•	табличка с вложениями:
	<Тип документа> (изменения к договору, спецификация, протокол согласования разногласий)
	<Номер>
	<Дата документа>
	<Статус>

( ($F{col_Item.Regnum} != null && !"Не присвоено".equals($F{col_Item.Regnum}) )? $F{col_Item.Regnum} : "нет")

	-->

<ds.config>

	<query.descriptor>
		<offset>0</offset>
		<limit>-1</limit>
		<pgsize>-1</pgsize>
		<allVersions>true</allVersions>
		<!--
			select * from lecm:documents
		  -->
		<queryText>
			<![CDATA[
				select * from lecm-contract:document as Contract
			]]>
		</queryText>
	</query.descriptor>

	<cmis.connection>
		<url>http://localhost:8080/alfresco/service/cmis</url>
		<username>admin</username>
		<password>111</password>
	</cmis.connection>

	<fields>
		<!-- Данные по "Виду договора" (с типом "lecm-contract-dic:contract-type") -->
		<field jrFldName="col_DocKind" queryFldName="{lecm-contract:typeContract-assoc/cm:name}"
			displayName="Вид договора"
			inMainDoc="true"/>

		<!-- Регистрационный номер договора -->
		<field queryFldName="lecm-contract:regNumSystem"
				jrFldName="col_Regnum"
				displayName="Регистрационный номер договора"
				inMainDoc="true"
				javaValueClass="String"/>

		<!-- Регистрационный номер контрагента -->
		<field queryFldName="lecm-contract:regNumContractor"
				jrFldName="col_RegnumContractor"
				displayName="Регистрационный номер контрагента"
				inMainDoc="true"
				javaValueClass="String"/>

		<!-- Дата регистрации договора -->
		<field queryFldName="lecm-contract:dateRegContracts"
				jrFldName="col_DateRegister"
				displayName="Дата регистрации договора"
				inMainDoc="true"
				javaValueClass="date"/>

		<!-- Полное наименование котрагента "lecm-contract:partner-assoc": target "lecm-contractor:contractor-type"
			и пр атрибуты котрагента
		  -->
		<field jrFldName="col_Contragent.name"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:shortname}"
				displayName="Контрагент.Короткое"
				inMainDoc="true"/>
		<field jrFldName="col_Contragent.fullname"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:fullname}"
				displayName="Контрагент.Полное наименование"
				inMainDoc="true"/>
		<field jrFldName="col_Contragent.phone" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:phone}"
				displayName="Контрагент.Тел"
				inMainDoc="true"/>

		<field jrFldName="col_Contragent.YurAddress" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:legal-address}"
				displayName="Контрагент.Юридический адрес"
				inMainDoc="true"/>
		<field jrFldName="col_Contragent.PhisAddress" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:physical-address}"
				displayName="Контрагент.Фактический адрес"
				inMainDoc="true"/>

		<!-- Дата заключения договора -->
		<field jrFldName="col_ConclusionDate" queryFldName="lecm-contract:dateConclusionContracts" displayName="Дата заключения"
				inMainDoc="true"
				javaValueClass="date"/>

		<!-- Статус -->
		<field jrFldName="col_Status" queryFldName="lecm-statemachine:status"
				displayName="Статус"
				inMainDoc="true"/>
		<!-- Дата изменения статуса -->
		<field jrFldName="col_StatusDate" queryFldName="lecm-document:status-changed-date" displayName="Дата смены статуса"
				inMainDoc="true"
				javaValueClass="java.util.Date"/>

		<!-- Данные по "Тематика договора" (ассоциация "lecm-contract:document" с типом target "lecm-contract-dic:contract-subjects") -->
		<field jrFldName="col_Theme.code" queryFldName="{lecm-contract:subjectContract-assoc/lecm-contract-dic:contract-subjects-code}" displayName="Тематика.Код" />
		<field jrFldName="col_Theme.tname" queryFldName="{lecm-contract:subjectContract-assoc/cm:name}" displayName="Тематика.Название" />
		<field jrFldName="col_Theme.desc" queryFldName="{lecm-contract:subjectContract-assoc/lecm-contract-dic:contract-subjects-description}" displayName="Тематика.Описание" />

		<!-- атрибуты для таблицы вложенных файлов надо обозначать 
			относительно связи с типом "lecm-connect:connection"
		  -->

		<!-- <Тип документа>
			(изменения к договору, спецификация, протокол согласования/разногласий)

			Dictionary name="Типы связи":
					<property name="lecm-dic:attributeForShow">cm:name</property>
					<property name="lecm-dic:type">lecm-connect-types:connection-type</property>
					prop: "lecm-connect-types:reverse-name" для названия типа связи

			Тип вложенного документа (самого):
				assoc-type: "lecm-connect:connected-document-assoc"
				target: "lecm-document:base" ->  "lecm-additional-document:additionalDocumen"
					prop: "lecm-additional-document:additionalDocumentType-text-content"
		  -->
		<field jrFldName="col_Item.Doctype"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-additional-document:additionalDocumentType-text-content}"
				displayName="Вложение.ТипДокумента" />

		<!-- Статус вложенного -->
		<field jrFldName="col_Item.Status"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-statemachine:status}"
				displayName="Вложение.Статус" />

		<!-- Дата изменения статуса вложенного -->
		<field jrFldName="col_Item.StatusDate"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-document:status-changed-date}"
				displayName="Вложение.Дата смены статус"
				javaValueClass="java.util.Date"/>

		<!-- Номер вложенного -->
		<field  jrFldName="col_Item.Regnum"
				queryFldName="{lecm-connect:connected-document-assoc/lecm-document:regnum}"
				displayName="Регистрационный номер вложенного документа"/>

		<!--
			<field queryFldName="fmydata" dislayName="" javaValueClass="my.check.type"/>
		  -->
	</fields>

</ds.config>
