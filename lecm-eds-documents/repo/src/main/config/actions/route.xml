<?xml version='1.0' encoding='UTF-8'?>
<items>
	<item name="cm:Отправить по маршруту" type="lecm-group-actions:action">
		<property name="cm:name"><![CDATA[Отправить по маршруту]]></property>
		<property name="lecm-group-actions:statuses"><![CDATA[Проект; На доработке]]></property>
		<property name="lecm-group-actions:type"><![CDATA[lecm-document-aspects:routes-avaliable]]></property>
		<property name="lecm-group-actions:order"><![CDATA[0]]></property>
		<property name="lecm-group-actions:expression"><![CDATA[]]></property>
		<property name="lecm-group-actions:isGroup"><![CDATA[false]]></property>
		<property name="lecm-group-actions:forCollection"><![CDATA[false]]></property>
		<property name="lecm-group-actions:script"><![CDATA[//запуск согласования по маршруту
(function() {
    var jsonUtils = new Packages.org.springframework.extensions.webscripts.json.JSONUtils(),
        documentType = "" + document.typeShort, //для того чтобы java.lang.String превратился в js native string
        variables = null,
        workflowVariables = {
            workflowRole: "DA_APPROVERS",
            workflowDynRole: "DA_APPROVER_DYN",
            workflowDefinition: "lecmApprovalWorkflow",
            commentFileAttachmentCategoryName: "Согласование",
            documentRef: document.nodeRef,
            routeRef: routeRef.nodeRef
        };
    switch(documentType) {
        case "lecm-internal:document":
            workflowVariables.documentAttachmentCategoryName = "Документ";
            break;
        case "lecm-outgoing:document":
            workflowVariables.documentAttachmentCategoryName = "Исходящее";
            break;
    }
    variables = jsonUtils.toJSONObject(workflowVariables);
    routeWorkflow.makeDocumentRoutable(document, routeRef);
    routeWorkflow.startWorkflow(variables);
})();

]]>
		</property>
		<items>
			<item name="cm:Маршрут" type="lecm-group-actions:form-field">
				<property name="cm:name"><![CDATA[Маршрут]]></property>
				<property name="lecm-group-actions:field-id"><![CDATA[routeRef]]></property>
				<property name="lecm-group-actions:field-type"><![CDATA[lecm-workflow:route]]></property>
				<property name="lecm-group-actions:field-priority"><![CDATA[0]]></property>
			</item>
		</items>
	</item>
</items>
