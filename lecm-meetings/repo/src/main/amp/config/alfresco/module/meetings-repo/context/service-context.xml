<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
	
	<util:list id="meetingsDictionariesModels">
		<value>alfresco/module/${artifactId}/models/lecm-meetings-dictionaries-model.xml</value>
	</util:list>
	<util:list id="meetingsDictionariesLabels">
		<value>alfresco/module/${artifactId}/messages/lecm-meetings-dictionaries-model</value>
	</util:list>
	
	<bean id="meetings.dictionaries.modelsBootstrap" parent="dictionaryModelBootstrap"
		  depends-on="dictionaryBootstrap
				,ru.it.lecm.dictionary.dictionary-repo.dictionary
				,ru.it.lecm.contractors.lecm-contractors-repo.contractors-dictionary-bootstrap
				,ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap
				,documents.dictionaries.LogicEcmModelsBootstrap"
		  p:models-ref="meetingsDictionariesModels"
		  p:labels-ref="meetingsDictionariesLabels"
	/>
  
	<util:list id="meetingsModels">
		<value>alfresco/module/${artifactId}/models/lecm-meetings-table-structure-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-meetings-model.xml</value>
	</util:list>
	<util:list id="meetingsLabels">
		<value>alfresco/module/${artifactId}/messages/lecm-meetings-table-structure-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-meetings-model</value>
	</util:list>
  
	<bean id="meetings.ModelsBootstrap" parent="modelsToRepositoryLoader"
		  depends-on="dictionaryBootstrap,
					meetings.dictionaries.modelsBootstrap,
					documents.LogicEcmModelsConnectionsBootstrap,
					documents.dictionaries.LogicEcmModelsBootstrap,
					lecm.approve3.model.bootstrap,
					events.LogicEcmInternalBootstrap
				 "
		  p:models-ref="meetingsModels"		 
		  p:labels-ref="meetingsLabels"		 
	/>
		
	
	<util:list id="meetingsDictionaries">
		<value>alfresco/module/${artifactId}/dictionaries/lecm-meetings-br-items.xml</value>
		<value>alfresco/module/${artifactId}/dictionaries/lecm-meetings-agenda-point-states.xml</value>
	</util:list>
	
	
	<util:list id="protocolModels">
		<value>alfresco/module/${artifactId}/models/lecm-protocol-table-structure-model.xml</value>
		<value>alfresco/module/${artifactId}/models/lecm-protocol-model.xml</value>
	</util:list>
	<util:list id="protocolLabels">
		<value>alfresco/module/${artifactId}/messages/lecm-protocol-table-structure-model</value>
		<value>alfresco/module/${artifactId}/messages/lecm-protocol-model</value>
	</util:list>
	
	<bean id="protocol.ModelsBootstrap" parent="modelsToRepositoryLoader"
		  depends-on="documents.LogicEcmModelsBootstrap,
		      dictionaryBootstrap,
			  ru.it.lecm.dictionary.dictionary-repo.dictionary,
		      ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap,
  			  eds.models.bootstrap,
			  errands.LogicEcmModelsBootstrap"
		  p:models-ref="protocolModels"		 
		  p:labels-ref="protocolLabels"		 
	/>
	
	<bean id="meetings.LogicEcmConnectionTypesBootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="meetings.dictionaries.modelsBootstrap"
		  p:dictionaries-ref="meetingsDictionaries"
	/>
	
	<bean id="protocol.meetings.LogicEcmProtocolDictionariesBootstrap" parent="lecmDictionaryBootstrap"
		  depends-on="documents.dictionaries.LogicEcmModelsBootstrap">
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-protocol-doc-types.xml</value>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-protocol-point-status.xml</value>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-protocol-regnumbers-items.xml</value>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-protocol-event-items.xml</value>
				<value>alfresco/module/${artifactId}/dictionaries/lecm-protocol-bj-items.xml</value>
			</list>
		</property>
	</bean>

<!--	<bean id="meetingsWorkflowBootstrap" parent="workflowDeployer"
		  depends-on="statemachine.aspects.LogicEcmModelsBootstrap,
				     ru.it.lecm.orgstructure.orgstructure-repo.orgStructureBootstrap,">
		<property name="workflowDefinitions">
			<list>
				<props>
					<prop key="engineId">activiti</prop>
					<prop key="location">alfresco/module/${artifactId}/workflow/agenda-approval-workflow.bpmn20.xml</prop>
					<prop key="mimetype">text/xml</prop>
					<prop key="redeploy">${redeploy.process.definitions}</prop>
					<prop key="redeploy">true</prop>
				</props>
			</list>
		</property>
		<property name="models">
			<list>
				<value>alfresco/module/${artifactId}/models/lecm-meetings-workflow-model.xml</value>
			</list>
		</property>
		<property name="labels">
			<list>
				<value>alfresco/module/${artifactId}/messages/lecm-meetings-workflow-model</value>
			</list>
		</property>
		<property name="repositoryWorkflowDefsLocations" ref="customWorkflowDefsRepositoryLocation"/>
	</bean>-->

	<util:constant id="MEETINGS_ROOT_ID" static-field="ru.it.lecm.meetings.beans.MeetingsService.MEETINGS_ROOT_ID"/>

	<bean id="meetingsService" class="ru.it.lecm.meetings.beans.MeetingsServiceImpl" parent="baseBean"
		  depends-on="meetings.ModelsBootstrap, ServiceRegistry, nodeService, transactionService, businessJournalService, WorkflowService, personService, stateMachineHelper"
		  p:workflowService-ref="WorkflowService"
		  p:personService-ref="personService"
		  p:stateMachineService-ref="stateMachineHelper"	
		  p:businessJournalService-ref="businessJournalService"
		  p:documentTableService-ref="documentTableService"

	>
		<!-- Автоматическое создание каталогов. -->
		<property name="folders">
			<map>
				<entry key="#{MEETINGS_ROOT_ID}" value="Сервис Совещания"/>
			</map>
		</property>
	</bean>

	<bean id="meetingsScript" parent="baseScript" class="ru.it.lecm.meetings.scripts.MeetingsWebScriptBean"
		  depends-on="nodeService, meetingsService"
		  p:nodeService-ref="nodeService"
		  p:meetingsService-ref="meetingsService"
		  p:extensionName="meetings"
	/>

	<bean id="meetingsPolicy" class="ru.it.lecm.meetings.policy.MeetingsPolicy" parent="baseBean"
		  init-method="init" 
		  depends-on="documents.LogicEcmModelsBootstrap,
				meetingsService,
				documentTableService,
				policyComponent"
		  p:documentTableService-ref="documentTableService"
		  p:documentAttachmentsService-ref="documentAttachmentsService"
		  p:policyComponent-ref="policyComponent"
		  p:behaviourFilter-ref="policyBehaviourFilter"
		  
	/>
	
	<bean id="protocol.statemachine.bootstrap" parent="defaultStatemachines"
		  p:statemachineName="lecm-protocol:document"
		  p:path="alfresco/module/${artifactId}/statemachine/lecm-protocol-statemachine-default.xml"/>

	<bean id="meetings.statemachine.bootstrap" parent="defaultStatemachines"
		 p:statemachineName="lecm-meetings:document"
		 p:path="alfresco/module/${artifactId}/statemachine/lecm-meetings-statemachine-default.xml"/>
	
	<util:list id="protocol.taggedCounterRegistrator.tags">
		<value>project</value>
	</util:list>
	<bean id="protocol.taggedCounterRegistrator"
		  parent="regNumbersTaggedCounterRegistrator"
		  p:documentType="lecm-protocol:document"
		  p:tags-ref="protocol.taggedCounterRegistrator.tags"/>
	
	<bean id="protocolService" class="ru.it.lecm.meetings.beans.ProtocolServiceImpl" parent="baseBean"
		  depends-on="protocol.ModelsBootstrap,
                      ServiceRegistry, nodeService, transactionService"
		  p:lecmDictionaryService-ref="serviceDictionary"/>
	
	<bean id="protocolScript" parent="baseScript" class="ru.it.lecm.meetings.scripts.ProtocolWebScriptBean"
		  depends-on="nodeService, protocolService"
		  p:nodeService-ref="nodeService"
		  p:protocolService-ref="protocolService"
		  p:documentService-ref="documentService"
		  p:lecmPermissionService-ref="lecmPermissionServiceBean"
		  p:documentEventService-ref="documentEventService"
		  p:documentConnectionService-ref="documentConnectionService"
		  p:businessJournalService-ref="businessJournalService"
		  p:protocolReportsService-ref="protocolReportsService"
		  p:extensionName="protocolService"
	/>
	
	<bean id="protocolReportsService" parent="baseBean"
		  class="ru.it.lecm.meetings.beans.ProtocolReportsServiceImpl"
		  p:reportsManager-ref="reportsManager"
		  p:documentAttachmentsService-ref="documentAttachmentsService"/>
	
	<bean parent="lecmDictionaryBootstrap" depends-on="groupActionsService">
		<property name="rootPath" value="/Business platform/LECM/Сервис Групповые операции"/>
		<property name="dictionaries">
			<list>
				<value>alfresco/module/${artifactId}/actions/review.xml</value>
				<value>alfresco/module/${artifactId}/actions/create-protocol-content.xml</value>
				<value>alfresco/module/${artifactId}/actions/holding-meeting.xml</value>
			</list>
		</property>
	</bean>
	
	
	<bean id="protocol.reports.LogicEcmBootstrap" parent="lecmDictionaryBootstrap"
          depends-on="reportsEditorService,reportsEditor.LogicEcmDictionariesBootstrap,
          reportsEditorOnCreateAssocsPolicy,reportsEditorTemplatePolicy,
          dataSourcePolicy,reportDescriptorPolicy">
        <property name="rootPath" value="/Business platform/LECM/Сервис Редактор Отчетов/Отчеты"/>
        <property name="dictionaries">
            <list>
                <value>alfresco/module/${artifactId}/reports/protocol-content.xml</value>
            </list>
        </property>
        <property name="xmlImportListener" ref="protocol.reportsDeployer"/>
    </bean>

    <bean id="protocol.reportsDeployer" parent="reportsDeployer">
        <property name="reportsForDeploy">
            <list>
                <value>protocol-content</value>
            </list>
        </property>
    </bean>
	
</beans>
