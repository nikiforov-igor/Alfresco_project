<?xml version='1.0' encoding='UTF-8'?>
<alfresco-config>

	<config>
		<forms>
			<dependencies>
				<js src="/scripts/signed-docflow/signs-all-form.js"/>
			</dependencies>
			<form id="signs-info-all">
				<create-form template="/ru/it/lecm/signed/docflow/forms/signs-all-form.ftl"/>
			</form>
		</forms>
	</config>

	<config evaluator="model-type" condition="lecm-contractor:contractor-type">
		<forms>
			<form id="send-to-contractor">
				<create-form template="/ru/it/lecm/signed/docflow/forms/send-to-contractor-form.ftl"/>
				<field-visibility>
					<show id="contractor" force="true"></show>
					<show id="lecm-contractor:interaction-type"></show>
					<show id="lecm-contractor:email"></show>
				</field-visibility>
				<appearance>
					<field id="contractor" label="Контрагент" mandatory="true">
						<control template="/ru/it/lecm/base-share/components/controls/association-tree-picker.ftl">
							<control-param name="rootLocation">/app:company_home/cm:Business_x0020_platform/cm:LECM/cm:Сервис_x0020_Справочники/lecm-dic:Контрагенты</control-param>
							<control-param name="nameSubstituteString">{lecm-contractor:contractor-to-legalform-association/lecm-legalform:short-title} {lecm-contractor:shortname}</control-param>
							<control-param name="showCreateNewLink">false</control-param>
							<control-param name="showCreateNewButton">false</control-param>
							<control-param name="plane">false</control-param>
							<control-param name="showSelectedItemsPath">false</control-param>
							<control-param name="treeItemType">lecm-contractor:contractor-type</control-param>
							<control-param name="endpointType">lecm-contractor:contractor-type</control-param>
							<control-param name="changeItemsFireAction">sendToContractorChanged</control-param>
							<control-param name="mandatory">true</control-param>
						</control>
					</field>
					<field id="lecm-contractor:interaction-type" mandatory="false" />
					<field id="lecm-contractor:email" mandatory="false" />
				</appearance>
			</form>
		</forms>
	</config>

	<config evaluator="node-type" condition="lecm-signed-docflow:sign">
		<forms>
			<form>
				<field-visibility>
					<show id="lecm-signed-docflow:owner"/>
					<show id="lecm-signed-docflow:owner-position"/>
					<show id="lecm-signed-docflow:owner-organization"/>
					<show id="lecm-signed-docflow:signing-date"/>
					<show id="lecm-signed-docflow:serial-number"/>
					<show id="lecm-signed-docflow:valid-from"/>
					<show id="lecm-signed-docflow:valid-through"/>
					<show id="lecm-signed-docflow:ca"/>
					<show id="lecm-signed-docflow:update-date"/>
					<show id="lecm-signed-docflow:is-valid"/>
					<show id="lecm-signed-docflow:is-our"/>
				</field-visibility>
			</form>
		</forms>
	</config>

	<config evaluator="string-compare" condition="DocumentLibrary">
		<aspects>
			<visible>
				<aspect name="lecm-signed-docflow:signable"/>
			</visible>
		</aspects>
	</config>

	<config evaluator="aspect" condition="lecm-signed-docflow:personal-data-attrs-aspect">
		<forms>
			<form id="applet-user-settings-form">
				<create-form template="/ru/it/lecm/signed/docflow/forms/applet-user-settings.ftl" />
				<edit-form template="/ru/it/lecm/signed/docflow/forms/applet-user-settings.ftl" />
				<view-form template="/ru/it/lecm/signed/docflow/forms/applet-user-settings.ftl" />
				<field-visibility>
					<show id="lecm-signed-docflow:operator-code" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:partner-key" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:applet-container" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:applet-key" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:auth-type" for-mode="edit,create"/>
					<show id="lecm-signed-docflow:applet-cert" for-mode="edit,create"/>
				</field-visibility>
				<appearance>
					<field id="lecm-signed-docflow:applet-container" >
						<control template="/ru/it/lecm/signed/docflow/forms/controls/container-picker.ftl" />
					</field>
					<field id="lecm-signed-docflow:applet-key" >
						<control template="/org/alfresco/components/form/controls/textarea.ftl">
							<control-param name="rows">3</control-param>
						</control>
					</field>
					<field id="lecm-signed-docflow:auth-type">
						<control template="/org/alfresco/components/form/controls/selectone.ftl">
							<control-param name="options">LOCAL_CERT|Локально,REMOTE_CERT|Удалённо</control-param>
						</control>
					</field>
					<field id="lecm-signed-docflow:applet-cert" >
						<control template="/ru/it/lecm/signed/docflow/forms/controls/cert-from-file.ftl" />
					</field>
				</appearance>
			</form>
		</forms>
	</config>



	<!-- Конфиг для апплета АйТиШтамп -->
	<config>
		<forms>
			<dependencies>
				<js src="/scripts/signed-docflow/CryptoAppletModule.js" />
				<!-- JS для регистрации action'а "Разблокировать документ,
				добавлен сюда, ибо иначе на странице вложения не цепляется-->
				<js src="/scripts/signed-docflow/document-unlock.js" />
			</dependencies>
			<form id="auth-form">
				<create-form template="/ru/it/lecm/signed/docflow/forms/auth-form.ftl" />
			</form>
			<form id="multiple-sign-form">
				<create-form template="/ru/it/lecm/signed/docflow/forms/multiple-sign-form.ftl" />
			</form>
		</forms>
	</config>
	<!-- Добавление action'a "Разблокировать документа" -->
	<config evaluator="string-compare" condition="DocLibActions">
		<actions>
			<action id="document-unlock" type="javascript" label="actions.document.unlock">
				<param name="function">onUnlockAction</param>
				<evaluator>evaluator.lecm.signed.docflow.showUnlockButton</evaluator>
			</action>
			<action id="document-upload-new-version" type="javascript" label="actions.document.upload-new-version">
				<param name="function">onActionUploadNewVersion</param>
				<permissions>
					<permission allow="true">Write</permission>
				</permissions>
				<evaluator>evaluator.lecm.signed.docflow.showNewVersionButton</evaluator>
			</action>
		</actions>
		<actionGroups>
			<actionGroup id="document-details">
				<action index="101" id="document-unlock" />
			</actionGroup>
			<actionGroup id="document-browse">
				<action index="101" id="document-unlock" />
			</actionGroup>
		</actionGroups>
	</config>
</alfresco-config>