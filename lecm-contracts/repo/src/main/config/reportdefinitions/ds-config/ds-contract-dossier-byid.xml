<?xml version="1.0" encoding="UTF-8"?>
<!--
	Досье договора.

	model of the contract/document:
		.\lecm-contracts\repo\src\main\config\models\lecm-contracts-model.xml

Входные данные:
•	ID документа-договора 

Выходные данные отчета:
•	много полей документа
•	(A) много полей Контрагента

(!) Хорошая особенность - все поля доступны либо непосредственно из документа,
	либо по ссылкам, доступным для substituteService.

  -->

<cmis-ds.config>

	<query_offset>0</query_offset>
	<query_limit>-1</query_limit>
	<query_pgsize>-1</query_pgsize>

	<fields.jasper>
		<!-- Инициатор договора == Регистратор assoc "lecm-contract:registrator-assoc", target "lecm-orgstr:employee" -->
		<field jrFldName="col_Initiator.Family" queryFldName="{lecm-contract:registrator-assoc/lecm-orgstr:employee-last-name}" displayName="Инициатор.Фамилия" />
		<field jrFldName="col_Initiator.Name" queryFldName="{lecm-contract:registrator-assoc/lecm-orgstr:employee-first-name}" displayName="Инициатор.Имя" />
		<field jrFldName="col_Initiator.Otchestvo" queryFldName="{lecm-contract:registrator-assoc/lecm-orgstr:employee-middle-name}" displayName="Инициатор.Отчество" />
		<field jrFldName="col_Initiator.Staff" queryFldName="{lecm-contract:registrator-assoc/lecm-representative:rank}" displayName="Инициатор.Должность" />
		<field jrFldName="col_Initiator.OU" queryFldName="{lecm-contract:registrator-assoc/lecm-representative:rank}" displayName="Инициатор.Подразделение" />
		<field jrFldName="col_Initiator.Phone" queryFldName="{lecm-contract:registrator-assoc/lecm-representative:rank}" displayName="Инициатор.Телефон" />

		<!-- Статус -->
		<field jrFldName="col_Status" queryFldName="lecm-statemachine:status" displayName="Статус" />

		<!-- Дата изменения статуса -->
		<field jrFldName="col_StatusDate" queryFldName="lecm-document:status-changed-date" displayName="Дата смены статус"
				javaValueClass="java.util.Date"/>

		<!-- "Общая сумма по договору": "lecm-contract:totalAmount" 
			 и "Валюта договора": (assoc) "lecm-contract:currency-assoc" 
				-> target: "lecm-currency:currency
		  -->
		<field jrFldName="col_Sum" queryFldName="lecm-contract:totalAmount" displayName="Сумма договора" />
		<field jrFldName="col_SumUnits" queryFldName="{lecm-currency:currency/cm:name}" displayName="Валюта договора" />

		<!-- Данные по "Виду договора" (с типом "lecm-contract-dic:contract-type") -->
		<field jrFldName="col_DocKind" queryFldName="{lecm-contract:typeContract-assoc/cm:name}" displayName="Вид договора" />

		<field queryFldName="lecm-contract:regNumSystem"
				jrFldName="col_Regnum"
				displayName="Регистрационный номер договора" javaValueClass="String"/>

		<!-- Дата заключения договора -->
		<field jrFldName="col_ConclusionDate" queryFldName="lecm-contract:dateConclusionContracts" displayName="Дата заключения"
			javaValueClass="date"/>

		<!-- Регистрационный номер проекта договора-->
		<field queryFldName="lecm-contract:regNumProject"
				jrFldName="col_RegnumProject"
				displayName="Регистрационный номер проекта договора" javaValueClass="String"/>

		<!-- Регистрационный номер контрагента -->
		<field queryFldName="lecm-contract:regNumContractor"
				jrFldName="col_RegnumContractor"
				displayName="Регистрационный номер контрагента" javaValueClass="String"/>

		<!-- Полное наименование котрагента "lecm-contract:partner-assoc": target "lecm-contractor:contractor-type"
			и пр атрибуты котрагента
		  -->
		<field jrFldName="col_Contragent.fullname"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:fullname}" displayName="Контрагент.Полное наименование"/>
		<field jrFldName="col_Contragent.name"  queryFldName="{lecm-contract:partner-assoc/lecm-contractor:shortname}" displayName="Контрагент.Короткое"/>
		<field jrFldName="col_Contragent.phone" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:phone}" displayName="Контрагент.Тел" />

		<field jrFldName="col_Contragent.YurAddress" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:legal-address}" displayName="Контрагент.Юридический адрес" />
		<field jrFldName="col_Contragent.PhisAddress" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:physical-address}" displayName="Контрагент.Фактический адрес" />

		<!-- БИК Контрагента -->
		<field jrFldName="col_Contragent.BIK" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:BIK}" displayName="Контрагент.БИК" />

		<!-- Наименование банка Контрагента -->
		<field jrFldName="col_Contragent.Bankname" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:bankname}" displayName="Контрагент.БИК" />

		<!-- Расчетный счет -->
		<field jrFldName="col_Contragent.TransactAccount" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:transactional-account}" displayName="Контрагент.Расчётный счёт" />

		<!-- Корреспондентский счет -->
		<field jrFldName="col_Contragent.CorrAccount" queryFldName="{lecm-contract:partner-assoc/lecm-contractor:correspondent-account}" displayName="Контрагент.Корреспондентский счет" />

		<!--Представители (типа "lecm-representative:representative-type")
			Фамилия Имя Отчество и Должность
		  -->
		<field jrFldName="col_Executor.Family" queryFldName="{lecm-contract:representative-assoc/lecm-representative:surname}" displayName="КонтрагентаИсполнитель.Фамилия" />
		<field jrFldName="col_Executor.Name" queryFldName="{lecm-contract:representative-assoc/lecm-representative:firstname}" displayName="КонтрагентаИсполнитель.Имя" />
		<field jrFldName="col_Executor.Otchestvo" queryFldName="{lecm-contract:representative-assoc/lecm-representative:middlename}" displayName="КонтрагентаИсполнитель.Отчество" />
		<field jrFldName="col_Executor.Staff" queryFldName="{lecm-contract:representative-assoc/lecm-representative:rank}" displayName="КонтрагентаИсполнитель.Должность" />

		<!-- Дата начала действия договора -->
		<field jrFldName="col_DateStart" queryFldName="lecm-contract:startDate" displayName="Дата начала действия договора"
				javaValueClass="java.util.Date"/>

		<!-- Дата окончания действия договора -->
		<field jrFldName="col_DateEnd" queryFldName="lecm-contract:endDate" displayName="Дата окончания действия договора"
				javaValueClass="java.util.Date"/>

		<!-- Бессрочный -->
		<field jrFldName="col_ContractIsUnlimited" queryFldName="lecm-contract:unlimited" displayName="Договор бессрочный"
				javaValueClass="boolean"/>

		<!--  Местонахождение договора -->
		<field jrFldName="col_Contract.Placehold" queryFldName="lecm-contract:locationContract" displayName="Местонахождение договора" />

		<!-- Место регистрации -->
		<field jrFldName="col_Contract.RegPlace" queryFldName="lecm-contract:locationRegistration" displayName="Место регистрации договора" />


		<!-- Данные по "Тематика договора" (с типом "lecm-contract-dic:contract-subjects") -->
		<field jrFldName="col_Theme.code" queryFldName="{lecm-contract:subjectContract-assoc/lecm-contract-dic:contract-subjects-code}" displayName="Тематика.Код" />
		<field jrFldName="col_Theme.tname" queryFldName="{lecm-contract:subjectContract-assoc/cm:name}" displayName="Тематика.Название" />
		<field jrFldName="col_Theme.desc" queryFldName="{lecm-contract:subjectContract-assoc/lecm-contract-dic:contract-subjects-description}" displayName="Тематика.Описание" />

		<!--
			<field queryFldName="fmydata" dislayName="" javaValueClass="my.check.type"/>
		  -->
	</fields.jasper>

	<url>http://localhost:8080/alfresco/service/cmis</url>
	<username>admin</username>
	<password>111</password>
	<allVersions>false</allVersions>

	<!--
		select * from lecm:documents
	  -->
	<query>
		<![CDATA[
			select * from lecm-contract:document as Contract
		]]>
	</query>

</cmis-ds.config>
